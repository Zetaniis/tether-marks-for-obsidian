/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// src/main.ts
var main_exports = {};
__export(main_exports, {
  default: () => TetherMarksPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian6 = require("obsidian");

// src/pluginOperations.ts
var import_obsidian2 = require("obsidian");

// node_modules/tether-marks-core/dist/marks.js
function findFirstUnusedRegister(marks, registers) {
  for (const reg of registers) {
    if (!marks.map((m) => m.symbol).includes(reg)) {
      return reg;
    }
  }
  return null;
}
function getMarkBySymbol(marks, symbol) {
  return marks.find((m) => m.symbol === symbol);
}
function sortMarksAlphabetically(marks) {
  marks.sort((a, b) => a.symbol.localeCompare(b.symbol));
}
function getSortedAndFilteredMarks(marks, isHarpoonMode, settings) {
  const availableRegisters = new Set((!isHarpoonMode ? settings.registerList : settings.harpoonRegisterList).split(""));
  const filteredMarks = marks.filter((el) => availableRegisters.has(el.symbol));
  if (!isHarpoonMode && settings.registerSortByList) {
    const registerList = settings.registerList;
    sortMarksBySettingsRegisterOrder(filteredMarks, registerList);
  } else if (isHarpoonMode && settings.harpoonRegisterSortByList) {
    const registerList = settings.harpoonRegisterList;
    sortMarksBySettingsRegisterOrder(filteredMarks, registerList);
  } else {
    sortMarksAlphabetically(filteredMarks);
  }
  return filteredMarks;
}
function sortMarksBySettingsRegisterOrder(marks, registers) {
  const registerOrder = new Map([...registers].map((symbol, index) => [symbol, index]));
  marks.sort((a, b) => {
    var _a, _b;
    return ((_a = registerOrder.get(a.symbol)) !== null && _a !== void 0 ? _a : Infinity) - ((_b = registerOrder.get(b.symbol)) !== null && _b !== void 0 ? _b : Infinity);
  });
}
function removeGapsForHarpoonMarks(marksToCopy, harpoonRegisters) {
  let marks = [...marksToCopy];
  let leftCur = 0;
  let rightCur = 0;
  while (rightCur < harpoonRegisters.length) {
    const markEl = marks.find((el) => el.symbol === harpoonRegisters[rightCur]);
    if (markEl !== void 0) {
      const symbolToSetTo = harpoonRegisters[leftCur];
      let filteredMarks = marks.filter((el) => el.symbol !== harpoonRegisters[leftCur]);
      filteredMarks.push({ symbol: symbolToSetTo, filePath: markEl.filePath });
      marks = filteredMarks;
      leftCur += 1;
    }
    rightCur += 1;
  }
  while (leftCur < harpoonRegisters.length) {
    marks = marks.filter((el) => el.symbol !== harpoonRegisters[leftCur]);
    leftCur += 1;
  }
  return marks;
}
function restoreLastChangedMark(marks, lastChangedMark) {
  const markToRestore = { ...lastChangedMark };
  const markToDiscard = marks.find((m) => m.symbol === markToRestore.symbol);
  const marksWithoutDiscarded = marks.filter((m) => m.symbol !== markToRestore.symbol);
  marksWithoutDiscarded.push({ symbol: markToRestore.symbol, filePath: markToRestore.filePath });
  return { marks: marksWithoutDiscarded, markToDiscard };
}
function setNewOrOverwriteMark(marks, setMark, filePath) {
  const { marks: filteredMarks, deletedMark: overwrittenMark } = deleteMark(marks, setMark);
  filteredMarks.push({ symbol: setMark.symbol, filePath });
  return { marks: filteredMarks, overwrittenMark };
}
function deleteMark(marks, markToDelete) {
  const cMark = { ...markToDelete };
  const deletedMark = marks.find((m) => m.symbol === cMark.symbol);
  const filteredMarks = marks.filter((m) => m.symbol !== cMark.symbol);
  return { marks: filteredMarks, deletedMark };
}

// node_modules/tether-marks-core/dist/defaultValues.js
var defaultBasicMarksSettings = {
  registerList: "abcdefghijklmnopqrstuvwxyz",
  registerSortByList: true,
  harpoonRegisterList: "qwer",
  harpoonRegisterSortByList: true,
  harpoonRegisterGapRemoval: true
};
var modeDescription = {
  "set": "Set mark",
  "goto": "Go to mark",
  "delete": "Delete mark"
};

// src/utils/obsidianUtils.ts
var import_obsidian = require("obsidian");
function openNewFileByPath(filePath, openFileInNewTab, app) {
  const file = app.vault.getAbstractFileByPath(filePath);
  if (file instanceof import_obsidian.TFile) {
    if (openFileInNewTab) {
      app.workspace.getLeaf("tab").openFile(file);
    } else {
      app.workspace.getLeaf().openFile(file);
    }
  } else {
    new import_obsidian.Notice(`File not found for path ${filePath}. The file may have been deleted, moved or renamed.`);
  }
}
function getAllOpenedFilesExperimental(app) {
  var _a;
  const tabGroups = (_a = app.workspace.getLayout().main) == null ? void 0 : _a.children;
  const out = [];
  for (const el of tabGroups) {
    out.push(...el.children);
  }
  return out;
}
function getAllWorkspaceLeaves(app) {
  const list = [];
  app.workspace.iterateAllLeaves((leaf) => {
    list.push(leaf);
  });
  return list;
}
function navigateToOpenedFileByPath(filePath, experimentalGoto, app) {
  if (experimentalGoto) {
    const openedFiles = getAllOpenedFilesExperimental(app);
    for (const openedFile of openedFiles) {
      if (openedFile.type == "leaf" && openedFile.state.state.file === filePath) {
        const leaf = app.workspace.getLeafById(openedFile.id);
        if (leaf && leaf.parent === app.workspace.getLeaf().parent) {
          app.workspace.setActiveLeaf(leaf, { focus: true });
          return true;
        }
      }
    }
  } else {
    const leaves = getAllWorkspaceLeaves(app);
    for (const leaf of leaves) {
      const view = leaf.view;
      if (view.file && view.file.path === filePath && leaf.parent === app.workspace.getLeaf().parent) {
        app.workspace.setActiveLeaf(leaf, { focus: true });
        return true;
      }
    }
  }
  return false;
}

// src/pluginOperations.ts
async function pluginSetNewOrOverwriteMark(plugin, mark) {
  const file = plugin.app.workspace.getActiveFile();
  if (!file) {
    new import_obsidian2.Notice("No active file to mark.");
    return;
  }
  const { marks, overwrittenMark } = setNewOrOverwriteMark(plugin.marks, mark, file.path);
  await plugin.saveMarks(marks);
  if (overwrittenMark) {
    await plugin.saveLastChangedMark(overwrittenMark);
  }
  new import_obsidian2.Notice(`Set mark '${mark.symbol}' to ${file.name}`);
}
function pluginGoToMark(plugin, mark) {
  const success = navigateToOpenedFileByPath(mark.filePath, plugin.settings.experimentalGoto, plugin.app);
  if (!success) {
    openNewFileByPath(mark.filePath, plugin.settings.openMarkInNewTab, plugin.app);
  }
}
async function pluginDeleteMark(plugin, mark) {
  const { marks, deletedMark } = deleteMark(plugin.marks, mark);
  await plugin.saveMarks(marks);
  if (deletedMark) {
    await plugin.saveLastChangedMark(deletedMark);
  }
  if (plugin.settings.harpoonRegisterGapRemoval) {
    pluginRemoveGapsForHarpoonMarks(plugin);
  }
  new import_obsidian2.Notice(`Deleted mark '${deletedMark == null ? void 0 : deletedMark.symbol}'`);
}
async function pluginRestoreLastChangedMark(plugin) {
  if (plugin.lastChangedMark) {
    const out = restoreLastChangedMark(plugin.marks, plugin.lastChangedMark);
    await plugin.saveMarks(out.marks);
    new import_obsidian2.Notice(`Restored mark '${plugin.lastChangedMark.symbol}' to ${plugin.lastChangedMark.filePath}`);
    if (out.markToDiscard) {
      plugin.saveLastChangedMark(out.markToDiscard);
    }
  } else {
    new import_obsidian2.Notice("No last changed mark to restore.");
  }
}
function pluginAddFileToHarpoon(plugin) {
  const harpoonRegisters = plugin.settings.harpoonRegisterList.split("");
  const reg = findFirstUnusedRegister(plugin.marks, harpoonRegisters);
  if (reg) {
    const file = plugin.app.workspace.getActiveFile();
    if (!file) {
      new import_obsidian2.Notice("No active file to mark.");
      return;
    }
    pluginSetNewOrOverwriteMark(plugin, { symbol: reg, filePath: file.path });
  } else {
    new import_obsidian2.Notice("Harpoon registers are full, cannot add more marks.");
  }
}
async function pluginRemoveGapsForHarpoonMarks(plugin) {
  const harpoonRegisters = plugin.settings.harpoonRegisterList.split("");
  const marks = removeGapsForHarpoonMarks(plugin.marks, harpoonRegisters);
  await plugin.saveMarks(marks);
}

// src/ui/MarkListModal.ts
var import_obsidian3 = require("obsidian");

// src/utils/defaultValues.ts
var modalDefaultKeybinds = {
  up: ["ctrl+k", "ctrl+p"],
  down: ["ctrl+j", "ctrl+n"],
  delete: ["ctrl+d"],
  select: ["Enter"],
  cancel: ["Escape"],
  undo: ["ctrl+u"]
};
var modalDefaultKeybindsMac = {
  up: ["cmd+k", "cmd+p"],
  down: ["cmd+j", "cmd+n"],
  delete: ["cmd+d"],
  select: ["Enter"],
  cancel: ["Escape"],
  undo: ["cmd+u"]
};
var modalMarkSymbolClass = "mark-symbol";
var modalMarkFilepathClass = "mark-file-path";
var modalMarkHarpoonSign = "harpoon-sign";
var JSONschemaVersion = 1;
var defaultObsidianMarksSettings = {
  ...defaultBasicMarksSettings,
  // hideMarkListDuringInput: false,
  openMarkInNewTab: false,
  // If true, open mark in new tab, else in current tab
  experimentalGoto: false,
  modalListUp: "",
  modalListDown: "",
  modalListSelect: "",
  modalListUndo: "",
  modalListDelete: "",
  modalListCancel: ""
};

// src/utils/keybinds.ts
function prepareKeybinds(isMacOS, settings) {
  let keybinds = !isMacOS ? { ...modalDefaultKeybinds } : { ...modalDefaultKeybindsMac };
  if (settings.modalListUp) {
    keybinds.up = [settings.modalListUp];
  }
  if (settings.modalListDown) {
    keybinds.down = [settings.modalListDown];
  }
  if (settings.modalListDelete) {
    keybinds.delete = [settings.modalListDelete];
  }
  if (settings.modalListSelect) {
    keybinds.select = [settings.modalListSelect];
  }
  if (settings.modalListUndo) {
    keybinds.undo = [settings.modalListUndo];
  }
  if (settings.modalListCancel) {
    keybinds.cancel = [settings.modalListCancel];
  }
  return keybinds;
}
function matchKeybind(evt, keybind) {
  const parts = keybind.split("+").map((p) => p.trim());
  let required = { ctrl: false, shift: false, alt: false, meta: false, key: "" };
  for (const part of parts) {
    if (part === "ctrl")
      required.ctrl = true;
    else if (part === "shift")
      required.shift = true;
    else if (part === "alt")
      required.alt = true;
    else if (part === "meta" || part === "cmd" || part === "win")
      required.meta = true;
    else
      required.key = part;
  }
  if (evt.ctrlKey !== required.ctrl)
    return false;
  if (evt.shiftKey !== required.shift)
    return false;
  if (evt.altKey !== required.alt)
    return false;
  if (evt.metaKey !== required.meta)
    return false;
  return evt.key === required.key;
}

// src/ui/MarkListModal.ts
var MarkListModal = class extends import_obsidian3.SuggestModal {
  constructor(app, plugin, mode, isHarpoonMode = false) {
    super(app);
    this.plugin = plugin;
    this.mode = mode;
    this.isHarpoonMode = isHarpoonMode;
  }
  getInstructions(modalKeybinds) {
    return [
      { command: modalKeybinds.up.join("/"), purpose: "Up" },
      { command: modalKeybinds.down.join("/"), purpose: "Down" },
      { command: "[Symbol]", purpose: modeDescription[this.mode] },
      { command: modalKeybinds.select.join("/"), purpose: modeDescription[this.mode] },
      { command: modalKeybinds.delete.join("/"), purpose: "Delete" },
      { command: modalKeybinds.cancel.join("/"), purpose: "Cancel" },
      { command: modalKeybinds.undo.join("/"), purpose: "Undo" }
    ];
  }
  getSuggestions(query) {
    return getSortedAndFilteredMarks(this.plugin.marks, this.isHarpoonMode, this.plugin.settings);
  }
  renderSuggestion(mark, el) {
    var _a;
    const symbolEl = el.createEl("span", { text: mark.symbol, cls: modalMarkSymbolClass });
    el.createEl("span", { text: mark.filePath, cls: modalMarkFilepathClass });
    if (this.plugin.settings.harpoonRegisterList.contains(mark.symbol)) {
      el.createEl("span", { text: "H", cls: modalMarkHarpoonSign });
    }
    if (((_a = this.app.workspace.getActiveFile()) == null ? void 0 : _a.path) === mark.filePath) {
      symbolEl.addClass("highlight");
    }
    el.addEventListener("click", async (evt) => {
      await this.onChooseSuggestion(mark, evt);
      this.close();
    });
  }
  onOpen() {
    super.onOpen();
    if (this.inputEl) {
      this.inputEl.style.display = "none";
    }
    this.modalEl.addClass("marks-modal");
    const modalKeybinds = prepareKeybinds(import_obsidian3.Platform.isMacOS, this.plugin.settings);
    this.setInstructions(this.getInstructions(modalKeybinds));
    this._keyHandler = this.getModalKeyHandler(modalKeybinds);
    window.addEventListener("keydown", this._keyHandler, true);
  }
  onClose() {
    if (this._keyHandler) {
      window.removeEventListener("keydown", this._keyHandler, true);
      this._keyHandler = void 0;
    }
    super.onClose();
  }
  getModalKeyHandler(keybinds) {
    return async (evt) => {
      const availableRegisters = new Set((!this.isHarpoonMode ? this.plugin.settings.registerList : this.plugin.settings.harpoonRegisterList).split(""));
      const chooser = this.chooser;
      if (keybinds.up.some((kb) => matchKeybind(evt, kb))) {
        evt.preventDefault();
        this.moveSelection(-1);
      } else if (keybinds.down.some((kb) => matchKeybind(evt, kb))) {
        evt.preventDefault();
        this.moveSelection(1);
      } else if (keybinds.delete.some((kb) => matchKeybind(evt, kb))) {
        evt.preventDefault();
        if (chooser.values) {
          const prevIdx = chooser.selectedItem;
          const selected = chooser.values[prevIdx];
          if (selected) {
            await pluginDeleteMark(this.plugin, selected);
            chooser.values = getSortedAndFilteredMarks(this.plugin.marks, this.isHarpoonMode, this.plugin.settings);
            chooser.setSuggestions(chooser.values);
            chooser.setSelectedItem(Math.max(0, Math.min(prevIdx, chooser.values.length - 1)), false);
          }
        }
      } else if (keybinds.undo.some((kb) => matchKeybind(evt, kb))) {
        evt.preventDefault();
        await pluginRestoreLastChangedMark(this.plugin);
        chooser.values = getSortedAndFilteredMarks(this.plugin.marks, this.isHarpoonMode, this.plugin.settings);
        const prevIdx = chooser.selectedItem;
        chooser.setSuggestions(chooser.values);
        chooser.setSelectedItem(Math.max(0, prevIdx), false);
      } else if (keybinds.select.some((kb) => matchKeybind(evt, kb))) {
        evt.preventDefault();
        const ind = chooser.selectedItem;
        const selected = chooser.values[ind];
        if (selected) {
          this.onChooseSuggestion(selected, evt);
          this.close();
        }
      } else if (keybinds.cancel.some((kb) => matchKeybind(evt, kb))) {
        evt.preventDefault();
        this.close();
      } else if (availableRegisters.has(evt.key)) {
        let mark = getMarkBySymbol(this.plugin.marks, evt.key);
        if (this.mode === "set") {
          if (mark == null) {
            mark = { symbol: evt.key, filePath: "" };
          }
          evt.preventDefault();
          await this.onChooseSuggestion(mark, evt);
          this.close();
        } else if (this.mode === "goto" && mark) {
          evt.preventDefault();
          await this.onChooseSuggestion(mark, evt);
          this.close();
        } else if (this.mode === "delete" && mark) {
          evt.preventDefault();
          await this.onChooseSuggestion(mark, evt);
          this.close();
        }
      }
    };
  }
  async onChooseSuggestion(mark, evt) {
    if (this.mode === "set") {
      pluginSetNewOrOverwriteMark(this.plugin, mark);
    } else if (this.mode === "goto") {
      pluginGoToMark(this.plugin, mark);
    } else if (this.mode === "delete") {
      pluginDeleteMark(this.plugin, mark);
    }
  }
  moveSelection(delta) {
    const chooser = this.chooser;
    if (!chooser)
      return;
    let idx = chooser.selectedItem;
    if (typeof idx !== "number")
      idx = 0;
    if (!chooser.values)
      return;
    const max = chooser.values.length;
    let next = idx + delta;
    if (next < 0)
      next = max - 1;
    if (next >= max)
      next = 0;
    chooser.setSelectedItem(next, 0);
  }
};

// src/commands.ts
async function setGlobalMark(plugin) {
  new MarkListModal(plugin.app, plugin, "set").open();
}
async function goToGlobalMark(plugin) {
  new MarkListModal(plugin.app, plugin, "goto").open();
}
async function deleteGlobalMark(plugin) {
  new MarkListModal(plugin.app, plugin, "delete").open();
}
async function addFileToHarpoon(plugin) {
  pluginAddFileToHarpoon(plugin);
}
async function goToHarpoonMark(plugin) {
  new MarkListModal(plugin.app, plugin, "goto", true).open();
}

// src/ui/SettingsTab.ts
var import_obsidian4 = require("obsidian");
var SettingsTab = class extends import_obsidian4.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    const ds = defaultObsidianMarksSettings;
    new import_obsidian4.Setting(containerEl).setName("Open mark in new tab").setDesc('Open a file in the new tab when using "go to" command. If disabled, it will open the file in the current tab.').addToggle(
      (toggle) => {
        var _a;
        return toggle.setValue((_a = this.plugin.settings.openMarkInNewTab) != null ? _a : ds.openMarkInNewTab).onChange(async (value) => {
          this.plugin.settings.openMarkInNewTab = value;
          await this.plugin.saveSettings();
        });
      }
    );
    new import_obsidian4.Setting(containerEl).setName("No duplication of opened files when using Go to commands (experimental)").setDesc("Prevents duplicate tabs when switching to already opened files using the mark list after restarting Obsidian. (Experimental: may not work in future Obsidian versions.)").addToggle(
      (toggle) => {
        var _a;
        return toggle.setValue((_a = this.plugin.settings.experimentalGoto) != null ? _a : ds.experimentalGoto).onChange(async (value) => {
          this.plugin.settings.experimentalGoto = value;
          await this.plugin.saveSettings();
        });
      }
    );
    new import_obsidian4.Setting(containerEl).setName("General registers").setHeading();
    this.createRegisterListSetting(containerEl, "Register list", ds.registerList, "Key symbols to be used as registers. Only include symbols that you can input with a single keystroke.", "registerList").addExtraButton((btn) => {
      btn.setIcon("refresh-ccw").setTooltip("Reset to default register list").onClick(
        async () => {
          this.plugin.settings.registerList = ds.registerList;
          await this.plugin.saveSettings();
          this.display();
        }
      );
    });
    new import_obsidian4.Setting(containerEl).setName("Sort all marks by register list").setDesc("Sort marks by the order of the key symbols in the register list. If disabled, marks will be sorted alphabetically according to the current locale.").addToggle(
      (toggle) => {
        var _a;
        return toggle.setValue((_a = this.plugin.settings.registerSortByList) != null ? _a : ds.registerSortByList).onChange(async (value) => {
          this.plugin.settings.registerSortByList = value;
          await this.plugin.saveSettings();
        });
      }
    );
    new import_obsidian4.Setting(containerEl).setName("Harpoon registers").setHeading();
    this.createRegisterListSetting(containerEl, "Harpoon register list", ds.harpoonRegisterList, "Key symbols to be used as Harpoon registers. Only include symbols that you can input with a single keystroke.", "harpoonRegisterList").addExtraButton((btn) => {
      btn.setIcon("refresh-ccw").setTooltip("Reset to default Harpoon register list").onClick(
        async () => {
          this.plugin.settings.harpoonRegisterList = ds.harpoonRegisterList;
          await this.plugin.saveSettings();
          this.display();
        }
      );
    });
    new import_obsidian4.Setting(containerEl).setName("Sort Harpoon marks by Harpoon register list").setDesc("Sort Harpoon marks by the order of the key symbols in the Harpoon register list. If disabled, marks will be sorted alphabetically according to the current locale.").addToggle(
      (toggle) => {
        var _a;
        return toggle.setValue((_a = this.plugin.settings.harpoonRegisterSortByList) != null ? _a : ds.harpoonRegisterSortByList).onChange(async (value) => {
          this.plugin.settings.harpoonRegisterSortByList = value;
          await this.plugin.saveSettings();
        });
      }
    );
    new import_obsidian4.Setting(containerEl).setName("Remove gaps inbetween Harpoon marks").setDesc("Harpoon marks will be shifted to the left for every gap (register with no mark) based on the order of the Harpoon register list.").addToggle(
      (toggle) => {
        var _a;
        return toggle.setValue((_a = this.plugin.settings.harpoonRegisterGapRemoval) != null ? _a : ds.harpoonRegisterGapRemoval).onChange(async (value) => {
          this.plugin.settings.harpoonRegisterGapRemoval = value;
          await this.plugin.saveSettings();
        });
      }
    );
    containerEl.createEl("h4", { text: "List navigation shortcuts" });
    this.createShortcutSetting(containerEl, "Up", ds.modalListUp, "Shortcut for moving up in the list", "modalListUp");
    this.createShortcutSetting(containerEl, "Down", ds.modalListDown, "Shortcut for moving down in the list", "modalListDown");
    this.createShortcutSetting(containerEl, "Select mark", ds.modalListSelect, "Shortcut for selecting a mark", "modalListSelect");
    this.createShortcutSetting(containerEl, "Cancel modal", ds.modalListCancel, "Shortcut for cancelling the modal", "modalListCancel");
    this.createShortcutSetting(containerEl, "Delete mark", ds.modalListDelete, "Shortcut for deleting a mark", "modalListDelete");
    this.createShortcutSetting(containerEl, "Restore last changed mark", ds.modalListUndo, "Shortcut for undoing last action of changing a mark", "modalListUndo");
  }
  // use only for string values from Settings type
  createShortcutSetting(containerEl, name, defaultValue, desc, key) {
    new import_obsidian4.Setting(containerEl).setName(name).setDesc(desc).addText((text) => {
      var _a;
      return text.setValue(String((_a = this.plugin.settings[key]) != null ? _a : defaultValue)).onChange(async (value) => {
        this.plugin.settings[key] = value;
        await this.plugin.saveSettings();
      });
    });
  }
  createRegisterListSetting(containerEl, name, defaultValue, desc, key) {
    return new import_obsidian4.Setting(containerEl).setName(name).setDesc(desc).addText((text) => {
      var _a;
      return text.setValue(String((_a = this.plugin.settings[key]) != null ? _a : defaultValue)).onChange(async (value) => {
        this.plugin.settings[key] = value;
        await this.plugin.saveSettings();
      });
    });
  }
};

// src/utils/storage.ts
var import_obsidian5 = require("obsidian");
async function loadSettings(plugin) {
  var _a;
  return ((_a = await plugin.loadData()) == null ? void 0 : _a.settings) || defaultObsidianMarksSettings;
}
async function saveSettings(plugin, settings) {
  const data = await plugin.loadData() || {};
  data.settings = settings;
  await plugin.saveData(data);
}
async function loadMarks(plugin) {
  var _a;
  return ((_a = await plugin.loadData()) == null ? void 0 : _a.marks) || [];
}
async function saveMarks(plugin, marks) {
  const data = await plugin.loadData() || {};
  data.marks = marks;
  await plugin.saveData(data);
}
async function loadLastChangedMark(plugin) {
  var _a;
  return ((_a = await plugin.loadData()) == null ? void 0 : _a.lastChangedMark) || {};
}
async function saveLastChangedMark(plugin, lastChangedMark) {
  const data = await plugin.loadData() || {};
  data.lastChangedMark = lastChangedMark;
  await plugin.saveData(data);
}
async function JSONschemaCheck(plugin) {
  const data = await plugin.loadData();
  if (!data || !data.schemaVersion) {
    await plugin.saveData({ schemaVersion: JSONschemaVersion, ...data });
    return;
  }
  if (data.schemaVersion === JSONschemaVersion) {
    return;
  }
  new import_obsidian5.Notice(plugin.manifest.name + ": Faulty data. Check developer tools for more info.");
  console.error(plugin.manifest.id + ": The data loaded is not in correct format. The plugin may not work properly. This usually happens after plugin update that changes the JSON schema. ");
}

// src/main.ts
var TetherMarksPlugin = class extends import_obsidian6.Plugin {
  constructor() {
    super(...arguments);
    this.marks = [];
    this.lastChangedMark = null;
  }
  async onload() {
    await JSONschemaCheck(this);
    this.settings = await loadSettings(this);
    this.marks = await loadMarks(this);
    this.lastChangedMark = await loadLastChangedMark(this);
    this.addCommand({
      id: "set-mark",
      name: "Set mark",
      callback: () => setGlobalMark(this)
    });
    this.addCommand({
      id: "go-to-mark",
      name: "Go to mark",
      callback: () => goToGlobalMark(this)
    });
    this.addCommand({
      id: "delete-mark",
      name: "Delete mark",
      callback: () => deleteGlobalMark(this)
    });
    this.addCommand({
      id: "add-file-to-harpoon",
      name: "Add file to Harpoon",
      callback: () => addFileToHarpoon(this)
    });
    this.addCommand({
      id: "go-to-harpoon-mark",
      name: "Go to Harpoon mark",
      callback: () => goToHarpoonMark(this)
    });
    this.addSettingTab(new SettingsTab(this.app, this));
    console.log("loading " + this.manifest.id);
  }
  async saveSettings() {
    await saveSettings(this, this.settings);
  }
  async saveMarks(marks) {
    this.marks = marks;
    await saveMarks(this, marks);
  }
  async saveLastChangedMark(lastChangedMark) {
    this.lastChangedMark = lastChangedMark;
    await saveLastChangedMark(this, lastChangedMark);
  }
  onunload() {
    console.log("unloading " + this.manifest.id);
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsic3JjL21haW4udHMiLCAic3JjL3BsdWdpbk9wZXJhdGlvbnMudHMiLCAibm9kZV9tb2R1bGVzL3RldGhlci1tYXJrcy1jb3JlL2Rpc3QvbWFya3MuanMiLCAibm9kZV9tb2R1bGVzL3RldGhlci1tYXJrcy1jb3JlL2Rpc3QvZGVmYXVsdFZhbHVlcy5qcyIsICJzcmMvdXRpbHMvb2JzaWRpYW5VdGlscy50cyIsICJzcmMvdWkvTWFya0xpc3RNb2RhbC50cyIsICJzcmMvdXRpbHMvZGVmYXVsdFZhbHVlcy50cyIsICJzcmMvdXRpbHMva2V5YmluZHMudHMiLCAic3JjL2NvbW1hbmRzLnRzIiwgInNyYy91aS9TZXR0aW5nc1RhYi50cyIsICJzcmMvdXRpbHMvc3RvcmFnZS50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgUGx1Z2luIH0gZnJvbSAnb2JzaWRpYW4nO1xuaW1wb3J0IHsgc2V0R2xvYmFsTWFyaywgZ29Ub0dsb2JhbE1hcmssIGdvVG9IYXJwb29uTWFyaywgYWRkRmlsZVRvSGFycG9vbiwgZGVsZXRlR2xvYmFsTWFyayB9IGZyb20gJy4vY29tbWFuZHMnO1xuaW1wb3J0IHsgU2V0dGluZ3NUYWIgfSBmcm9tICcuL3VpL1NldHRpbmdzVGFiJztcbmltcG9ydCB7IGxvYWRTZXR0aW5ncywgc2F2ZVNldHRpbmdzLCBsb2FkTWFya3MsIHNhdmVNYXJrcywgbG9hZExhc3RDaGFuZ2VkTWFyaywgc2F2ZUxhc3RDaGFuZ2VkTWFyaywgSlNPTnNjaGVtYUNoZWNrIH0gZnJvbSAnLi91dGlscy9zdG9yYWdlJztcbmltcG9ydCB7IE1hcmsgfSBmcm9tICd0ZXRoZXItbWFya3MtY29yZSc7XG5pbXBvcnQgeyBPYnNpZGlhbk1hcmtzU2V0dGluZ3MgfSBmcm9tICcuL3R5cGVzJztcblxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBUZXRoZXJNYXJrc1BsdWdpbiBleHRlbmRzIFBsdWdpbiB7XG4gICAgc2V0dGluZ3MhOiBPYnNpZGlhbk1hcmtzU2V0dGluZ3M7XG4gICAgbWFya3M6IE1hcmtbXSA9IFtdO1xuICAgIGxhc3RDaGFuZ2VkTWFyazogTWFyayB8IG51bGwgPSBudWxsO1xuXG4gICAgYXN5bmMgb25sb2FkKCkge1xuICAgICAgICBhd2FpdCBKU09Oc2NoZW1hQ2hlY2sodGhpcyk7XG5cbiAgICAgICAgdGhpcy5zZXR0aW5ncyA9IGF3YWl0IGxvYWRTZXR0aW5ncyh0aGlzKTtcbiAgICAgICAgdGhpcy5tYXJrcyA9IGF3YWl0IGxvYWRNYXJrcyh0aGlzKTtcbiAgICAgICAgdGhpcy5sYXN0Q2hhbmdlZE1hcmsgPSBhd2FpdCBsb2FkTGFzdENoYW5nZWRNYXJrKHRoaXMpO1xuXG4gICAgICAgIHRoaXMuYWRkQ29tbWFuZCh7XG4gICAgICAgICAgICBpZDogJ3NldC1tYXJrJyxcbiAgICAgICAgICAgIG5hbWU6ICdTZXQgbWFyaycsXG4gICAgICAgICAgICBjYWxsYmFjazogKCkgPT4gc2V0R2xvYmFsTWFyayh0aGlzKSxcbiAgICAgICAgfSk7XG5cblxuXG4gICAgICAgIHRoaXMuYWRkQ29tbWFuZCh7XG4gICAgICAgICAgICBpZDogJ2dvLXRvLW1hcmsnLFxuICAgICAgICAgICAgbmFtZTogJ0dvIHRvIG1hcmsnLFxuICAgICAgICAgICAgY2FsbGJhY2s6ICgpID0+IGdvVG9HbG9iYWxNYXJrKHRoaXMpLFxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmFkZENvbW1hbmQoe1xuICAgICAgICAgICAgaWQ6ICdkZWxldGUtbWFyaycsXG4gICAgICAgICAgICBuYW1lOiAnRGVsZXRlIG1hcmsnLFxuICAgICAgICAgICAgY2FsbGJhY2s6ICgpID0+IGRlbGV0ZUdsb2JhbE1hcmsodGhpcyksXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuYWRkQ29tbWFuZCh7XG4gICAgICAgICAgICBpZDogJ2FkZC1maWxlLXRvLWhhcnBvb24nLFxuICAgICAgICAgICAgbmFtZTogJ0FkZCBmaWxlIHRvIEhhcnBvb24nLFxuICAgICAgICAgICAgY2FsbGJhY2s6ICgpID0+IGFkZEZpbGVUb0hhcnBvb24odGhpcyksXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuYWRkQ29tbWFuZCh7XG4gICAgICAgICAgICBpZDogJ2dvLXRvLWhhcnBvb24tbWFyaycsXG4gICAgICAgICAgICBuYW1lOiAnR28gdG8gSGFycG9vbiBtYXJrJyxcbiAgICAgICAgICAgIGNhbGxiYWNrOiAoKSA9PiBnb1RvSGFycG9vbk1hcmsodGhpcyksXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuYWRkU2V0dGluZ1RhYihuZXcgU2V0dGluZ3NUYWIodGhpcy5hcHAsIHRoaXMpKTtcblxuICAgICAgICBjb25zb2xlLmxvZygnbG9hZGluZyAnICsgdGhpcy5tYW5pZmVzdC5pZCk7XG4gICAgfVxuXG4gICAgYXN5bmMgc2F2ZVNldHRpbmdzKCkge1xuICAgICAgICBhd2FpdCBzYXZlU2V0dGluZ3ModGhpcywgdGhpcy5zZXR0aW5ncyk7XG4gICAgfVxuXG4gICAgYXN5bmMgc2F2ZU1hcmtzKG1hcmtzOiBNYXJrW10pIHtcbiAgICAgICAgdGhpcy5tYXJrcyA9IG1hcmtzO1xuICAgICAgICBhd2FpdCBzYXZlTWFya3ModGhpcywgbWFya3MpO1xuICAgIH1cblxuICAgIGFzeW5jIHNhdmVMYXN0Q2hhbmdlZE1hcmsobGFzdENoYW5nZWRNYXJrOiBNYXJrKSB7XG4gICAgICAgIHRoaXMubGFzdENoYW5nZWRNYXJrID0gbGFzdENoYW5nZWRNYXJrO1xuICAgICAgICBhd2FpdCBzYXZlTGFzdENoYW5nZWRNYXJrKHRoaXMsIGxhc3RDaGFuZ2VkTWFyayk7XG4gICAgfVxuXG4gICAgb251bmxvYWQoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCd1bmxvYWRpbmcgJyArIHRoaXMubWFuaWZlc3QuaWQpO1xuICAgIH1cbn0iLCAiaW1wb3J0IHsgTm90aWNlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XHJcbmltcG9ydCBUZXRoZXJNYXJrc1BsdWdpbiBmcm9tIFwiLi9tYWluXCI7XHJcbmltcG9ydCB7IGRlbGV0ZU1hcmssIGZpbmRGaXJzdFVudXNlZFJlZ2lzdGVyLCBNYXJrLCByZW1vdmVHYXBzRm9ySGFycG9vbk1hcmtzLCByZXN0b3JlTGFzdENoYW5nZWRNYXJrLCBzZXROZXdPck92ZXJ3cml0ZU1hcmsgfSBmcm9tIFwidGV0aGVyLW1hcmtzLWNvcmVcIjtcclxuaW1wb3J0IHsgbmF2aWdhdGVUb09wZW5lZEZpbGVCeVBhdGgsIG9wZW5OZXdGaWxlQnlQYXRoIH0gZnJvbSBcIi4vdXRpbHMvb2JzaWRpYW5VdGlsc1wiO1xyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHBsdWdpblNldE5ld09yT3ZlcndyaXRlTWFyayhwbHVnaW46IFRldGhlck1hcmtzUGx1Z2luLCBtYXJrOiBNYXJrKSB7XHJcbiAgICBjb25zdCBmaWxlID0gcGx1Z2luLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlRmlsZSgpO1xyXG4gICAgaWYgKCFmaWxlKSB7XHJcbiAgICAgICAgbmV3IE5vdGljZSgnTm8gYWN0aXZlIGZpbGUgdG8gbWFyay4nKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBjb25zdCB7IG1hcmtzLCBvdmVyd3JpdHRlbk1hcmsgfSA9IHNldE5ld09yT3ZlcndyaXRlTWFyayhwbHVnaW4ubWFya3MsIG1hcmssIGZpbGUucGF0aCk7XHJcbiAgICBhd2FpdCBwbHVnaW4uc2F2ZU1hcmtzKG1hcmtzKTtcclxuICAgIGlmIChvdmVyd3JpdHRlbk1hcmspIHtcclxuICAgICAgICBhd2FpdCBwbHVnaW4uc2F2ZUxhc3RDaGFuZ2VkTWFyayhvdmVyd3JpdHRlbk1hcmspO1xyXG4gICAgfVxyXG4gICAgbmV3IE5vdGljZShgU2V0IG1hcmsgJyR7bWFyay5zeW1ib2x9JyB0byAke2ZpbGUubmFtZX1gKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHBsdWdpbkdvVG9NYXJrKHBsdWdpbjogVGV0aGVyTWFya3NQbHVnaW4sIG1hcms6IE1hcmspIHtcclxuICAgIGNvbnN0IHN1Y2Nlc3MgPSBuYXZpZ2F0ZVRvT3BlbmVkRmlsZUJ5UGF0aChtYXJrLmZpbGVQYXRoLCBwbHVnaW4uc2V0dGluZ3MuZXhwZXJpbWVudGFsR290bywgcGx1Z2luLmFwcCk7XHJcbiAgICAvLyBJZiBmaWxlIG5vdCBvcGVuLCB0aGVuIG9wZW4gaXQgaW4gdGhlIHByZWZlcnJlZCB0YWJcclxuICAgIGlmICghc3VjY2Vzcykge1xyXG4gICAgICAgIG9wZW5OZXdGaWxlQnlQYXRoKG1hcmsuZmlsZVBhdGgsIHBsdWdpbi5zZXR0aW5ncy5vcGVuTWFya0luTmV3VGFiLCBwbHVnaW4uYXBwKTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHBsdWdpbkRlbGV0ZU1hcmsocGx1Z2luOiBUZXRoZXJNYXJrc1BsdWdpbiwgbWFyazogTWFyaykge1xyXG4gICAgY29uc3QgeyBtYXJrcywgZGVsZXRlZE1hcmsgfSA9IGRlbGV0ZU1hcmsocGx1Z2luLm1hcmtzLCBtYXJrKTtcclxuICAgIGF3YWl0IHBsdWdpbi5zYXZlTWFya3MobWFya3MpO1xyXG5cclxuICAgIGlmIChkZWxldGVkTWFyaykge1xyXG4gICAgICAgIGF3YWl0IHBsdWdpbi5zYXZlTGFzdENoYW5nZWRNYXJrKGRlbGV0ZWRNYXJrKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAocGx1Z2luLnNldHRpbmdzLmhhcnBvb25SZWdpc3RlckdhcFJlbW92YWwpIHtcclxuICAgICAgICBwbHVnaW5SZW1vdmVHYXBzRm9ySGFycG9vbk1hcmtzKHBsdWdpbik7XHJcbiAgICB9XHJcblxyXG4gICAgbmV3IE5vdGljZShgRGVsZXRlZCBtYXJrICcke2RlbGV0ZWRNYXJrPy5zeW1ib2x9J2ApO1xyXG59O1xyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHBsdWdpblJlc3RvcmVMYXN0Q2hhbmdlZE1hcmsocGx1Z2luOiBUZXRoZXJNYXJrc1BsdWdpbikge1xyXG4gICAgLy8gVW5kbyB0aGUgbGFzdCBjaGFuZ2VkIG1hcmtcclxuICAgIGlmIChwbHVnaW4ubGFzdENoYW5nZWRNYXJrKSB7XHJcbiAgICAgICAgY29uc3Qgb3V0ID0gcmVzdG9yZUxhc3RDaGFuZ2VkTWFyayhwbHVnaW4ubWFya3MsIHBsdWdpbi5sYXN0Q2hhbmdlZE1hcmspXHJcbiAgICAgICAgYXdhaXQgcGx1Z2luLnNhdmVNYXJrcyhvdXQubWFya3MpO1xyXG4gICAgICAgIG5ldyBOb3RpY2UoYFJlc3RvcmVkIG1hcmsgJyR7cGx1Z2luLmxhc3RDaGFuZ2VkTWFyay5zeW1ib2x9JyB0byAke3BsdWdpbi5sYXN0Q2hhbmdlZE1hcmsuZmlsZVBhdGh9YCk7XHJcbiAgICAgICAgaWYgKG91dC5tYXJrVG9EaXNjYXJkKSB7XHJcbiAgICAgICAgICAgIHBsdWdpbi5zYXZlTGFzdENoYW5nZWRNYXJrKG91dC5tYXJrVG9EaXNjYXJkKTtcclxuICAgICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIG5ldyBOb3RpY2UoJ05vIGxhc3QgY2hhbmdlZCBtYXJrIHRvIHJlc3RvcmUuJyk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBwbHVnaW5BZGRGaWxlVG9IYXJwb29uKHBsdWdpbjogVGV0aGVyTWFya3NQbHVnaW4pIHtcclxuICAgIC8vIEFkZCB0aGUgc2VsZWN0ZWQgbWFyayB0byB0aGUgSGFycG9vbiBsaXN0XHJcbiAgICBjb25zdCBoYXJwb29uUmVnaXN0ZXJzID0gcGx1Z2luLnNldHRpbmdzLmhhcnBvb25SZWdpc3Rlckxpc3Quc3BsaXQoJycpO1xyXG4gICAgY29uc3QgcmVnID0gZmluZEZpcnN0VW51c2VkUmVnaXN0ZXIocGx1Z2luLm1hcmtzLCBoYXJwb29uUmVnaXN0ZXJzKTtcclxuXHJcbiAgICBpZiAocmVnKSB7XHJcbiAgICAgICAgY29uc3QgZmlsZSA9IHBsdWdpbi5hcHAud29ya3NwYWNlLmdldEFjdGl2ZUZpbGUoKTtcclxuICAgICAgICBpZiAoIWZpbGUpIHtcclxuICAgICAgICAgICAgbmV3IE5vdGljZSgnTm8gYWN0aXZlIGZpbGUgdG8gbWFyay4nKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwbHVnaW5TZXROZXdPck92ZXJ3cml0ZU1hcmsocGx1Z2luLCB7IHN5bWJvbDogcmVnLCBmaWxlUGF0aDogZmlsZS5wYXRoIH0pO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgLy8gSWYgYWxsIHJlZ2lzdGVycyBhcmUgdXNlZCwgc2hvdyBhIG5vdGljZVxyXG4gICAgICAgIG5ldyBOb3RpY2UoJ0hhcnBvb24gcmVnaXN0ZXJzIGFyZSBmdWxsLCBjYW5ub3QgYWRkIG1vcmUgbWFya3MuJyk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBwbHVnaW5SZW1vdmVHYXBzRm9ySGFycG9vbk1hcmtzKHBsdWdpbjogVGV0aGVyTWFya3NQbHVnaW4pIHtcclxuICAgIGNvbnN0IGhhcnBvb25SZWdpc3RlcnMgPSBwbHVnaW4uc2V0dGluZ3MuaGFycG9vblJlZ2lzdGVyTGlzdC5zcGxpdCgnJyk7XHJcbiAgICBjb25zdCBtYXJrcyA9IHJlbW92ZUdhcHNGb3JIYXJwb29uTWFya3MocGx1Z2luLm1hcmtzLCBoYXJwb29uUmVnaXN0ZXJzKTtcclxuICAgIGF3YWl0IHBsdWdpbi5zYXZlTWFya3MobWFya3MpO1xyXG59XHJcbiIsICJleHBvcnQgZnVuY3Rpb24gZmluZEZpcnN0VW51c2VkUmVnaXN0ZXIobWFya3MsIHJlZ2lzdGVycykge1xuICAgIGZvciAoY29uc3QgcmVnIG9mIHJlZ2lzdGVycykge1xuICAgICAgICAvLyBpZiByZWdpc3RlciBub3QgdXNlZCBhbHJlYWR5LCB0aGVuIHVzZSBpdFxuICAgICAgICAvLyBjb25zb2xlLmxvZygnQ2hlY2tpbmcgcmVnaXN0ZXI6JywgcmVnKTtcbiAgICAgICAgaWYgKCEobWFya3MubWFwKG0gPT4gbS5zeW1ib2wpLmluY2x1ZGVzKHJlZykpKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVnO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGdldE1hcmtCeVN5bWJvbChtYXJrcywgc3ltYm9sKSB7XG4gICAgcmV0dXJuIG1hcmtzLmZpbmQobSA9PiBtLnN5bWJvbCA9PT0gc3ltYm9sKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBzb3J0TWFya3NBbHBoYWJldGljYWxseShtYXJrcykge1xuICAgIG1hcmtzLnNvcnQoKGEsIGIpID0+IGEuc3ltYm9sLmxvY2FsZUNvbXBhcmUoYi5zeW1ib2wpKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBnZXRTb3J0ZWRBbmRGaWx0ZXJlZE1hcmtzKG1hcmtzLCBpc0hhcnBvb25Nb2RlLCBzZXR0aW5ncykge1xuICAgIGNvbnN0IGF2YWlsYWJsZVJlZ2lzdGVycyA9IG5ldyBTZXQoKCFpc0hhcnBvb25Nb2RlID8gc2V0dGluZ3MucmVnaXN0ZXJMaXN0IDogc2V0dGluZ3MuaGFycG9vblJlZ2lzdGVyTGlzdCkuc3BsaXQoJycpKTtcbiAgICBjb25zdCBmaWx0ZXJlZE1hcmtzID0gbWFya3MuZmlsdGVyKGVsID0+IGF2YWlsYWJsZVJlZ2lzdGVycy5oYXMoZWwuc3ltYm9sKSk7XG4gICAgaWYgKCFpc0hhcnBvb25Nb2RlICYmIHNldHRpbmdzLnJlZ2lzdGVyU29ydEJ5TGlzdCkge1xuICAgICAgICAvLyBTb3J0IG1hcmtzIGJ5IHRoZSBvcmRlciBvZiB0aGUga2V5IHN5bWJvbHMgaW4gdGhlIHJlZ2lzdGVyIGxpc3RcbiAgICAgICAgY29uc3QgcmVnaXN0ZXJMaXN0ID0gc2V0dGluZ3MucmVnaXN0ZXJMaXN0O1xuICAgICAgICBzb3J0TWFya3NCeVNldHRpbmdzUmVnaXN0ZXJPcmRlcihmaWx0ZXJlZE1hcmtzLCByZWdpc3Rlckxpc3QpO1xuICAgIH1cbiAgICBlbHNlIGlmIChpc0hhcnBvb25Nb2RlICYmIHNldHRpbmdzLmhhcnBvb25SZWdpc3RlclNvcnRCeUxpc3QpIHtcbiAgICAgICAgLy8gU29ydCBtYXJrcyBieSB0aGUgb3JkZXIgb2YgdGhlIGtleSBzeW1ib2xzIGluIHRoZSBoYXJwb29uIHJlZ2lzdGVyIGxpc3RcbiAgICAgICAgY29uc3QgcmVnaXN0ZXJMaXN0ID0gc2V0dGluZ3MuaGFycG9vblJlZ2lzdGVyTGlzdDtcbiAgICAgICAgc29ydE1hcmtzQnlTZXR0aW5nc1JlZ2lzdGVyT3JkZXIoZmlsdGVyZWRNYXJrcywgcmVnaXN0ZXJMaXN0KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHNvcnRNYXJrc0FscGhhYmV0aWNhbGx5KGZpbHRlcmVkTWFya3MpO1xuICAgIH1cbiAgICByZXR1cm4gZmlsdGVyZWRNYXJrcztcbn1cbmV4cG9ydCBmdW5jdGlvbiBzb3J0TWFya3NCeVNldHRpbmdzUmVnaXN0ZXJPcmRlcihtYXJrcywgcmVnaXN0ZXJzKSB7XG4gICAgY29uc3QgcmVnaXN0ZXJPcmRlciA9IG5ldyBNYXAoWy4uLnJlZ2lzdGVyc10ubWFwKChzeW1ib2wsIGluZGV4KSA9PiBbc3ltYm9sLCBpbmRleF0pKTtcbiAgICBtYXJrcy5zb3J0KChhLCBiKSA9PiB7IHZhciBfYSwgX2I7IHJldHVybiAoKF9hID0gcmVnaXN0ZXJPcmRlci5nZXQoYS5zeW1ib2wpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBJbmZpbml0eSkgLSAoKF9iID0gcmVnaXN0ZXJPcmRlci5nZXQoYi5zeW1ib2wpKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiBJbmZpbml0eSk7IH0pO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHJlbW92ZUdhcHNGb3JIYXJwb29uTWFya3MobWFya3NUb0NvcHksIGhhcnBvb25SZWdpc3RlcnMpIHtcbiAgICBsZXQgbWFya3MgPSBbLi4ubWFya3NUb0NvcHldO1xuICAgIGxldCBsZWZ0Q3VyID0gMDtcbiAgICBsZXQgcmlnaHRDdXIgPSAwO1xuICAgIHdoaWxlIChyaWdodEN1ciA8IGhhcnBvb25SZWdpc3RlcnMubGVuZ3RoKSB7XG4gICAgICAgIGNvbnN0IG1hcmtFbCA9IG1hcmtzLmZpbmQoZWwgPT4gZWwuc3ltYm9sID09PSBoYXJwb29uUmVnaXN0ZXJzW3JpZ2h0Q3VyXSk7XG4gICAgICAgIGlmIChtYXJrRWwgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgY29uc3Qgc3ltYm9sVG9TZXRUbyA9IGhhcnBvb25SZWdpc3RlcnNbbGVmdEN1cl07XG4gICAgICAgICAgICBsZXQgZmlsdGVyZWRNYXJrcyA9IG1hcmtzLmZpbHRlcihlbCA9PiBlbC5zeW1ib2wgIT09IGhhcnBvb25SZWdpc3RlcnNbbGVmdEN1cl0pO1xuICAgICAgICAgICAgZmlsdGVyZWRNYXJrcy5wdXNoKHsgc3ltYm9sOiBzeW1ib2xUb1NldFRvLCBmaWxlUGF0aDogbWFya0VsLmZpbGVQYXRoIH0pO1xuICAgICAgICAgICAgbWFya3MgPSBmaWx0ZXJlZE1hcmtzO1xuICAgICAgICAgICAgbGVmdEN1ciArPSAxO1xuICAgICAgICB9XG4gICAgICAgIHJpZ2h0Q3VyICs9IDE7XG4gICAgfVxuICAgIHdoaWxlIChsZWZ0Q3VyIDwgaGFycG9vblJlZ2lzdGVycy5sZW5ndGgpIHtcbiAgICAgICAgbWFya3MgPSBtYXJrcy5maWx0ZXIoZWwgPT4gZWwuc3ltYm9sICE9PSBoYXJwb29uUmVnaXN0ZXJzW2xlZnRDdXJdKTtcbiAgICAgICAgbGVmdEN1ciArPSAxO1xuICAgIH1cbiAgICByZXR1cm4gbWFya3M7XG59XG5leHBvcnQgZnVuY3Rpb24gcmVzdG9yZUxhc3RDaGFuZ2VkTWFyayhtYXJrcywgbGFzdENoYW5nZWRNYXJrKSB7XG4gICAgY29uc3QgbWFya1RvUmVzdG9yZSA9IHsgLi4ubGFzdENoYW5nZWRNYXJrIH07XG4gICAgY29uc3QgbWFya1RvRGlzY2FyZCA9IG1hcmtzLmZpbmQobSA9PiBtLnN5bWJvbCA9PT0gbWFya1RvUmVzdG9yZS5zeW1ib2wpO1xuICAgIGNvbnN0IG1hcmtzV2l0aG91dERpc2NhcmRlZCA9IG1hcmtzLmZpbHRlcihtID0+IG0uc3ltYm9sICE9PSBtYXJrVG9SZXN0b3JlLnN5bWJvbCk7XG4gICAgbWFya3NXaXRob3V0RGlzY2FyZGVkLnB1c2goeyBzeW1ib2w6IG1hcmtUb1Jlc3RvcmUuc3ltYm9sLCBmaWxlUGF0aDogbWFya1RvUmVzdG9yZS5maWxlUGF0aCB9KTtcbiAgICByZXR1cm4geyBtYXJrczogbWFya3NXaXRob3V0RGlzY2FyZGVkLCBtYXJrVG9EaXNjYXJkOiBtYXJrVG9EaXNjYXJkIH07XG59XG5leHBvcnQgZnVuY3Rpb24gc2V0TmV3T3JPdmVyd3JpdGVNYXJrKG1hcmtzLCBzZXRNYXJrLCBmaWxlUGF0aCkge1xuICAgIGNvbnN0IHsgbWFya3M6IGZpbHRlcmVkTWFya3MsIGRlbGV0ZWRNYXJrOiBvdmVyd3JpdHRlbk1hcmsgfSA9IGRlbGV0ZU1hcmsobWFya3MsIHNldE1hcmspO1xuICAgIGZpbHRlcmVkTWFya3MucHVzaCh7IHN5bWJvbDogc2V0TWFyay5zeW1ib2wsIGZpbGVQYXRoOiBmaWxlUGF0aCB9KTtcbiAgICByZXR1cm4geyBtYXJrczogZmlsdGVyZWRNYXJrcywgb3ZlcndyaXR0ZW5NYXJrIH07XG59XG5leHBvcnQgZnVuY3Rpb24gZGVsZXRlTWFyayhtYXJrcywgbWFya1RvRGVsZXRlKSB7XG4gICAgY29uc3QgY01hcmsgPSB7IC4uLm1hcmtUb0RlbGV0ZSB9O1xuICAgIGNvbnN0IGRlbGV0ZWRNYXJrID0gbWFya3MuZmluZChtID0+IG0uc3ltYm9sID09PSBjTWFyay5zeW1ib2wpO1xuICAgIGNvbnN0IGZpbHRlcmVkTWFya3MgPSBtYXJrcy5maWx0ZXIobSA9PiBtLnN5bWJvbCAhPT0gY01hcmsuc3ltYm9sKTtcbiAgICByZXR1cm4geyBtYXJrczogZmlsdGVyZWRNYXJrcywgZGVsZXRlZE1hcmsgfTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBpc01hcmtJbkxpc3QobWFya3MsIG1hcmspIHtcbiAgICByZXR1cm4gbWFya3Muc29tZShtID0+IG0uc3ltYm9sID09PSBtYXJrLnN5bWJvbCAmJiBtLmZpbGVQYXRoID09PSBtYXJrLmZpbGVQYXRoKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBpc01hcmtJbkxpc3RCeVN5bWJvbChtYXJrcywgc3ltYm9sKSB7XG4gICAgcmV0dXJuIG1hcmtzLnNvbWUobSA9PiBtLnN5bWJvbCA9PT0gc3ltYm9sKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBpc01hcmtJbkxpc3RCeUZpbGVQYXRoKG1hcmtzLCBmaWxlUGF0aCkge1xuICAgIHJldHVybiBtYXJrcy5zb21lKG0gPT4gbS5maWxlUGF0aCA9PT0gZmlsZVBhdGgpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGdvdG9NYXJrTmV4dChtYXJrcywgcmVnaXN0ZXJzLCBjdXJyZW50TWFyaykge1xuICAgIGNvbnN0IHNvcnRlZE1hcmtzID0gWy4uLm1hcmtzXTtcbiAgICBzb3J0TWFya3NCeVNldHRpbmdzUmVnaXN0ZXJPcmRlcihzb3J0ZWRNYXJrcywgcmVnaXN0ZXJzKTtcbiAgICBjb25zdCBjdXJyZW50SW5kZXggPSBzb3J0ZWRNYXJrcy5maW5kSW5kZXgobSA9PiBtLnN5bWJvbCA9PT0gY3VycmVudE1hcmsuc3ltYm9sICYmIG0uZmlsZVBhdGggPT09IGN1cnJlbnRNYXJrLmZpbGVQYXRoKTtcbiAgICBpZiAoY3VycmVudEluZGV4ID09PSAtMSB8fCBjdXJyZW50SW5kZXggPT09IG1hcmtzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsgLy8gTm8gbmV4dCBtYXJrXG4gICAgfVxuICAgIHJldHVybiBzb3J0ZWRNYXJrc1tjdXJyZW50SW5kZXggKyAxXTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBnb3RvTWFya1ByZXZpb3VzKG1hcmtzLCByZWdpc3RlcnMsIGN1cnJlbnRNYXJrKSB7XG4gICAgY29uc3Qgc29ydGVkTWFya3MgPSBbLi4ubWFya3NdO1xuICAgIHNvcnRNYXJrc0J5U2V0dGluZ3NSZWdpc3Rlck9yZGVyKHNvcnRlZE1hcmtzLCByZWdpc3RlcnMpO1xuICAgIGNvbnN0IGN1cnJlbnRJbmRleCA9IHNvcnRlZE1hcmtzLmZpbmRJbmRleChtID0+IG0uc3ltYm9sID09PSBjdXJyZW50TWFyay5zeW1ib2wgJiYgbS5maWxlUGF0aCA9PT0gY3VycmVudE1hcmsuZmlsZVBhdGgpO1xuICAgIGlmIChjdXJyZW50SW5kZXggPD0gMCkge1xuICAgICAgICByZXR1cm4gdW5kZWZpbmVkOyAvLyBObyBwcmV2aW91cyBtYXJrXG4gICAgfVxuICAgIHJldHVybiBtYXJrc1tjdXJyZW50SW5kZXggLSAxXTtcbn1cbiIsICIvLyBUaGlzIGlzIG5vdCB1c2VkIGZvciBub3dcbmV4cG9ydCBjb25zdCBtb2RhbFBsYWNlaG9sZGVyTWVzc2FnZXMgPSB7XG4gICAgc2V0OiAnU2VsZWN0IGEgbWFyayB0byBzZXQnLFxuICAgIGdvdG86ICdTZWxlY3QgYSBtYXJrIHRvIGdvIHRvJyxcbiAgICBkZWxldGU6ICdTZWxlY3QgYSBtYXJrIHRvIGRlbGV0ZScsXG59O1xuZXhwb3J0IGNvbnN0IGRlZmF1bHRCYXNpY01hcmtzU2V0dGluZ3MgPSB7XG4gICAgcmVnaXN0ZXJMaXN0OiAnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXonLFxuICAgIHJlZ2lzdGVyU29ydEJ5TGlzdDogdHJ1ZSxcbiAgICBoYXJwb29uUmVnaXN0ZXJMaXN0OiAncXdlcicsXG4gICAgaGFycG9vblJlZ2lzdGVyU29ydEJ5TGlzdDogdHJ1ZSxcbiAgICBoYXJwb29uUmVnaXN0ZXJHYXBSZW1vdmFsOiB0cnVlLFxufTtcbmV4cG9ydCBjb25zdCBtb2RlRGVzY3JpcHRpb24gPSB7XG4gICAgJ3NldCc6ICdTZXQgbWFyaycsXG4gICAgJ2dvdG8nOiAnR28gdG8gbWFyaycsXG4gICAgJ2RlbGV0ZSc6ICdEZWxldGUgbWFyaydcbn07XG4iLCAiaW1wb3J0IHsgQXBwLCBub3JtYWxpemVQYXRoLCBOb3RpY2UsIFRGaWxlLCBXb3Jrc3BhY2VMZWFmIH0gZnJvbSBcIm9ic2lkaWFuXCI7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gb3Blbk5ld0ZpbGVCeVBhdGgoZmlsZVBhdGg6IHN0cmluZywgb3BlbkZpbGVJbk5ld1RhYjogYm9vbGVhbiwgYXBwOiBBcHApIHtcclxuICAgIGNvbnN0IGZpbGUgPSBhcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGZpbGVQYXRoKTtcclxuICAgIGlmIChmaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcclxuICAgICAgICBpZiAob3BlbkZpbGVJbk5ld1RhYikge1xyXG4gICAgICAgICAgICBhcHAud29ya3NwYWNlLmdldExlYWYoJ3RhYicpLm9wZW5GaWxlKGZpbGUpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGFwcC53b3Jrc3BhY2UuZ2V0TGVhZigpLm9wZW5GaWxlKGZpbGUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIG5ldyBOb3RpY2UoYEZpbGUgbm90IGZvdW5kIGZvciBwYXRoICR7ZmlsZVBhdGh9LiBUaGUgZmlsZSBtYXkgaGF2ZSBiZWVuIGRlbGV0ZWQsIG1vdmVkIG9yIHJlbmFtZWQuYCk7XHJcbiAgICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBGaW5kcyBhbGwgb3BlbmVkIGZpbGVzIGluIHRoZSBtYWluIGFyZWEgdGhyb3VnaCB3b3Jrc3BhY2UuZ2V0TGF5b3V0KCkuIE5vdCBBUEkgY29tcGxpYW50LiBDYW4gYnJlYWsgYW55dGltZS4gR2V0cyBhbGwgb3BlbmVkIGZpbGVzIHJlZ2FyZGxlc3Mgb2Ygc3RhdGUuIFxyXG4gKiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZ2V0QWxsT3BlbmVkRmlsZXNFeHBlcmltZW50YWwoYXBwOiBBcHApOiBhbnkge1xyXG4gICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgY29uc3QgdGFiR3JvdXBzID0gYXBwLndvcmtzcGFjZS5nZXRMYXlvdXQoKS5tYWluPy5jaGlsZHJlbjtcclxuICAgIGNvbnN0IG91dCA9IFtdO1xyXG4gICAgZm9yIChjb25zdCBlbCBvZiB0YWJHcm91cHMpIHtcclxuICAgICAgICBvdXQucHVzaCguLi5lbC5jaGlsZHJlbilcclxuICAgIH1cclxuICAgIHJldHVybiBvdXQ7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBGaW5kcyBhbGwgd29ya3NwYWNlIGxlYXZlcyB0aHJvdWdoIHdvcmtzcGFjZS5pdGVyYXRlQWxsTGVhdmVzLiBBUEkgY29tcGxpYW50LiBJZ25vcmVzIGFsbCB0aGUgbm9uIGluc3RhbnRpYXRlZCBsZWF2ZXMuXHJcbiAqICovXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRBbGxXb3Jrc3BhY2VMZWF2ZXMoYXBwOiBBcHApOiBXb3Jrc3BhY2VMZWFmW10ge1xyXG4gICAgY29uc3QgbGlzdDogV29ya3NwYWNlTGVhZltdID0gW11cclxuICAgIGFwcC53b3Jrc3BhY2UuaXRlcmF0ZUFsbExlYXZlcyhsZWFmID0+IHtcclxuICAgICAgICBsaXN0LnB1c2gobGVhZik7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gbGlzdDtcclxufVxyXG5cclxuLyoqXHJcbiAqIFNldHMgYWN0aXZlIGFuIG9wZW5lZCBmaWxlIHRoYXQgbWF0Y2hlcyB0aGUgaW5wdXQgZmlsZSBwYXRoLiBSZXNwZWN0cyB0YWIgZ3JvdXBpbmcuIFJldHVybnMgc3VjY2VzcyBib29sLiAgXHJcbiAqIEBwdWJsaWNcclxuICogKi9cclxuZXhwb3J0IGZ1bmN0aW9uIG5hdmlnYXRlVG9PcGVuZWRGaWxlQnlQYXRoKGZpbGVQYXRoOiBzdHJpbmcsIGV4cGVyaW1lbnRhbEdvdG86IGJvb2xlYW4sIGFwcDogQXBwKTogYm9vbGVhbiB7XHJcbiAgICBpZiAoZXhwZXJpbWVudGFsR290bykge1xyXG4gICAgICAgIGNvbnN0IG9wZW5lZEZpbGVzID0gZ2V0QWxsT3BlbmVkRmlsZXNFeHBlcmltZW50YWwoYXBwKVxyXG4gICAgICAgIGZvciAoY29uc3Qgb3BlbmVkRmlsZSBvZiBvcGVuZWRGaWxlcykge1xyXG4gICAgICAgICAgICBpZiAob3BlbmVkRmlsZS50eXBlID09ICdsZWFmJyAmJiBvcGVuZWRGaWxlLnN0YXRlLnN0YXRlLmZpbGUgPT09IGZpbGVQYXRoKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBsZWFmID0gYXBwLndvcmtzcGFjZS5nZXRMZWFmQnlJZChvcGVuZWRGaWxlLmlkKTtcclxuICAgICAgICAgICAgICAgIGlmIChsZWFmICYmIGxlYWYucGFyZW50ID09PSBhcHAud29ya3NwYWNlLmdldExlYWYoKS5wYXJlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBhcHAud29ya3NwYWNlLnNldEFjdGl2ZUxlYWYobGVhZiwgeyBmb2N1czogdHJ1ZSB9KTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIGNvbnN0IGxlYXZlcyA9IGdldEFsbFdvcmtzcGFjZUxlYXZlcyhhcHApO1xyXG4gICAgICAgIGZvciAoY29uc3QgbGVhZiBvZiBsZWF2ZXMpIHtcclxuICAgICAgICAgICAgY29uc3QgdmlldyA9IGxlYWYudmlldztcclxuICAgICAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvclxyXG4gICAgICAgICAgICBpZiAodmlldy5maWxlICYmIHZpZXcuZmlsZS5wYXRoID09PSBmaWxlUGF0aCAmJiBsZWFmLnBhcmVudCA9PT0gYXBwLndvcmtzcGFjZS5nZXRMZWFmKCkucGFyZW50KSB7XHJcbiAgICAgICAgICAgICAgICBhcHAud29ya3NwYWNlLnNldEFjdGl2ZUxlYWYobGVhZiwgeyBmb2N1czogdHJ1ZSB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBmYWxzZTtcclxufSIsICJpbXBvcnQgeyBBcHAsIFN1Z2dlc3RNb2RhbCwgUGxhdGZvcm0sIEluc3RydWN0aW9uIH0gZnJvbSAnb2JzaWRpYW4nO1xuaW1wb3J0IFRldGhlck1hcmtzUGx1Z2luIGZyb20gJy4uL21haW4nO1xuaW1wb3J0IHsgbW9kYWxNYXJrRmlsZXBhdGhDbGFzcywgbW9kYWxNYXJrU3ltYm9sQ2xhc3MsIG1vZGFsTWFya0hhcnBvb25TaWduIH0gZnJvbSAnLi4vdXRpbHMvZGVmYXVsdFZhbHVlcyc7XG5pbXBvcnQgeyBtYXRjaEtleWJpbmQsIHByZXBhcmVLZXliaW5kcyB9IGZyb20gJy4uL3V0aWxzL2tleWJpbmRzJztcbmltcG9ydCB7IHBsdWdpbkRlbGV0ZU1hcmssIHBsdWdpbkdvVG9NYXJrLCBwbHVnaW5SZXN0b3JlTGFzdENoYW5nZWRNYXJrLCBwbHVnaW5TZXROZXdPck92ZXJ3cml0ZU1hcmsgfSBmcm9tICcuLi9wbHVnaW5PcGVyYXRpb25zJztcbmltcG9ydCB7IGdldE1hcmtCeVN5bWJvbCwgZ2V0U29ydGVkQW5kRmlsdGVyZWRNYXJrcywgTWFyaywgTW9kZSwgbW9kZURlc2NyaXB0aW9uIH0gZnJvbSAndGV0aGVyLW1hcmtzLWNvcmUnO1xuaW1wb3J0IHsgTW9kYWxLZXliaW5kcyB9IGZyb20gJy4uL3R5cGVzJztcblxuXG5leHBvcnQgY2xhc3MgTWFya0xpc3RNb2RhbCBleHRlbmRzIFN1Z2dlc3RNb2RhbDxNYXJrPiB7XG4gICAgcGx1Z2luOiBUZXRoZXJNYXJrc1BsdWdpbjtcbiAgICBtb2RlOiBNb2RlO1xuICAgIHByaXZhdGUgX2tleUhhbmRsZXI/OiAoZXZ0OiBLZXlib2FyZEV2ZW50KSA9PiB2b2lkO1xuICAgIGlzSGFycG9vbk1vZGU6IGJvb2xlYW47XG5cbiAgICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBUZXRoZXJNYXJrc1BsdWdpbiwgbW9kZTogTW9kZSwgaXNIYXJwb29uTW9kZTogYm9vbGVhbiA9IGZhbHNlKSB7XG4gICAgICAgIHN1cGVyKGFwcCk7XG4gICAgICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgICAgICB0aGlzLm1vZGUgPSBtb2RlO1xuICAgICAgICAvLyBub3QgdXNlZCwgbm8gaW5wdXQgZmllbGRcbiAgICAgICAgLy8gdGhpcy5zZXRQbGFjZWhvbGRlcihtb2RhbFBsYWNlaG9sZGVyTWVzc2FnZXNbdGhpcy5tb2RlXSk7XG4gICAgICAgIHRoaXMuaXNIYXJwb29uTW9kZSA9IGlzSGFycG9vbk1vZGU7XG4gICAgfVxuXG4gICAgZ2V0SW5zdHJ1Y3Rpb25zKG1vZGFsS2V5YmluZHM6IE1vZGFsS2V5YmluZHMpOiBJbnN0cnVjdGlvbltdIHtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIHsgY29tbWFuZDogbW9kYWxLZXliaW5kcy51cC5qb2luKFwiL1wiKSwgcHVycG9zZTogJ1VwJyB9LFxuICAgICAgICAgICAgeyBjb21tYW5kOiBtb2RhbEtleWJpbmRzLmRvd24uam9pbihcIi9cIiksIHB1cnBvc2U6ICdEb3duJyB9LFxuICAgICAgICAgICAgeyBjb21tYW5kOiAnW1N5bWJvbF0nLCBwdXJwb3NlOiBtb2RlRGVzY3JpcHRpb25bdGhpcy5tb2RlXSB9LFxuICAgICAgICAgICAgeyBjb21tYW5kOiBtb2RhbEtleWJpbmRzLnNlbGVjdC5qb2luKFwiL1wiKSwgcHVycG9zZTogbW9kZURlc2NyaXB0aW9uW3RoaXMubW9kZV0gfSxcbiAgICAgICAgICAgIHsgY29tbWFuZDogbW9kYWxLZXliaW5kcy5kZWxldGUuam9pbihcIi9cIiksIHB1cnBvc2U6ICdEZWxldGUnIH0sXG4gICAgICAgICAgICB7IGNvbW1hbmQ6IG1vZGFsS2V5YmluZHMuY2FuY2VsLmpvaW4oXCIvXCIpLCBwdXJwb3NlOiAnQ2FuY2VsJyB9LFxuICAgICAgICAgICAgeyBjb21tYW5kOiBtb2RhbEtleWJpbmRzLnVuZG8uam9pbihcIi9cIiksIHB1cnBvc2U6ICdVbmRvJyB9LFxuXG4gICAgICAgIF07XG4gICAgfVxuXG4gICAgZ2V0U3VnZ2VzdGlvbnMocXVlcnk6IHN0cmluZyk6IE1hcmtbXSB7XG4gICAgICAgIC8vIE5vIHNlYXJjaCBpbnB1dFxuICAgICAgICByZXR1cm4gZ2V0U29ydGVkQW5kRmlsdGVyZWRNYXJrcyh0aGlzLnBsdWdpbi5tYXJrcywgdGhpcy5pc0hhcnBvb25Nb2RlLCB0aGlzLnBsdWdpbi5zZXR0aW5ncyk7XG4gICAgfVxuXG4gICAgcmVuZGVyU3VnZ2VzdGlvbihtYXJrOiBNYXJrLCBlbDogSFRNTEVsZW1lbnQpIHtcbiAgICAgICAgY29uc3Qgc3ltYm9sRWwgPSBlbC5jcmVhdGVFbCgnc3BhbicsIHsgdGV4dDogbWFyay5zeW1ib2wsIGNsczogbW9kYWxNYXJrU3ltYm9sQ2xhc3MgfSk7XG4gICAgICAgIGVsLmNyZWF0ZUVsKCdzcGFuJywgeyB0ZXh0OiBtYXJrLmZpbGVQYXRoLCBjbHM6IG1vZGFsTWFya0ZpbGVwYXRoQ2xhc3MgfSk7XG4gICAgICAgIGlmICh0aGlzLnBsdWdpbi5zZXR0aW5ncy5oYXJwb29uUmVnaXN0ZXJMaXN0LmNvbnRhaW5zKG1hcmsuc3ltYm9sKSkge1xuICAgICAgICAgICAgZWwuY3JlYXRlRWwoJ3NwYW4nLCB7IHRleHQ6IFwiSFwiLCBjbHM6IG1vZGFsTWFya0hhcnBvb25TaWduIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlRmlsZSgpPy5wYXRoID09PSBtYXJrLmZpbGVQYXRoKXtcbiAgICAgICAgICAgIHN5bWJvbEVsLmFkZENsYXNzKCdoaWdobGlnaHQnKTtcbiAgICAgICAgfVxuICAgICAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jIChldnQpID0+IHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMub25DaG9vc2VTdWdnZXN0aW9uKG1hcmssIGV2dCk7XG4gICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIG9uT3BlbigpIHtcbiAgICAgICAgc3VwZXIub25PcGVuKCk7XG4gICAgICAgIC8vIEhpZGUgdGhlIGlucHV0IGJveCwgYXMgaXQncyBub3QgbmVlZGVkXG4gICAgICAgIGlmICh0aGlzLmlucHV0RWwpIHtcbiAgICAgICAgICAgIHRoaXMuaW5wdXRFbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubW9kYWxFbC5hZGRDbGFzcygnbWFya3MtbW9kYWwnKTtcblxuICAgICAgICBjb25zdCBtb2RhbEtleWJpbmRzID0gcHJlcGFyZUtleWJpbmRzKFBsYXRmb3JtLmlzTWFjT1MsIHRoaXMucGx1Z2luLnNldHRpbmdzKTtcbiAgICAgICAgdGhpcy5zZXRJbnN0cnVjdGlvbnModGhpcy5nZXRJbnN0cnVjdGlvbnMobW9kYWxLZXliaW5kcykpO1xuXG4gICAgICAgIHRoaXMuX2tleUhhbmRsZXIgPSB0aGlzLmdldE1vZGFsS2V5SGFuZGxlcihtb2RhbEtleWJpbmRzKTtcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLl9rZXlIYW5kbGVyLCB0cnVlKTtcbiAgICB9XG5cbiAgICBvbkNsb3NlKCkge1xuICAgICAgICBpZiAodGhpcy5fa2V5SGFuZGxlcikge1xuICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLl9rZXlIYW5kbGVyLCB0cnVlKTtcbiAgICAgICAgICAgIHRoaXMuX2tleUhhbmRsZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgICAgc3VwZXIub25DbG9zZSgpO1xuICAgIH1cblxuICAgIGdldE1vZGFsS2V5SGFuZGxlcihrZXliaW5kczogTW9kYWxLZXliaW5kcykge1xuICAgICAgICByZXR1cm4gYXN5bmMgKGV2dDogS2V5Ym9hcmRFdmVudCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgYXZhaWxhYmxlUmVnaXN0ZXJzID0gbmV3IFNldCgoIXRoaXMuaXNIYXJwb29uTW9kZSA/IHRoaXMucGx1Z2luLnNldHRpbmdzLnJlZ2lzdGVyTGlzdCA6IHRoaXMucGx1Z2luLnNldHRpbmdzLmhhcnBvb25SZWdpc3Rlckxpc3QpLnNwbGl0KCcnKSk7XG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICBjb25zdCBjaG9vc2VyID0gdGhpcy5jaG9vc2VyO1xuICAgICAgICAgICAgaWYgKGtleWJpbmRzLnVwLnNvbWUoa2IgPT4gbWF0Y2hLZXliaW5kKGV2dCwga2IpKSkge1xuICAgICAgICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIHRoaXMubW92ZVNlbGVjdGlvbigtMSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGtleWJpbmRzLmRvd24uc29tZShrYiA9PiBtYXRjaEtleWJpbmQoZXZ0LCBrYikpKSB7XG4gICAgICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5tb3ZlU2VsZWN0aW9uKDEpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChrZXliaW5kcy5kZWxldGUuc29tZShrYiA9PiBtYXRjaEtleWJpbmQoZXZ0LCBrYikpKSB7XG4gICAgICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgaWYgKGNob29zZXIudmFsdWVzKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIERlbGV0ZSB0aGUgY3VycmVudGx5IHNlbGVjdGVkIG1hcmtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJldklkeCA9IGNob29zZXIuc2VsZWN0ZWRJdGVtO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RlZDogTWFyayA9IGNob29zZXIudmFsdWVzW3ByZXZJZHhdO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHBsdWdpbkRlbGV0ZU1hcmsodGhpcy5wbHVnaW4sIHNlbGVjdGVkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlZnJlc2ggdGhlIG1vZGFsIGxpc3RcbiAgICAgICAgICAgICAgICAgICAgICAgIGNob29zZXIudmFsdWVzID0gZ2V0U29ydGVkQW5kRmlsdGVyZWRNYXJrcyh0aGlzLnBsdWdpbi5tYXJrcywgdGhpcy5pc0hhcnBvb25Nb2RlLCB0aGlzLnBsdWdpbi5zZXR0aW5ncyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjaG9vc2VyLnNldFN1Z2dlc3Rpb25zKGNob29zZXIudmFsdWVzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFByZXNlcnZlIHNlbGVjdGlvbiBpbmRleFxuICAgICAgICAgICAgICAgICAgICAgICAgY2hvb3Nlci5zZXRTZWxlY3RlZEl0ZW0oTWF0aC5tYXgoMCwgTWF0aC5taW4ocHJldklkeCwgY2hvb3Nlci52YWx1ZXMubGVuZ3RoLTEpKSwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoa2V5YmluZHMudW5kby5zb21lKGtiID0+IG1hdGNoS2V5YmluZChldnQsIGtiKSkpIHtcbiAgICAgICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAvLyBSZXN0b3JlIHRoZSBsYXN0IGNoYW5nZWQgbWFya1xuICAgICAgICAgICAgICAgIGF3YWl0IHBsdWdpblJlc3RvcmVMYXN0Q2hhbmdlZE1hcmsodGhpcy5wbHVnaW4pO1xuICAgICAgICAgICAgICAgIC8vIFJlZnJlc2ggdGhlIG1vZGFsIGxpc3RcbiAgICAgICAgICAgICAgICBjaG9vc2VyLnZhbHVlcyA9IGdldFNvcnRlZEFuZEZpbHRlcmVkTWFya3ModGhpcy5wbHVnaW4ubWFya3MsIHRoaXMuaXNIYXJwb29uTW9kZSwgdGhpcy5wbHVnaW4uc2V0dGluZ3MpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHByZXZJZHggPSBjaG9vc2VyLnNlbGVjdGVkSXRlbTtcbiAgICAgICAgICAgICAgICBjaG9vc2VyLnNldFN1Z2dlc3Rpb25zKGNob29zZXIudmFsdWVzKTtcbiAgICAgICAgICAgICAgICBjaG9vc2VyLnNldFNlbGVjdGVkSXRlbShNYXRoLm1heCgwLCBwcmV2SWR4KSwgZmFsc2UpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChrZXliaW5kcy5zZWxlY3Quc29tZShrYiA9PiBtYXRjaEtleWJpbmQoZXZ0LCBrYikpKSB7XG4gICAgICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgLy8gRGVsZXRlIHRoZSBjdXJyZW50bHkgc2VsZWN0ZWQgbWFya1xuICAgICAgICAgICAgICAgIGNvbnN0IGluZCA9IGNob29zZXIuc2VsZWN0ZWRJdGVtO1xuICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkOiBNYXJrID0gY2hvb3Nlci52YWx1ZXNbaW5kXTtcbiAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkNob29zZVN1Z2dlc3Rpb24oc2VsZWN0ZWQsIGV2dCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGtleWJpbmRzLmNhbmNlbC5zb21lKGtiID0+IG1hdGNoS2V5YmluZChldnQsIGtiKSkpIHtcbiAgICAgICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGF2YWlsYWJsZVJlZ2lzdGVycy5oYXMoZXZ0LmtleSkpIHtcbiAgICAgICAgICAgICAgICBsZXQgbWFyayA9IGdldE1hcmtCeVN5bWJvbCh0aGlzLnBsdWdpbi5tYXJrcywgZXZ0LmtleSk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubW9kZSA9PT0gJ3NldCcpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1hcmsgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWFyayA9IHsgc3ltYm9sOiBldnQua2V5LCBmaWxlUGF0aDogXCJcIiB9O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLm9uQ2hvb3NlU3VnZ2VzdGlvbihtYXJrLCBldnQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLm1vZGUgPT09ICdnb3RvJyAmJiBtYXJrKSB7XG4gICAgICAgICAgICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLm9uQ2hvb3NlU3VnZ2VzdGlvbihtYXJrLCBldnQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMubW9kZSA9PT0gJ2RlbGV0ZScgJiYgbWFyaykge1xuICAgICAgICAgICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5vbkNob29zZVN1Z2dlc3Rpb24obWFyaywgZXZ0KTtcbiAgICAgICAgICAgICAgICAgICAgLy8gUmVmcmVzaCB0aGUgbW9kYWwgbGlzdFxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cblxuICAgIGFzeW5jIG9uQ2hvb3NlU3VnZ2VzdGlvbihtYXJrOiBNYXJrLCBldnQ6IE1vdXNlRXZlbnQgfCBLZXlib2FyZEV2ZW50KSB7XG4gICAgICAgIGlmICh0aGlzLm1vZGUgPT09ICdzZXQnKSB7XG4gICAgICAgICAgICBwbHVnaW5TZXROZXdPck92ZXJ3cml0ZU1hcmsodGhpcy5wbHVnaW4sIG1hcmspO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMubW9kZSA9PT0gJ2dvdG8nKSB7XG4gICAgICAgICAgICBwbHVnaW5Hb1RvTWFyayh0aGlzLnBsdWdpbiwgbWFyayk7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5tb2RlID09PSAnZGVsZXRlJykge1xuICAgICAgICAgICAgcGx1Z2luRGVsZXRlTWFyayh0aGlzLnBsdWdpbiwgbWFyayk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBtb3ZlU2VsZWN0aW9uKGRlbHRhOiBudW1iZXIpIHtcbiAgICAgICAgLy8gTW92ZSB0aGUgc2VsZWN0aW9uIHVwIG9yIGRvd24gYnkgZGVsdGFcbiAgICAgICAgLy8gdGhpcy5jaG9vc2VyIGlzIFN1Z2dlc3RNb2RhbCdzIGludGVybmFsIGNob29zZXJcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICBjb25zdCBjaG9vc2VyID0gdGhpcy5jaG9vc2VyO1xuICAgICAgICBpZiAoIWNob29zZXIpIHJldHVybjtcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICBsZXQgaWR4ID0gY2hvb3Nlci5zZWxlY3RlZEl0ZW07XG4gICAgICAgIGlmICh0eXBlb2YgaWR4ICE9PSAnbnVtYmVyJykgaWR4ID0gMDtcbiAgICAgICAgaWYgKCFjaG9vc2VyLnZhbHVlcykgcmV0dXJuO1xuICAgICAgICBjb25zdCBtYXggPSBjaG9vc2VyLnZhbHVlcy5sZW5ndGg7XG4gICAgICAgIGxldCBuZXh0ID0gaWR4ICsgZGVsdGE7XG4gICAgICAgIGlmIChuZXh0IDwgMCkgbmV4dCA9IG1heCAtIDE7XG4gICAgICAgIGlmIChuZXh0ID49IG1heCkgbmV4dCA9IDA7XG4gICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgY2hvb3Nlci5zZXRTZWxlY3RlZEl0ZW0obmV4dCwgMCBhcyBLZXlib2FyZEV2ZW50KTtcbiAgICB9XG5cbn0iLCAiaW1wb3J0IHsgZGVmYXVsdEJhc2ljTWFya3NTZXR0aW5ncyB9IGZyb20gXCJ0ZXRoZXItbWFya3MtY29yZVwiO1xyXG5pbXBvcnQgeyBNb2RhbEtleWJpbmRzLCBPYnNpZGlhbk1hcmtzU2V0dGluZ3N9IGZyb20gXCIuLi90eXBlc1wiO1xyXG5cclxuZXhwb3J0IGNvbnN0IG1vZGFsRGVmYXVsdEtleWJpbmRzOiBNb2RhbEtleWJpbmRzID0ge1xyXG4gICAgdXA6IFsnY3RybCtrJywgJ2N0cmwrcCddIGFzIHN0cmluZ1tdLFxyXG4gICAgZG93bjogWydjdHJsK2onLCAnY3RybCtuJ10gYXMgc3RyaW5nW10sXHJcbiAgICBkZWxldGU6IFsnY3RybCtkJ10gYXMgc3RyaW5nW10sXHJcbiAgICBzZWxlY3Q6IFsnRW50ZXInXSBhcyBzdHJpbmdbXSxcclxuICAgIGNhbmNlbDogWydFc2NhcGUnXSBhcyBzdHJpbmdbXSxcclxuICAgIHVuZG86IFsnY3RybCt1J10gYXMgc3RyaW5nW10sXHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBtb2RhbERlZmF1bHRLZXliaW5kc01hYzogTW9kYWxLZXliaW5kcyA9IHtcclxuICAgIHVwOiBbJ2NtZCtrJywgJ2NtZCtwJ10gYXMgc3RyaW5nW10sXHJcbiAgICBkb3duOiBbJ2NtZCtqJywgJ2NtZCtuJ10gYXMgc3RyaW5nW10sXHJcbiAgICBkZWxldGU6IFsnY21kK2QnXSBhcyBzdHJpbmdbXSxcclxuICAgIHNlbGVjdDogWydFbnRlciddIGFzIHN0cmluZ1tdLFxyXG4gICAgY2FuY2VsOiBbJ0VzY2FwZSddIGFzIHN0cmluZ1tdLFxyXG4gICAgdW5kbzogWydjbWQrdSddIGFzIHN0cmluZ1tdLFxyXG59XHJcblxyXG5leHBvcnQgY29uc3QgbW9kYWxJbnN0cnVjdGlvbkVsQ2xhc3MgPSAnbW9kYWwtaW5zdHJ1Y3Rpb24tZWwnO1xyXG5leHBvcnQgY29uc3QgbW9kYWxNYXJrU3ltYm9sQ2xhc3MgPSAnbWFyay1zeW1ib2wnO1xyXG5leHBvcnQgY29uc3QgbW9kYWxNYXJrRmlsZXBhdGhDbGFzcyA9ICdtYXJrLWZpbGUtcGF0aCc7XHJcbmV4cG9ydCBjb25zdCBtb2RhbE1hcmtIYXJwb29uU2lnbiA9ICdoYXJwb29uLXNpZ24nO1xyXG5cclxuZXhwb3J0IGNvbnN0IEpTT05zY2hlbWFWZXJzaW9uID0gMTtcclxuXHJcbmV4cG9ydCBjb25zdCBkZWZhdWx0T2JzaWRpYW5NYXJrc1NldHRpbmdzIDogT2JzaWRpYW5NYXJrc1NldHRpbmdzID0ge1xyXG4gICAgLi4uZGVmYXVsdEJhc2ljTWFya3NTZXR0aW5ncyxcclxuICAgIC8vIGhpZGVNYXJrTGlzdER1cmluZ0lucHV0OiBmYWxzZSxcclxuICAgIG9wZW5NYXJrSW5OZXdUYWI6IGZhbHNlLCAvLyBJZiB0cnVlLCBvcGVuIG1hcmsgaW4gbmV3IHRhYiwgZWxzZSBpbiBjdXJyZW50IHRhYlxyXG4gICAgZXhwZXJpbWVudGFsR290bzogZmFsc2UsXHJcbiAgICBtb2RhbExpc3RVcDogJycsXHJcbiAgICBtb2RhbExpc3REb3duOiAnJyxcclxuICAgIG1vZGFsTGlzdFNlbGVjdDogJycsXHJcbiAgICBtb2RhbExpc3RVbmRvOiAnJyxcclxuICAgIG1vZGFsTGlzdERlbGV0ZTogJycsXHJcbiAgICBtb2RhbExpc3RDYW5jZWw6ICcnLFxyXG59XHJcblxyXG4iLCAiaW1wb3J0IHsgbW9kYWxEZWZhdWx0S2V5YmluZHMsIG1vZGFsRGVmYXVsdEtleWJpbmRzTWFjIH0gZnJvbSBcIi4vZGVmYXVsdFZhbHVlc1wiO1xyXG5pbXBvcnQgeyBNb2RhbEtleWJpbmRzIH0gZnJvbSBcIi4uL3R5cGVzXCI7XHJcbmltcG9ydCB7IE9ic2lkaWFuTWFya3NTZXR0aW5ncyB9IGZyb20gXCIuLi90eXBlc1wiO1xyXG5cclxuLy8gVXRpbGl0eSB0byBwcmVwYXJlIGtleWJpbmRzIG9iamVjdFxyXG5leHBvcnQgZnVuY3Rpb24gcHJlcGFyZUtleWJpbmRzKGlzTWFjT1M6IGJvb2xlYW4sIHNldHRpbmdzOiBPYnNpZGlhbk1hcmtzU2V0dGluZ3MpIHtcclxuICAgIGxldCBrZXliaW5kczogTW9kYWxLZXliaW5kcyA9ICghaXNNYWNPUykgPyB7IC4uLm1vZGFsRGVmYXVsdEtleWJpbmRzIH0gOiB7IC4uLm1vZGFsRGVmYXVsdEtleWJpbmRzTWFjIH07XHJcblxyXG4gICAgaWYgKHNldHRpbmdzLm1vZGFsTGlzdFVwKSB7XHJcbiAgICAgICAga2V5YmluZHMudXAgPSBbc2V0dGluZ3MubW9kYWxMaXN0VXBdO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChzZXR0aW5ncy5tb2RhbExpc3REb3duKSB7XHJcbiAgICAgICAga2V5YmluZHMuZG93biA9IFtzZXR0aW5ncy5tb2RhbExpc3REb3duXTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoc2V0dGluZ3MubW9kYWxMaXN0RGVsZXRlKSB7XHJcbiAgICAgICAga2V5YmluZHMuZGVsZXRlID0gW3NldHRpbmdzLm1vZGFsTGlzdERlbGV0ZV07XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHNldHRpbmdzLm1vZGFsTGlzdFNlbGVjdCkge1xyXG4gICAgICAgIGtleWJpbmRzLnNlbGVjdCA9IFtzZXR0aW5ncy5tb2RhbExpc3RTZWxlY3RdO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChzZXR0aW5ncy5tb2RhbExpc3RVbmRvKSB7XHJcbiAgICAgICAga2V5YmluZHMudW5kbyA9IFtzZXR0aW5ncy5tb2RhbExpc3RVbmRvXTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoc2V0dGluZ3MubW9kYWxMaXN0Q2FuY2VsKSB7XHJcbiAgICAgICAga2V5YmluZHMuY2FuY2VsID0gW3NldHRpbmdzLm1vZGFsTGlzdENhbmNlbF07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGtleWJpbmRzO1xyXG59XHJcblxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIG1hdGNoS2V5YmluZChldnQ6IEtleWJvYXJkRXZlbnQsIGtleWJpbmQ6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgLy8gUGFyc2Uga2V5YmluZCBzdHJpbmcgbGlrZSAnY3RybCtzaGlmdCtwJywgJ2NtZCtuJywgZXRjLlxyXG4gICAgY29uc3QgcGFydHMgPSBrZXliaW5kLnNwbGl0KCcrJykubWFwKHAgPT4gcC50cmltKCkpO1xyXG4gICAgbGV0IHJlcXVpcmVkID0geyBjdHJsOiBmYWxzZSwgc2hpZnQ6IGZhbHNlLCBhbHQ6IGZhbHNlLCBtZXRhOiBmYWxzZSwga2V5OiAnJyB9O1xyXG4gICAgZm9yIChjb25zdCBwYXJ0IG9mIHBhcnRzKSB7XHJcbiAgICAgICAgaWYgKHBhcnQgPT09ICdjdHJsJykgcmVxdWlyZWQuY3RybCA9IHRydWU7XHJcbiAgICAgICAgZWxzZSBpZiAocGFydCA9PT0gJ3NoaWZ0JykgcmVxdWlyZWQuc2hpZnQgPSB0cnVlO1xyXG4gICAgICAgIGVsc2UgaWYgKHBhcnQgPT09ICdhbHQnKSByZXF1aXJlZC5hbHQgPSB0cnVlO1xyXG4gICAgICAgIGVsc2UgaWYgKHBhcnQgPT09ICdtZXRhJyB8fCBwYXJ0ID09PSAnY21kJyB8fCBwYXJ0ID09PSAnd2luJykgcmVxdWlyZWQubWV0YSA9IHRydWU7XHJcbiAgICAgICAgZWxzZSByZXF1aXJlZC5rZXkgPSBwYXJ0O1xyXG4gICAgfVxyXG4gICAgLy8gQ2hlY2sgbW9kaWZpZXJzXHJcbiAgICBpZiAoZXZ0LmN0cmxLZXkgIT09IHJlcXVpcmVkLmN0cmwpIHJldHVybiBmYWxzZTtcclxuICAgIGlmIChldnQuc2hpZnRLZXkgIT09IHJlcXVpcmVkLnNoaWZ0KSByZXR1cm4gZmFsc2U7XHJcbiAgICBpZiAoZXZ0LmFsdEtleSAhPT0gcmVxdWlyZWQuYWx0KSByZXR1cm4gZmFsc2U7XHJcbiAgICBpZiAoZXZ0Lm1ldGFLZXkgIT09IHJlcXVpcmVkLm1ldGEpIHJldHVybiBmYWxzZTtcclxuICAgIC8vIENoZWNrIGtleSAoY2FzZS1pbnNlbnNpdGl2ZSlcclxuICAgIHJldHVybiBldnQua2V5ID09PSByZXF1aXJlZC5rZXk7XHJcbn0iLCAiaW1wb3J0IFRldGhlck1hcmtzUGx1Z2luIGZyb20gJy4vbWFpbic7XHJcbmltcG9ydCB7IHBsdWdpbkFkZEZpbGVUb0hhcnBvb24gfSBmcm9tICcuL3BsdWdpbk9wZXJhdGlvbnMnO1xyXG5pbXBvcnQgeyBNYXJrTGlzdE1vZGFsIH0gZnJvbSAnLi91aS9NYXJrTGlzdE1vZGFsJztcclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZXRHbG9iYWxNYXJrKHBsdWdpbjogVGV0aGVyTWFya3NQbHVnaW4pIHtcclxuICAgIG5ldyBNYXJrTGlzdE1vZGFsKHBsdWdpbi5hcHAsIHBsdWdpbiwgJ3NldCcpLm9wZW4oKTtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdvVG9HbG9iYWxNYXJrKHBsdWdpbjogVGV0aGVyTWFya3NQbHVnaW4pIHtcclxuICAgIG5ldyBNYXJrTGlzdE1vZGFsKHBsdWdpbi5hcHAsIHBsdWdpbiwgJ2dvdG8nKS5vcGVuKCk7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBkZWxldGVHbG9iYWxNYXJrKHBsdWdpbjogVGV0aGVyTWFya3NQbHVnaW4pIHtcclxuICAgIG5ldyBNYXJrTGlzdE1vZGFsKHBsdWdpbi5hcHAsIHBsdWdpbiwgJ2RlbGV0ZScpLm9wZW4oKTtcclxufVxyXG5cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhZGRGaWxlVG9IYXJwb29uKHBsdWdpbjogVGV0aGVyTWFya3NQbHVnaW4pIHtcclxuICAgIHBsdWdpbkFkZEZpbGVUb0hhcnBvb24ocGx1Z2luKTtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdvVG9IYXJwb29uTWFyayhwbHVnaW46IFRldGhlck1hcmtzUGx1Z2luKSB7XHJcbiAgICBuZXcgTWFya0xpc3RNb2RhbChwbHVnaW4uYXBwLCBwbHVnaW4sICdnb3RvJywgdHJ1ZSkub3BlbigpO1xyXG59IiwgImltcG9ydCB7IEFwcCwgUGx1Z2luU2V0dGluZ1RhYiwgU2V0dGluZyB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCBUZXRoZXJNYXJrc1BsdWdpbiBmcm9tICcuLi9tYWluJztcbmltcG9ydCB7IE9ic2lkaWFuTWFya3NTZXR0aW5ncyB9IGZyb20gJy4uL3R5cGVzJztcbmltcG9ydCB7IGRlZmF1bHRPYnNpZGlhbk1hcmtzU2V0dGluZ3MgfSBmcm9tICcuLi91dGlscy9kZWZhdWx0VmFsdWVzJztcblxuZXhwb3J0IGNsYXNzIFNldHRpbmdzVGFiIGV4dGVuZHMgUGx1Z2luU2V0dGluZ1RhYiB7XG4gICAgcGx1Z2luOiBUZXRoZXJNYXJrc1BsdWdpbjtcblxuICAgIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwbHVnaW46IFRldGhlck1hcmtzUGx1Z2luKSB7XG4gICAgICAgIHN1cGVyKGFwcCwgcGx1Z2luKTtcbiAgICAgICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgfVxuXG4gICAgZGlzcGxheSgpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgeyBjb250YWluZXJFbCB9ID0gdGhpcztcbiAgICAgICAgY29udGFpbmVyRWwuZW1wdHkoKTtcbiAgICAgICAgY29uc3QgZHMgPSBkZWZhdWx0T2JzaWRpYW5NYXJrc1NldHRpbmdzO1xuXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoJ09wZW4gbWFyayBpbiBuZXcgdGFiJylcbiAgICAgICAgICAgIC5zZXREZXNjKCdPcGVuIGEgZmlsZSBpbiB0aGUgbmV3IHRhYiB3aGVuIHVzaW5nIFwiZ28gdG9cIiBjb21tYW5kLiBJZiBkaXNhYmxlZCwgaXQgd2lsbCBvcGVuIHRoZSBmaWxlIGluIHRoZSBjdXJyZW50IHRhYi4nKVxuICAgICAgICAgICAgLmFkZFRvZ2dsZSh0b2dnbGUgPT4gdG9nZ2xlXG4gICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLm9wZW5NYXJrSW5OZXdUYWIgPz8gZHMub3Blbk1hcmtJbk5ld1RhYilcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLm9wZW5NYXJrSW5OZXdUYWIgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAgICAgICAuc2V0TmFtZSgnTm8gZHVwbGljYXRpb24gb2Ygb3BlbmVkIGZpbGVzIHdoZW4gdXNpbmcgR28gdG8gY29tbWFuZHMgKGV4cGVyaW1lbnRhbCknKVxuICAgICAgICAgICAgLnNldERlc2MoJ1ByZXZlbnRzIGR1cGxpY2F0ZSB0YWJzIHdoZW4gc3dpdGNoaW5nIHRvIGFscmVhZHkgb3BlbmVkIGZpbGVzIHVzaW5nIHRoZSBtYXJrIGxpc3QgYWZ0ZXIgcmVzdGFydGluZyBPYnNpZGlhbi4gKEV4cGVyaW1lbnRhbDogbWF5IG5vdCB3b3JrIGluIGZ1dHVyZSBPYnNpZGlhbiB2ZXJzaW9ucy4pJylcbiAgICAgICAgICAgIC5hZGRUb2dnbGUodG9nZ2xlID0+IHRvZ2dsZVxuICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5leHBlcmltZW50YWxHb3RvID8/IGRzLmV4cGVyaW1lbnRhbEdvdG8pXG4gICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5leHBlcmltZW50YWxHb3RvID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKS5zZXROYW1lKCdHZW5lcmFsIHJlZ2lzdGVycycpLnNldEhlYWRpbmcoKTtcbiAgICAgICAgdGhpcy5jcmVhdGVSZWdpc3Rlckxpc3RTZXR0aW5nKGNvbnRhaW5lckVsLCBcIlJlZ2lzdGVyIGxpc3RcIiwgZHMucmVnaXN0ZXJMaXN0LCAnS2V5IHN5bWJvbHMgdG8gYmUgdXNlZCBhcyByZWdpc3RlcnMuIE9ubHkgaW5jbHVkZSBzeW1ib2xzIHRoYXQgeW91IGNhbiBpbnB1dCB3aXRoIGEgc2luZ2xlIGtleXN0cm9rZS4nLCAncmVnaXN0ZXJMaXN0JylcbiAgICAgICAgICAgIC5hZGRFeHRyYUJ1dHRvbigoYnRuKSA9PiB7XG4gICAgICAgICAgICAgICAgYnRuXG4gICAgICAgICAgICAgICAgICAgIC5zZXRJY29uKCdyZWZyZXNoLWNjdycpXG4gICAgICAgICAgICAgICAgICAgIC5zZXRUb29sdGlwKCdSZXNldCB0byBkZWZhdWx0IHJlZ2lzdGVyIGxpc3QnKVxuICAgICAgICAgICAgICAgICAgICAub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5yZWdpc3Rlckxpc3QgPSBkcy5yZWdpc3Rlckxpc3Q7XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlzcGxheSgpOyAvLyBSZWZyZXNoIHRoZSBzZXR0aW5ncyB0YWIgdG8gc2hvdyB0aGUgdXBkYXRlZCB2YWx1ZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9KVxuXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoJ1NvcnQgYWxsIG1hcmtzIGJ5IHJlZ2lzdGVyIGxpc3QnKVxuICAgICAgICAgICAgLnNldERlc2MoJ1NvcnQgbWFya3MgYnkgdGhlIG9yZGVyIG9mIHRoZSBrZXkgc3ltYm9scyBpbiB0aGUgcmVnaXN0ZXIgbGlzdC4gSWYgZGlzYWJsZWQsIG1hcmtzIHdpbGwgYmUgc29ydGVkIGFscGhhYmV0aWNhbGx5IGFjY29yZGluZyB0byB0aGUgY3VycmVudCBsb2NhbGUuJylcbiAgICAgICAgICAgIC5hZGRUb2dnbGUodG9nZ2xlID0+IHRvZ2dsZVxuICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5yZWdpc3RlclNvcnRCeUxpc3QgPz8gZHMucmVnaXN0ZXJTb3J0QnlMaXN0KVxuICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MucmVnaXN0ZXJTb3J0QnlMaXN0ID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuXG4gICAgICAgIC8vIFRPRE86IGltcGxlbWVudCB0aGlzIGZlYXR1cmVcbiAgICAgICAgLy8gbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAgIC8vICAgICAuc2V0TmFtZSgnSGlkZSBtYXJrIGxpc3QnKVxuICAgICAgICAvLyAgICAgLnNldERlc2MoJ0hpZGUgdGhlIGdsb2JhbCBtYXJrIGxpc3QgZm9yIGJvdGggY29tbWFuZHMgKGZvciBmYXN0IGlucHV0LCBubyBmbGlja2VyKS4nKVxuICAgICAgICAvLyAgICAgLmFkZFRvZ2dsZSh0b2dnbGUgPT4gdG9nZ2xlXG4gICAgICAgIC8vICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmhpZGVNYXJrTGlzdER1cmluZ0lucHV0ID8/IGRzLmhpZGVNYXJrTGlzdER1cmluZ0lucHV0KVxuICAgICAgICAvLyAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgLy8gICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuaGlkZU1hcmtMaXN0RHVyaW5nSW5wdXQgPSB2YWx1ZTtcbiAgICAgICAgLy8gICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgIC8vICAgICAgICAgfSkpO1xuXG5cbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpLnNldE5hbWUoJ0hhcnBvb24gcmVnaXN0ZXJzJykuc2V0SGVhZGluZygpO1xuICAgICAgICB0aGlzLmNyZWF0ZVJlZ2lzdGVyTGlzdFNldHRpbmcoY29udGFpbmVyRWwsIFwiSGFycG9vbiByZWdpc3RlciBsaXN0XCIsIGRzLmhhcnBvb25SZWdpc3Rlckxpc3QsICdLZXkgc3ltYm9scyB0byBiZSB1c2VkIGFzIEhhcnBvb24gcmVnaXN0ZXJzLiBPbmx5IGluY2x1ZGUgc3ltYm9scyB0aGF0IHlvdSBjYW4gaW5wdXQgd2l0aCBhIHNpbmdsZSBrZXlzdHJva2UuJywgJ2hhcnBvb25SZWdpc3Rlckxpc3QnKVxuICAgICAgICAgICAgLmFkZEV4dHJhQnV0dG9uKChidG4pID0+IHtcbiAgICAgICAgICAgICAgICBidG5cbiAgICAgICAgICAgICAgICAgICAgLnNldEljb24oJ3JlZnJlc2gtY2N3JylcbiAgICAgICAgICAgICAgICAgICAgLnNldFRvb2x0aXAoJ1Jlc2V0IHRvIGRlZmF1bHQgSGFycG9vbiByZWdpc3RlciBsaXN0JylcbiAgICAgICAgICAgICAgICAgICAgLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuaGFycG9vblJlZ2lzdGVyTGlzdCA9IGRzLmhhcnBvb25SZWdpc3Rlckxpc3Q7XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlzcGxheSgpOyAvLyBSZWZyZXNoIHRoZSBzZXR0aW5ncyB0YWIgdG8gc2hvdyB0aGUgdXBkYXRlZCB2YWx1ZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9KVxuXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoJ1NvcnQgSGFycG9vbiBtYXJrcyBieSBIYXJwb29uIHJlZ2lzdGVyIGxpc3QnKVxuICAgICAgICAgICAgLnNldERlc2MoJ1NvcnQgSGFycG9vbiBtYXJrcyBieSB0aGUgb3JkZXIgb2YgdGhlIGtleSBzeW1ib2xzIGluIHRoZSBIYXJwb29uIHJlZ2lzdGVyIGxpc3QuIElmIGRpc2FibGVkLCBtYXJrcyB3aWxsIGJlIHNvcnRlZCBhbHBoYWJldGljYWxseSBhY2NvcmRpbmcgdG8gdGhlIGN1cnJlbnQgbG9jYWxlLicpXG4gICAgICAgICAgICAuYWRkVG9nZ2xlKHRvZ2dsZSA9PiB0b2dnbGVcbiAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuaGFycG9vblJlZ2lzdGVyU29ydEJ5TGlzdCA/PyBkcy5oYXJwb29uUmVnaXN0ZXJTb3J0QnlMaXN0KVxuICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuaGFycG9vblJlZ2lzdGVyU29ydEJ5TGlzdCA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKTtcblxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgICAgICAgIC5zZXROYW1lKCdSZW1vdmUgZ2FwcyBpbmJldHdlZW4gSGFycG9vbiBtYXJrcycpXG4gICAgICAgICAgICAuc2V0RGVzYygnSGFycG9vbiBtYXJrcyB3aWxsIGJlIHNoaWZ0ZWQgdG8gdGhlIGxlZnQgZm9yIGV2ZXJ5IGdhcCAocmVnaXN0ZXIgd2l0aCBubyBtYXJrKSBiYXNlZCBvbiB0aGUgb3JkZXIgb2YgdGhlIEhhcnBvb24gcmVnaXN0ZXIgbGlzdC4nKVxuICAgICAgICAgICAgLmFkZFRvZ2dsZSh0b2dnbGUgPT4gdG9nZ2xlXG4gICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmhhcnBvb25SZWdpc3RlckdhcFJlbW92YWwgPz8gZHMuaGFycG9vblJlZ2lzdGVyR2FwUmVtb3ZhbClcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmhhcnBvb25SZWdpc3RlckdhcFJlbW92YWwgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICk7XG5cblxuICAgICAgICAvLyBBZGQga2V5Ym9hcmQgc2hvcnRjdXQgc2V0dGluZ3NcbiAgICAgICAgLy8gVE9ETzogc2V0dGluZyB0aG9zZSB2YWx1ZXMgaGVyZSBsaWtlIGZlZWxzIHdyb25nLCBlc3BlY2lhbGx5IHBhc3Npbmcgb2JqZWN0IHByb3BlcnR5IGFzIHN0cmluZ1xuICAgICAgICBjb250YWluZXJFbC5jcmVhdGVFbCgnaDQnLCB7IHRleHQ6ICdMaXN0IG5hdmlnYXRpb24gc2hvcnRjdXRzJyB9KTtcbiAgICAgICAgdGhpcy5jcmVhdGVTaG9ydGN1dFNldHRpbmcoY29udGFpbmVyRWwsICdVcCcsIGRzLm1vZGFsTGlzdFVwLCAnU2hvcnRjdXQgZm9yIG1vdmluZyB1cCBpbiB0aGUgbGlzdCcsICdtb2RhbExpc3RVcCcpO1xuICAgICAgICB0aGlzLmNyZWF0ZVNob3J0Y3V0U2V0dGluZyhjb250YWluZXJFbCwgJ0Rvd24nLCBkcy5tb2RhbExpc3REb3duLCAnU2hvcnRjdXQgZm9yIG1vdmluZyBkb3duIGluIHRoZSBsaXN0JywgJ21vZGFsTGlzdERvd24nKTtcbiAgICAgICAgdGhpcy5jcmVhdGVTaG9ydGN1dFNldHRpbmcoY29udGFpbmVyRWwsICdTZWxlY3QgbWFyaycsIGRzLm1vZGFsTGlzdFNlbGVjdCwgJ1Nob3J0Y3V0IGZvciBzZWxlY3RpbmcgYSBtYXJrJywgJ21vZGFsTGlzdFNlbGVjdCcpO1xuICAgICAgICB0aGlzLmNyZWF0ZVNob3J0Y3V0U2V0dGluZyhjb250YWluZXJFbCwgJ0NhbmNlbCBtb2RhbCcsIGRzLm1vZGFsTGlzdENhbmNlbCwgJ1Nob3J0Y3V0IGZvciBjYW5jZWxsaW5nIHRoZSBtb2RhbCcsICdtb2RhbExpc3RDYW5jZWwnKTtcbiAgICAgICAgdGhpcy5jcmVhdGVTaG9ydGN1dFNldHRpbmcoY29udGFpbmVyRWwsICdEZWxldGUgbWFyaycsIGRzLm1vZGFsTGlzdERlbGV0ZSwgJ1Nob3J0Y3V0IGZvciBkZWxldGluZyBhIG1hcmsnLCAnbW9kYWxMaXN0RGVsZXRlJyk7XG4gICAgICAgIHRoaXMuY3JlYXRlU2hvcnRjdXRTZXR0aW5nKGNvbnRhaW5lckVsLCAnUmVzdG9yZSBsYXN0IGNoYW5nZWQgbWFyaycsIGRzLm1vZGFsTGlzdFVuZG8sICdTaG9ydGN1dCBmb3IgdW5kb2luZyBsYXN0IGFjdGlvbiBvZiBjaGFuZ2luZyBhIG1hcmsnLCAnbW9kYWxMaXN0VW5kbycpO1xuXG5cbiAgICB9XG5cbiAgICAvLyB1c2Ugb25seSBmb3Igc3RyaW5nIHZhbHVlcyBmcm9tIFNldHRpbmdzIHR5cGVcbiAgICBjcmVhdGVTaG9ydGN1dFNldHRpbmcoY29udGFpbmVyRWw6IEhUTUxFbGVtZW50LCBuYW1lOiBzdHJpbmcsIGRlZmF1bHRWYWx1ZTogc3RyaW5nLCBkZXNjOiBzdHJpbmcsIGtleToga2V5b2YgT2JzaWRpYW5NYXJrc1NldHRpbmdzKSB7XG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUobmFtZSlcbiAgICAgICAgICAgIC5zZXREZXNjKGRlc2MpXG4gICAgICAgICAgICAuYWRkVGV4dCh0ZXh0ID0+IHRleHRcbiAgICAgICAgICAgICAgICAuc2V0VmFsdWUoU3RyaW5nKHRoaXMucGx1Z2luLnNldHRpbmdzW2tleV0gPz8gZGVmYXVsdFZhbHVlKSlcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICh0aGlzLnBsdWdpbi5zZXR0aW5ncyBhcyBhbnkpW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgIH1cblxuICAgIGNyZWF0ZVJlZ2lzdGVyTGlzdFNldHRpbmcoY29udGFpbmVyRWw6IEhUTUxFbGVtZW50LCBuYW1lOiBzdHJpbmcsIGRlZmF1bHRWYWx1ZTogc3RyaW5nLCBkZXNjOiBzdHJpbmcsIGtleToga2V5b2YgT2JzaWRpYW5NYXJrc1NldHRpbmdzKTogU2V0dGluZyB7XG4gICAgICAgIHJldHVybiBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgICAgICAgIC5zZXROYW1lKG5hbWUpXG4gICAgICAgICAgICAuc2V0RGVzYyhkZXNjKVxuICAgICAgICAgICAgLmFkZFRleHQodGV4dCA9PiB0ZXh0XG4gICAgICAgICAgICAgICAgLnNldFZhbHVlKFN0cmluZyh0aGlzLnBsdWdpbi5zZXR0aW5nc1trZXldID8/IGRlZmF1bHRWYWx1ZSkpXG4gICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAodGhpcy5wbHVnaW4uc2V0dGluZ3MgYXMgYW55KVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgIH0pKTtcbiAgICB9XG59IiwgImltcG9ydCB7IE5vdGljZSB9IGZyb20gJ29ic2lkaWFuJztcclxuaW1wb3J0IFRldGhlck1hcmtzUGx1Z2luIGZyb20gJy4uL21haW4nO1xyXG5pbXBvcnQgeyBkZWZhdWx0T2JzaWRpYW5NYXJrc1NldHRpbmdzLCBKU09Oc2NoZW1hVmVyc2lvbiBhcyBsYXRlc3RKU09OU2NoZW1hVmVyc2lvbiB9IGZyb20gJy4vZGVmYXVsdFZhbHVlcyc7XHJcbmltcG9ydCB7IE1hcmt9IGZyb20gJ3RldGhlci1tYXJrcy1jb3JlJztcclxuaW1wb3J0IHsgT2JzaWRpYW5NYXJrc1NldHRpbmdzIH0gZnJvbSAnLi4vdHlwZXMnO1xyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxvYWRTZXR0aW5ncyhwbHVnaW46IFRldGhlck1hcmtzUGx1Z2luKTogUHJvbWlzZTxPYnNpZGlhbk1hcmtzU2V0dGluZ3M+IHtcclxuICAgIHJldHVybiAoYXdhaXQgcGx1Z2luLmxvYWREYXRhKCkpPy5zZXR0aW5ncyB8fCBkZWZhdWx0T2JzaWRpYW5NYXJrc1NldHRpbmdzO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2F2ZVNldHRpbmdzKHBsdWdpbjogVGV0aGVyTWFya3NQbHVnaW4sIHNldHRpbmdzOiBPYnNpZGlhbk1hcmtzU2V0dGluZ3MpIHtcclxuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBwbHVnaW4ubG9hZERhdGEoKSB8fCB7fTtcclxuICAgIGRhdGEuc2V0dGluZ3MgPSBzZXR0aW5ncztcclxuICAgIGF3YWl0IHBsdWdpbi5zYXZlRGF0YShkYXRhKTtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxvYWRNYXJrcyhwbHVnaW46IFRldGhlck1hcmtzUGx1Z2luKTogUHJvbWlzZTxNYXJrW10+IHtcclxuICAgIHJldHVybiAoYXdhaXQgcGx1Z2luLmxvYWREYXRhKCkpPy5tYXJrcyB8fCBbXTtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNhdmVNYXJrcyhwbHVnaW46IFRldGhlck1hcmtzUGx1Z2luLCBtYXJrczogTWFya1tdKSB7XHJcbiAgICBjb25zdCBkYXRhID0gYXdhaXQgcGx1Z2luLmxvYWREYXRhKCkgfHwge307XHJcbiAgICBkYXRhLm1hcmtzID0gbWFya3M7XHJcbiAgICBhd2FpdCBwbHVnaW4uc2F2ZURhdGEoZGF0YSk7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2FkTGFzdENoYW5nZWRNYXJrKHBsdWdpbjogVGV0aGVyTWFya3NQbHVnaW4pOiBQcm9taXNlPE1hcms+IHtcclxuICAgIHJldHVybiAoYXdhaXQgcGx1Z2luLmxvYWREYXRhKCkpPy5sYXN0Q2hhbmdlZE1hcmsgfHwge307XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzYXZlTGFzdENoYW5nZWRNYXJrKHBsdWdpbjogVGV0aGVyTWFya3NQbHVnaW4sIGxhc3RDaGFuZ2VkTWFyazogTWFyaykge1xyXG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHBsdWdpbi5sb2FkRGF0YSgpIHx8IHt9O1xyXG4gICAgZGF0YS5sYXN0Q2hhbmdlZE1hcmsgPSBsYXN0Q2hhbmdlZE1hcms7XHJcbiAgICBhd2FpdCBwbHVnaW4uc2F2ZURhdGEoZGF0YSk7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBKU09Oc2NoZW1hQ2hlY2socGx1Z2luOiBUZXRoZXJNYXJrc1BsdWdpbikge1xyXG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHBsdWdpbi5sb2FkRGF0YSgpO1xyXG5cclxuICAgIGlmICghZGF0YSB8fCAhZGF0YS5zY2hlbWFWZXJzaW9uKXtcclxuICAgICAgICBhd2FpdCBwbHVnaW4uc2F2ZURhdGEoe3NjaGVtYVZlcnNpb246IGxhdGVzdEpTT05TY2hlbWFWZXJzaW9uLCAuLi5kYXRhfSlcclxuICAgICAgICByZXR1cm5cclxuICAgIH1cclxuXHJcbiAgICBpZiAoZGF0YS5zY2hlbWFWZXJzaW9uID09PSBsYXRlc3RKU09OU2NoZW1hVmVyc2lvbil7XHJcbiAgICAgICAgcmV0dXJuXHJcbiAgICB9XHJcblxyXG4gICAgbmV3IE5vdGljZShwbHVnaW4ubWFuaWZlc3QubmFtZSArIFwiOiBGYXVsdHkgZGF0YS4gQ2hlY2sgZGV2ZWxvcGVyIHRvb2xzIGZvciBtb3JlIGluZm8uXCIpO1xyXG4gICAgY29uc29sZS5lcnJvcihwbHVnaW4ubWFuaWZlc3QuaWQgKyBcIjogVGhlIGRhdGEgbG9hZGVkIGlzIG5vdCBpbiBjb3JyZWN0IGZvcm1hdC4gVGhlIHBsdWdpbiBtYXkgbm90IHdvcmsgcHJvcGVybHkuIFRoaXMgdXN1YWxseSBoYXBwZW5zIGFmdGVyIHBsdWdpbiB1cGRhdGUgdGhhdCBjaGFuZ2VzIHRoZSBKU09OIHNjaGVtYS4gXCIpO1xyXG4gICAgLy8gVE9ETzogbWFrZSBhdXRvbWF0aWMgY29udmVyc2lvbnMgaGVyZSBpZiBuZWNlc3NhcnkgaW4gdGhlIGZ1dHVyZS4gQmUgc3VyZSB0byBzYXZlIHRoZSBsZWdhY3kgcHJlIGNvbnZlcnNpb24gZGF0YSBhcyBiYWNrdXAgaW4gdGhlIFwibGVnYWN5U2NoZW1hRGF0YVwiIGZpZWxkLiBcclxufSJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsSUFBQUEsbUJBQXVCOzs7QUNBdkIsSUFBQUMsbUJBQXVCOzs7QUNBaEIsU0FBUyx3QkFBd0IsT0FBTyxXQUFXO0FBQ3RELGFBQVcsT0FBTyxXQUFXO0FBR3pCLFFBQUksQ0FBRSxNQUFNLElBQUksT0FBSyxFQUFFLE1BQU0sRUFBRSxTQUFTLEdBQUcsR0FBSTtBQUMzQyxhQUFPO0FBQUEsSUFDWDtBQUFBLEVBQ0o7QUFDQSxTQUFPO0FBQ1g7QUFDTyxTQUFTLGdCQUFnQixPQUFPLFFBQVE7QUFDM0MsU0FBTyxNQUFNLEtBQUssT0FBSyxFQUFFLFdBQVcsTUFBTTtBQUM5QztBQUNPLFNBQVMsd0JBQXdCLE9BQU87QUFDM0MsUUFBTSxLQUFLLENBQUMsR0FBRyxNQUFNLEVBQUUsT0FBTyxjQUFjLEVBQUUsTUFBTSxDQUFDO0FBQ3pEO0FBQ08sU0FBUywwQkFBMEIsT0FBTyxlQUFlLFVBQVU7QUFDdEUsUUFBTSxxQkFBcUIsSUFBSSxLQUFLLENBQUMsZ0JBQWdCLFNBQVMsZUFBZSxTQUFTLHFCQUFxQixNQUFNLEVBQUUsQ0FBQztBQUNwSCxRQUFNLGdC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QUFBLEVBQ0o7QUFFQSxNQUFJLHdCQUFPLE9BQU8sU0FBUyxPQUFPLHFEQUFxRDtBQUN2RixVQUFRLE1BQU0sT0FBTyxTQUFTLEtBQUssdUpBQXVKO0FBRTlMOzs7QVYzQ0EsSUFBcUIsb0JBQXJCLGNBQStDLHdCQUFPO0FBQUEsRUFBdEQ7QUFBQTtBQUVJLGlCQUFnQixDQUFDO0FBQ2pCLDJCQUErQjtBQUFBO0FBQUEsRUFFL0IsTUFBTSxTQUFTO0FBQ1gsVUFBTSxnQkFBZ0IsSUFBSTtBQUUxQixTQUFLLFdBQVcsTUFBTSxhQUFhLElBQUk7QUFDdkMsU0FBSyxRQUFRLE1BQU0sVUFBVSxJQUFJO0FBQ2pDLFNBQUssa0JBQWtCLE1BQU0sb0JBQW9CLElBQUk7QUFFckQsU0FBSyxXQUFXO0FBQUEsTUFDWixJQUFJO0FBQUEsTUFDSixNQUFNO0FBQUEsTUFDTixVQUFVLE1BQU0sY0FBYyxJQUFJO0FBQUEsSUFDdEMsQ0FBQztBQUlELFNBQUssV0FBVztBQUFBLE1BQ1osSUFBSTtBQUFBLE1BQ0osTUFBTTtBQUFBLE1BQ04sVUFBVSxNQUFNLGVBQWUsSUFBSTtBQUFBLElBQ3ZDLENBQUM7QUFFRCxTQUFLLFdBQVc7QUFBQSxNQUNaLElBQUk7QUFBQSxNQUNKLE1BQU07QUFBQSxNQUNOLFVBQVUsTUFBTSxpQkFBaUIsSUFBSTtBQUFBLElBQ3pDLENBQUM7QUFFRCxTQUFLLFdBQVc7QUFBQSxNQUNaLElBQUk7QUFBQSxNQUNKLE1BQU07QUFBQSxNQUNOLFVBQVUsTUFBTSxpQkFBaUIsSUFBSTtBQUFBLElBQ3pDLENBQUM7QUFFRCxTQUFLLFdBQVc7QUFBQSxNQUNaLElBQUk7QUFBQSxNQUNKLE1BQU07QUFBQSxNQUNOLFVBQVUsTUFBTSxnQkFBZ0IsSUFBSTtBQUFBLElBQ3hDLENBQUM7QUFFRCxTQUFLLGNBQWMsSUFBSSxZQUFZLEtBQUssS0FBSyxJQUFJLENBQUM7QUFFbEQsWUFBUSxJQUFJLGFBQWEsS0FBSyxTQUFTLEVBQUU7QUFBQSxFQUM3QztBQUFBLEVBRUEsTUFBTSxlQUFlO0FBQ2pCLFVBQU0sYUFBYSxNQUFNLEtBQUssUUFBUTtBQUFBLEVBQzFDO0FBQUEsRUFFQSxNQUFNLFVBQVUsT0FBZTtBQUMzQixTQUFLLFFBQVE7QUFDYixVQUFNLFVBQVUsTUFBTSxLQUFLO0FBQUEsRUFDL0I7QUFBQSxFQUVBLE1BQU0sb0JBQW9CLGlCQUF1QjtBQUM3QyxTQUFLLGtCQUFrQjtBQUN2QixVQUFNLG9CQUFvQixNQUFNLGVBQWU7QUFBQSxFQUNuRDtBQUFBLEVBRUEsV0FBVztBQUNQLFlBQVEsSUFBSSxlQUFlLEtBQUssU0FBUyxFQUFFO0FBQUEsRUFDL0M7QUFDSjsiLAogICJuYW1lcyI6IFsiaW1wb3J0X29ic2lkaWFuIiwgImltcG9ydF9vYnNpZGlhbiIsICJpbXBvcnRfb2JzaWRpYW4iLCAiaW1wb3J0X29ic2lkaWFuIiwgImltcG9ydF9vYnNpZGlhbiJdCn0K
