/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// src/main.ts
var main_exports = {};
__export(main_exports, {
  default: () => VimMarksImpl
});
module.exports = __toCommonJS(main_exports);
var import_obsidian4 = require("obsidian");

// src/ui/MarkListModal.ts
var import_obsidian2 = require("obsidian");

// src/utils/defaultValues.ts
var modalDefaultKeybinds = {
  up: ["ctrl+k", "ctrl+p"],
  down: ["ctrl+j", "ctrl+n"],
  delete: ["ctrl+d"],
  select: ["Enter"]
};
var modalDefaultKeybindsMac = {
  up: ["cmd+k", "cmd+p"],
  down: ["cmd+j", "cmd+n"],
  delete: ["cmd+d"],
  select: ["Enter"]
};
var modalPlaceholderMessages = {
  set: "Select a mark to set",
  goto: "Select a mark to go to",
  delete: "Select a mark to delete"
};
var defaultSettings = {
  hideMarkListDuringInput: false,
  modalListUp: "",
  modalListDown: "",
  modalListSelect: "",
  modalListDelete: "",
  openMarkInNewTab: false,
  // If true, open mark in new tab, else in current tab
  registerList: "abcdefghijklmnopqrstuvwxyz",
  registerSortByList: true,
  harpoonRegisterList: "qwer",
  harpoonRegisterSortByList: true,
  harpoonRegisterGapRemoval: true,
  experimentalGoto: false
};
var modalInstructionElClass = "modal-instruction-el";
var modalMarkSymbolClass = "mark-symbol";
var modalMarkFilepathClass = "mark-file-path";
var JSONschemaVersion = 1;

// src/utils/marks.ts
function findFirstUnusedRegister(marks, registers) {
  for (const reg of registers) {
    if (!marks.map((m) => m.symbol).includes(reg)) {
      return reg;
    }
  }
  return null;
}
function getMarkBySymbol(marks, symbol) {
  return marks.find((m) => m.symbol === symbol);
}
function sortMarksAlphabetically(marks) {
  marks.sort((a, b) => a.symbol.localeCompare(b.symbol));
}
function getSortedAndFilteredMarks(marks, isHarpoonMode, settings) {
  const availableRegisters = new Set((!isHarpoonMode ? settings.registerList : settings.harpoonRegisterList).split(""));
  const filteredMarks = marks.filter((el) => availableRegisters.has(el.symbol));
  if (!isHarpoonMode && settings.registerSortByList) {
    const registerList = settings.registerList;
    sortMarksBySettingsRegisterOrder(filteredMarks, registerList);
  } else if (isHarpoonMode && settings.harpoonRegisterSortByList) {
    const registerList = settings.harpoonRegisterList;
    sortMarksBySettingsRegisterOrder(filteredMarks, registerList);
  } else {
    sortMarksAlphabetically(filteredMarks);
  }
  return filteredMarks;
}
function sortMarksBySettingsRegisterOrder(marks, registers) {
  const registerOrder = new Map([...registers].map((symbol, index) => [symbol, index]));
  marks.sort((a, b) => {
    var _a, _b;
    return ((_a = registerOrder.get(a.symbol)) != null ? _a : Infinity) - ((_b = registerOrder.get(b.symbol)) != null ? _b : Infinity);
  });
}
function removeGapsForHarpoonMarks(marksToCopy, harpoonRegisters) {
  let marks = [...marksToCopy];
  let leftCur = 0;
  let rightCur = 0;
  while (rightCur < harpoonRegisters.length) {
    const markEl = marks.find((el) => el.symbol === harpoonRegisters[rightCur]);
    if (markEl !== void 0) {
      const symbolToSetTo = harpoonRegisters[leftCur];
      let filteredMarks = marks.filter((el) => el.symbol !== harpoonRegisters[leftCur]);
      filteredMarks.push({ symbol: symbolToSetTo, filePath: markEl.filePath });
      marks = filteredMarks;
      leftCur += 1;
    }
    rightCur += 1;
  }
  while (leftCur < harpoonRegisters.length) {
    marks = marks.filter((el) => el.symbol !== harpoonRegisters[leftCur]);
    leftCur += 1;
  }
  return marks;
}
function setNewOrOverwriteMark(marks, setMark, filePath) {
  const outMarks = marks.filter((m) => m.symbol !== setMark.symbol);
  outMarks.push({ symbol: setMark.symbol, filePath });
  return outMarks;
}

// src/utils/keybinds.ts
function prepareKeybinds(isMacOS, settings) {
  let keybinds = !isMacOS ? { ...modalDefaultKeybinds } : { ...modalDefaultKeybindsMac };
  if (settings.markListUp) {
    keybinds.up = [settings.markListUp];
  }
  if (settings.markListDown) {
    keybinds.down = [settings.markListDown];
  }
  if (settings.markListDelete) {
    keybinds.delete = [settings.markListDelete];
  }
  if (settings.markListSelect) {
    keybinds.select = [settings.markListSelect];
  }
  return keybinds;
}
function matchKeybind(evt, keybind) {
  const parts = keybind.split("+").map((p) => p.trim());
  let required = { ctrl: false, shift: false, alt: false, meta: false, key: "" };
  for (const part of parts) {
    if (part === "ctrl")
      required.ctrl = true;
    else if (part === "shift")
      required.shift = true;
    else if (part === "alt")
      required.alt = true;
    else if (part === "meta" || part === "cmd" || part === "win")
      required.meta = true;
    else
      required.key = part;
  }
  if (evt.ctrlKey !== required.ctrl)
    return false;
  if (evt.shiftKey !== required.shift)
    return false;
  if (evt.altKey !== required.alt)
    return false;
  if (evt.metaKey !== required.meta)
    return false;
  return evt.key === required.key;
}

// src/utils/obsidianUtils.ts
var import_obsidian = require("obsidian");
function openNewFile(filePath, openFileInNewTab, app) {
  const file = app.vault.getAbstractFileByPath(filePath);
  if (file instanceof import_obsidian.TFile) {
    if (openFileInNewTab) {
      app.workspace.getLeaf("tab").openFile(file);
    } else {
      app.workspace.getLeaf().openFile(file);
    }
  } else {
    new import_obsidian.Notice(`File not found for path ${filePath}. The file may have been deleted, moved or renamed.`);
  }
}
function getAllOpenedFilesExperimental(app) {
  var _a;
  let tabGroups = (_a = app.workspace.getLayout().main) == null ? void 0 : _a.children;
  let out = [];
  for (const el of tabGroups) {
    out.push(...el.children);
  }
  return out;
}
function navigateToOpenFileByPath(filePath, experimentalGoto, app) {
  if (experimentalGoto) {
    const openedFiles = getAllOpenedFilesExperimental(app);
    for (const openedFile of openedFiles) {
      if (openedFile.type == "leaf" && openedFile.state.state.file === filePath) {
        const leaf = app.workspace.getLeafById(openedFile.id);
        if (leaf && leaf.parent === app.workspace.getLeaf().parent) {
          app.workspace.setActiveLeaf(leaf, { focus: true });
          return true;
        }
      }
    }
  } else {
    const leaves = app.workspace.getLeavesOfType("markdown");
    for (const leaf of leaves) {
      const view = leaf.view;
      if (view instanceof import_obsidian.MarkdownView && view.file && view.file.path === filePath && leaf.parent === app.workspace.getLeaf().parent) {
        app.workspace.setActiveLeaf(leaf, { focus: true });
        return true;
      }
    }
  }
  return false;
}

// src/ui/MarkListModal.ts
var MarkListModal = class extends import_obsidian2.SuggestModal {
  constructor(app, plugin, mode, isHarpoonMode = false) {
    super(app);
    this.plugin = plugin;
    this.mode = mode;
    this.setPlaceholder(modalPlaceholderMessages[this.mode]);
    this.isHarpoonMode = isHarpoonMode;
  }
  getSuggestions(query) {
    return getSortedAndFilteredMarks(this.plugin.marks, this.isHarpoonMode, this.plugin.settings);
  }
  renderSuggestion(mark, el) {
    el.createEl("span", { text: mark.symbol, cls: modalMarkSymbolClass });
    el.createEl("span", { text: mark.filePath, cls: modalMarkFilepathClass });
    el.addEventListener("click", async (evt) => {
      await this.onChooseSuggestion(mark, evt);
      this.close();
    });
  }
  // Override to hide the input box
  onOpen() {
    super.onOpen();
    if (this.inputEl) {
      this.inputEl.style.display = "none";
    }
    this.modalEl.addClass("marks-modal");
    const modalKeybinds = prepareKeybinds(import_obsidian2.Platform.isMacOS, this.plugin.settings);
    const modalInstructions = this.prepareModalInstructionElement(modalKeybinds);
    this.modalEl.appendChild(modalInstructions);
    this._keyHandler = this.getModalKeyHandler(modalKeybinds);
    window.addEventListener("keydown", this._keyHandler, true);
  }
  onClose() {
    const instructions = this.modalEl.querySelector("." + modalInstructionElClass);
    if (instructions)
      instructions.remove();
    if (this._keyHandler) {
      window.removeEventListener("keydown", this._keyHandler, true);
      this._keyHandler = void 0;
    }
    super.onClose();
  }
  prepareModalInstructionElement(keybinds) {
    const instructions = document.createElement("div");
    instructions.addClass(modalInstructionElClass);
    const formatKeys = (keys) => keys.map(
      (k) => `<kbd>${k.replace("cmd", "\u2318").replace("ctrl", "Ctrl").replace("alt", "Alt").replace("shift", "Shift")}</kbd>`
    ).join("/");
    instructions.innerHTML = `
            <span>${formatKeys(keybinds.up)} : Up</span>
            <span>${formatKeys(keybinds.down)} : Down</span>
            <span>${formatKeys(keybinds.delete)} : Delete</span>
            <span><kbd>Symbol</kbd> : Jump/Set/Delete</span>
            <span>${formatKeys(keybinds.select)} : Confirm</span>
            <span><kbd>Esc</kbd> : Close</span>

        `;
    return instructions;
  }
  getModalKeyHandler(keybinds) {
    return async (evt) => {
      const availableRegisters = new Set((!this.isHarpoonMode ? this.plugin.settings.registerList : this.plugin.settings.harpoonRegisterList).split(""));
      const chooser = this.chooser;
      if (keybinds.up.some((kb) => matchKeybind(evt, kb))) {
        evt.preventDefault();
        this.moveSelection(-1);
      } else if (keybinds.down.some((kb) => matchKeybind(evt, kb))) {
        evt.preventDefault();
        this.moveSelection(1);
      } else if (keybinds.delete.some((kb) => matchKeybind(evt, kb))) {
        evt.preventDefault();
        const prevIdx = chooser.selectedItem;
        const selected = chooser.values[prevIdx];
        if (selected) {
          await this.deleteMark(selected);
          chooser.values = getSortedAndFilteredMarks(this.plugin.marks, this.isHarpoonMode, this.plugin.settings);
          chooser.setSuggestions(chooser.values);
          let newIdx = prevIdx;
          if (newIdx >= chooser.values.length) {
            newIdx = chooser.values.length - 1;
          }
          chooser.setSelectedItem(Math.max(0, newIdx), false);
        }
      } else if (keybinds.select.some((kb) => matchKeybind(evt, kb))) {
        evt.preventDefault();
        const ind = chooser.selectedItem;
        const selected = chooser.values[ind];
        if (selected) {
          this.onChooseSuggestion(selected, evt);
          this.close();
        }
      } else if (availableRegisters.has(evt.key)) {
        let mark = getMarkBySymbol(this.plugin.marks, evt.key);
        if (this.mode === "set") {
          if (mark == null) {
            const file = this.app.workspace.getActiveFile();
            if (!file) {
              new import_obsidian2.Notice("No active file to mark.");
              return;
            }
            mark = { symbol: evt.key, filePath: file.path };
          }
          evt.preventDefault();
          await this.onChooseSuggestion(mark, evt);
          this.close();
        } else if (this.mode === "goto" && mark) {
          evt.preventDefault();
          await this.onChooseSuggestion(mark, evt);
          this.close();
        } else if (this.mode === "delete" && mark) {
          evt.preventDefault();
          await this.onChooseSuggestion(mark, evt);
          this.close();
        }
      }
    };
  }
  async onChooseSuggestion(mark, evt) {
    if (this.mode === "set") {
      this.setNewOrOverwriteMark(mark);
    } else if (this.mode === "goto") {
      this.goToMark(mark);
    } else if (this.mode === "delete") {
      this.deleteMark(mark);
    }
  }
  moveSelection(delta) {
    const chooser = this.chooser;
    if (!chooser)
      return;
    let idx = chooser.selectedItem;
    if (typeof idx !== "number")
      idx = 0;
    const max = chooser.values.length;
    let next = idx + delta;
    if (next < 0)
      next = max - 1;
    if (next >= max)
      next = 0;
    chooser.setSelectedItem(next, 0);
  }
  async setNewOrOverwriteMark(mark) {
    const file = this.app.workspace.getActiveFile();
    if (!file) {
      new import_obsidian2.Notice("No active file to mark.");
      return;
    }
    const marks = setNewOrOverwriteMark(this.plugin.marks, mark, file.path);
    await this.plugin.saveMarks(marks);
    new import_obsidian2.Notice(`Set mark '${mark.symbol}' to ${file.name}`);
  }
  goToMark(mark) {
    const success = navigateToOpenFileByPath(mark.filePath, this.plugin.settings.experimentalGoto, this.app);
    if (!success) {
      openNewFile(mark.filePath, this.plugin.settings.openMarkInNewTab, this.app);
    }
  }
  async deleteMark(mark) {
    const cMark = { ...mark };
    const filteredMarks = this.plugin.marks.filter((m) => m.symbol !== cMark.symbol);
    await this.plugin.saveMarks(filteredMarks);
    if (this.plugin.settings.harpoonRegisterGapRemoval) {
      this.removeGapsForHarpoonMarks();
    }
    new import_obsidian2.Notice(`Deleted mark '${cMark.symbol}'`);
  }
  addFileToHarpoon() {
    var _a;
    const harpoonRegisters = this.plugin.settings.harpoonRegisterList.split("");
    const reg = findFirstUnusedRegister(this.plugin.marks, harpoonRegisters);
    if (!reg) {
      new import_obsidian2.Notice("Harpoon registers are full, cannot add more marks.");
    } else {
      this.setNewOrOverwriteMark({ symbol: reg, filePath: ((_a = this.app.workspace.getActiveFile()) == null ? void 0 : _a.path) || "" });
    }
  }
  async removeGapsForHarpoonMarks() {
    const harpoonRegisters = this.plugin.settings.harpoonRegisterList.split("");
    const marks = removeGapsForHarpoonMarks(this.plugin.marks, harpoonRegisters);
    await this.plugin.saveMarks(marks);
  }
};

// src/commands.ts
async function setGlobalMark(plugin) {
  new MarkListModal(plugin.app, plugin, "set").open();
}
async function goToGlobalMark(plugin) {
  new MarkListModal(plugin.app, plugin, "goto").open();
}
async function deleteGlobalMark(plugin) {
  new MarkListModal(plugin.app, plugin, "delete").open();
}
async function addFileToHarpoon(plugin) {
  new MarkListModal(plugin.app, plugin, "goto").addFileToHarpoon();
}
async function goToHarpoonMark(plugin) {
  new MarkListModal(plugin.app, plugin, "goto", true).open();
}

// src/ui/SettingsTab.ts
var import_obsidian3 = require("obsidian");
var SettingsTab = class extends import_obsidian3.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    const ds = defaultSettings;
    containerEl.createEl("h4", { text: "General" });
    this.createRegisterListSetting(containerEl, "Register list", ds.registerList, "Key symbols to be used as registers. Only include symbols that you can input with a single keystroke.", "registerList").addExtraButton((btn) => {
      btn.setIcon("refresh-ccw").setTooltip("Reset to default register list").onClick(
        async () => {
          this.plugin.settings.registerList = ds.registerList;
          await this.plugin.saveSettings();
          this.display();
        }
      );
    });
    new import_obsidian3.Setting(containerEl).setName("Sort all marks by register list").setDesc("Sort marks by the order of the key symbols in the register list. If disabled, marks will be sorted alphabetically according to the current locale.").addToggle(
      (toggle) => {
        var _a;
        return toggle.setValue((_a = this.plugin.settings.registerSortByList) != null ? _a : ds.registerSortByList).onChange(async (value) => {
          this.plugin.settings.registerSortByList = value;
          await this.plugin.saveSettings();
        });
      }
    );
    new import_obsidian3.Setting(containerEl).setName("Open mark in new tab").setDesc('Open a file in the new tab when using "go to" command. If disabled, it will open the file in the current tab.').addToggle(
      (toggle) => {
        var _a;
        return toggle.setValue((_a = this.plugin.settings.openMarkInNewTab) != null ? _a : ds.openMarkInNewTab).onChange(async (value) => {
          this.plugin.settings.openMarkInNewTab = value;
          await this.plugin.saveSettings();
        });
      }
    );
    new import_obsidian3.Setting(containerEl).setName("No duplication of opened files when using goto (experimental)").setDesc("Prevents duplicate tabs when switching to already opened files using the mark list after restarting Obsidian. (Experimental: may not work in future Obsidian versions.)").addToggle(
      (toggle) => {
        var _a;
        return toggle.setValue((_a = this.plugin.settings.experimentalGoto) != null ? _a : ds.experimentalGoto).onChange(async (value) => {
          this.plugin.settings.experimentalGoto = value;
          await this.plugin.saveSettings();
        });
      }
    );
    containerEl.createEl("h4", { text: "Harpoon registers" });
    this.createRegisterListSetting(containerEl, "Harpoon register list", ds.harpoonRegisterList, "Key symbols to be used as Harpoon registers. Only include symbols that you can input with a single keystroke.", "harpoonRegisterList").addExtraButton((btn) => {
      btn.setIcon("refresh-ccw").setTooltip("Reset to default Harpoon register list").onClick(
        async () => {
          this.plugin.settings.harpoonRegisterList = ds.harpoonRegisterList;
          await this.plugin.saveSettings();
          this.display();
        }
      );
    });
    new import_obsidian3.Setting(containerEl).setName("Sort Harpoon marks by Harpoon register list").setDesc("Sort Harpoon marks by the order of the key symbols in the Harpoon register list. If disabled, marks will be sorted alphabetically according to the current locale.").addToggle(
      (toggle) => {
        var _a;
        return toggle.setValue((_a = this.plugin.settings.harpoonRegisterSortByList) != null ? _a : ds.harpoonRegisterSortByList).onChange(async (value) => {
          this.plugin.settings.harpoonRegisterSortByList = value;
          await this.plugin.saveSettings();
        });
      }
    );
    new import_obsidian3.Setting(containerEl).setName("Remove gaps inbetween Harpoon marks").setDesc("Harpoon marks will be shifted to the left for every gap (register with no mark) based on the order of the Harpoon register list.").addToggle(
      (toggle) => {
        var _a;
        return toggle.setValue((_a = this.plugin.settings.harpoonRegisterGapRemoval) != null ? _a : ds.harpoonRegisterGapRemoval).onChange(async (value) => {
          this.plugin.settings.harpoonRegisterGapRemoval = value;
          await this.plugin.saveSettings();
        });
      }
    );
    containerEl.createEl("h4", { text: "List navigation shortcuts" });
    this.createShortcutSetting(containerEl, "Up", ds.modalListUp, "Shortcut for moving up in the list", "markListUp");
    this.createShortcutSetting(containerEl, "Down", ds.modalListDown, "Shortcut for moving down in the list", "markListDown");
    this.createShortcutSetting(containerEl, "Select", ds.modalListSelect, "Shortcut for selecting a mark", "markListSelect");
    this.createShortcutSetting(containerEl, "Delete", ds.modalListDelete, "Shortcut for deleting a mark", "markListDelete");
  }
  // use only for string values from Settings type
  createShortcutSetting(containerEl, name, defaultValue, desc, key) {
    new import_obsidian3.Setting(containerEl).setName(name).setDesc(desc).addText((text) => {
      var _a;
      return text.setValue(String((_a = this.plugin.settings[key]) != null ? _a : defaultValue)).onChange(async (value) => {
        this.plugin.settings[key] = value;
        await this.plugin.saveSettings();
      });
    });
  }
  createRegisterListSetting(containerEl, name, defaultValue, desc, key) {
    return new import_obsidian3.Setting(containerEl).setName(name).setDesc(desc).addText((text) => {
      var _a;
      return text.setValue(String((_a = this.plugin.settings[key]) != null ? _a : defaultValue)).onChange(async (value) => {
        this.plugin.settings[key] = value;
        await this.plugin.saveSettings();
      });
    });
  }
};

// src/utils/storage.ts
async function loadSettings(plugin) {
  var _a;
  return ((_a = await plugin.loadData()) == null ? void 0 : _a.settings) || defaultSettings;
}
async function saveSettings(plugin, settings) {
  const data = await plugin.loadData() || {};
  data.settings = settings;
  await plugin.saveData(data);
}
async function loadMarks(plugin) {
  var _a;
  return ((_a = await plugin.loadData()) == null ? void 0 : _a.marks) || [];
}
async function saveMarks(plugin, marks) {
  const data = await plugin.loadData() || {};
  data.marks = marks;
  await plugin.saveData(data);
}
async function JSONschemaCheck(plugin) {
  const data = await plugin.loadData() || { schemaVersion: JSONschemaVersion };
  if (data.schemaVersion && data.schemaVersion === JSONschemaVersion) {
    return;
  }
  console.log("tether-marks: The data loaded is not in correct format. The plugin may not work correctly. This will usually happen after plugin update that changes JSON schema. ");
}

// src/main.ts
var VimMarksImpl = class extends import_obsidian4.Plugin {
  constructor() {
    super(...arguments);
    this.marks = [];
  }
  async onload() {
    await JSONschemaCheck(this);
    this.settings = await loadSettings(this);
    this.marks = await loadMarks(this);
    this.addCommand({
      id: "set-global-mark",
      name: "Set mark",
      callback: () => setGlobalMark(this)
    });
    this.addCommand({
      id: "go-to-global-mark",
      name: "Go to mark",
      callback: () => goToGlobalMark(this)
    });
    this.addCommand({
      id: "delete-global-mark",
      name: "Delete mark",
      callback: () => deleteGlobalMark(this)
    });
    this.addCommand({
      id: "add-file-to-harpoon",
      name: "Add file to Harpoon",
      callback: () => addFileToHarpoon(this)
    });
    this.addCommand({
      id: "go-to-harpoon-mark",
      name: "Go to Harpoon mark",
      callback: () => goToHarpoonMark(this)
    });
    this.addSettingTab(new SettingsTab(this.app, this));
    console.log("loading tether-marks");
  }
  async saveSettings() {
    await saveSettings(this, this.settings);
  }
  async saveMarks(marks) {
    this.marks = marks;
    await saveMarks(this, marks);
  }
  onunload() {
    console.log("unloading tether-marks");
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsic3JjL21haW4udHMiLCAic3JjL3VpL01hcmtMaXN0TW9kYWwudHMiLCAic3JjL3V0aWxzL2RlZmF1bHRWYWx1ZXMudHMiLCAic3JjL3V0aWxzL21hcmtzLnRzIiwgInNyYy91dGlscy9rZXliaW5kcy50cyIsICJzcmMvdXRpbHMvb2JzaWRpYW5VdGlscy50cyIsICJzcmMvY29tbWFuZHMudHMiLCAic3JjL3VpL1NldHRpbmdzVGFiLnRzIiwgInNyYy91dGlscy9zdG9yYWdlLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJpbXBvcnQgeyBQbHVnaW4gfSBmcm9tICdvYnNpZGlhbic7XG5pbXBvcnQgeyBzZXRHbG9iYWxNYXJrLCBnb1RvR2xvYmFsTWFyaywgZ29Ub0hhcnBvb25NYXJrLCBhZGRGaWxlVG9IYXJwb29uLCBkZWxldGVHbG9iYWxNYXJrIH0gZnJvbSAnLi9jb21tYW5kcyc7XG5pbXBvcnQgeyBTZXR0aW5nc1RhYiB9IGZyb20gJy4vdWkvU2V0dGluZ3NUYWInO1xuaW1wb3J0IHsgbG9hZFNldHRpbmdzLCBzYXZlU2V0dGluZ3MsIGxvYWRNYXJrcywgc2F2ZU1hcmtzLCBKU09Oc2NoZW1hQ2hlY2sgfSBmcm9tICcuL3V0aWxzL3N0b3JhZ2UnO1xuaW1wb3J0IHsgU2V0dGluZ3MsIE1hcmsgfSBmcm9tICcuL3R5cGVzL2luZGV4JztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVmltTWFya3NJbXBsIGV4dGVuZHMgUGx1Z2luIHtcbiAgICBzZXR0aW5ncyE6IFNldHRpbmdzO1xuICAgIG1hcmtzOiBNYXJrW10gPSBbXTtcblxuICAgIGFzeW5jIG9ubG9hZCgpIHtcbiAgICAgICAgYXdhaXQgSlNPTnNjaGVtYUNoZWNrKHRoaXMpO1xuXG4gICAgICAgIHRoaXMuc2V0dGluZ3MgPSBhd2FpdCBsb2FkU2V0dGluZ3ModGhpcyk7XG4gICAgICAgIHRoaXMubWFya3MgPSBhd2FpdCBsb2FkTWFya3ModGhpcyk7XG5cbiAgICAgICAgdGhpcy5hZGRDb21tYW5kKHtcbiAgICAgICAgICAgIGlkOiAnc2V0LWdsb2JhbC1tYXJrJyxcbiAgICAgICAgICAgIG5hbWU6ICdTZXQgbWFyaycsXG4gICAgICAgICAgICBjYWxsYmFjazogKCkgPT4gc2V0R2xvYmFsTWFyayh0aGlzKSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5hZGRDb21tYW5kKHtcbiAgICAgICAgICAgIGlkOiAnZ28tdG8tZ2xvYmFsLW1hcmsnLFxuICAgICAgICAgICAgbmFtZTogJ0dvIHRvIG1hcmsnLFxuICAgICAgICAgICAgY2FsbGJhY2s6ICgpID0+IGdvVG9HbG9iYWxNYXJrKHRoaXMpLFxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmFkZENvbW1hbmQoe1xuICAgICAgICAgICAgaWQ6ICdkZWxldGUtZ2xvYmFsLW1hcmsnLFxuICAgICAgICAgICAgbmFtZTogJ0RlbGV0ZSBtYXJrJyxcbiAgICAgICAgICAgIGNhbGxiYWNrOiAoKSA9PiBkZWxldGVHbG9iYWxNYXJrKHRoaXMpLFxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmFkZENvbW1hbmQoe1xuICAgICAgICAgICAgaWQ6ICdhZGQtZmlsZS10by1oYXJwb29uJyxcbiAgICAgICAgICAgIG5hbWU6ICdBZGQgZmlsZSB0byBIYXJwb29uJyxcbiAgICAgICAgICAgIGNhbGxiYWNrOiAoKSA9PiBhZGRGaWxlVG9IYXJwb29uKHRoaXMpLFxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmFkZENvbW1hbmQoe1xuICAgICAgICAgICAgaWQ6ICdnby10by1oYXJwb29uLW1hcmsnLFxuICAgICAgICAgICAgbmFtZTogJ0dvIHRvIEhhcnBvb24gbWFyaycsXG4gICAgICAgICAgICBjYWxsYmFjazogKCkgPT4gZ29Ub0hhcnBvb25NYXJrKHRoaXMpLFxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmFkZFNldHRpbmdUYWIobmV3IFNldHRpbmdzVGFiKHRoaXMuYXBwLCB0aGlzKSk7XG5cbiAgICAgICAgY29uc29sZS5sb2coJ2xvYWRpbmcgdGV0aGVyLW1hcmtzJyk7XG4gICAgfVxuXG4gICAgYXN5bmMgc2F2ZVNldHRpbmdzKCkge1xuICAgICAgICBhd2FpdCBzYXZlU2V0dGluZ3ModGhpcywgdGhpcy5zZXR0aW5ncyk7XG4gICAgfVxuXG4gICAgYXN5bmMgc2F2ZU1hcmtzKG1hcmtzOiBNYXJrW10pIHtcbiAgICAgICAgdGhpcy5tYXJrcyA9IG1hcmtzO1xuICAgICAgICBhd2FpdCBzYXZlTWFya3ModGhpcywgbWFya3MpO1xuICAgIH1cblxuICAgIG9udW5sb2FkKCkge1xuICAgICAgICAvLyBQb3RlbnRpYWwgY2xlYW51cFxuICAgICAgICBjb25zb2xlLmxvZygndW5sb2FkaW5nIHRldGhlci1tYXJrcycpO1xuICAgIH1cbn0iLCAiaW1wb3J0IHsgQXBwLCBOb3RpY2UsIFN1Z2dlc3RNb2RhbCwgUGxhdGZvcm0gfSBmcm9tICdvYnNpZGlhbic7XG5pbXBvcnQgVmltTWFya3NJbXBsIGZyb20gJy4uL21haW4nO1xuaW1wb3J0IHsgTW9kYWxLZXliaW5kcywgTWFyayB9IGZyb20gJy4uL3R5cGVzL2luZGV4JztcbmltcG9ydCB7IG1vZGFsSW5zdHJ1Y3Rpb25FbENsYXNzLCBtb2RhbE1hcmtGaWxlcGF0aENsYXNzLCBtb2RhbE1hcmtTeW1ib2xDbGFzcywgTW9kZSwgbW9kYWxQbGFjZWhvbGRlck1lc3NhZ2VzIH0gZnJvbSAnLi4vdXRpbHMvZGVmYXVsdFZhbHVlcyc7XG5pbXBvcnQgeyBmaW5kRmlyc3RVbnVzZWRSZWdpc3RlciwgZ2V0TWFya0J5U3ltYm9sLCBnZXRTb3J0ZWRBbmRGaWx0ZXJlZE1hcmtzLCByZW1vdmVHYXBzRm9ySGFycG9vbk1hcmtzLCBzZXROZXdPck92ZXJ3cml0ZU1hcmsgfSBmcm9tICcuLi91dGlscy9tYXJrcyc7XG5pbXBvcnQgeyBtYXRjaEtleWJpbmQsIHByZXBhcmVLZXliaW5kcyB9IGZyb20gJy4uL3V0aWxzL2tleWJpbmRzJztcbmltcG9ydCB7IG5hdmlnYXRlVG9PcGVuRmlsZUJ5UGF0aCwgb3Blbk5ld0ZpbGUgYXMgb3Blbk5ld0ZpbGVCeVBhdGggfSBmcm9tICcuLi91dGlscy9vYnNpZGlhblV0aWxzJztcblxuXG5leHBvcnQgY2xhc3MgTWFya0xpc3RNb2RhbCBleHRlbmRzIFN1Z2dlc3RNb2RhbDxNYXJrPiB7XG4gICAgcGx1Z2luOiBWaW1NYXJrc0ltcGw7XG4gICAgbW9kZTogTW9kZTtcbiAgICBwcml2YXRlIF9rZXlIYW5kbGVyPzogKGV2dDogS2V5Ym9hcmRFdmVudCkgPT4gdm9pZDtcbiAgICBpc0hhcnBvb25Nb2RlOiBib29sZWFuO1xuXG4gICAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogVmltTWFya3NJbXBsLCBtb2RlOiBNb2RlLCBpc0hhcnBvb25Nb2RlOiBib29sZWFuID0gZmFsc2UpIHtcbiAgICAgICAgc3VwZXIoYXBwKTtcbiAgICAgICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgICAgIHRoaXMubW9kZSA9IG1vZGU7XG4gICAgICAgIC8vIHRoaXMubWFya3MgPSBwbHVnaW4ubWFya3M7XG4gICAgICAgIHRoaXMuc2V0UGxhY2Vob2xkZXIobW9kYWxQbGFjZWhvbGRlck1lc3NhZ2VzW3RoaXMubW9kZV0pO1xuICAgICAgICAvLyB0aGlzLnNldEluc3RydWN0aW9ucyhbe2NvbW1hbmQ6ICd2aW0tbWFya3M6bWFyay1saXN0JywgcHVycG9zZTogXCJhc2RmXCJ9XSk7XG4gICAgICAgIHRoaXMuaXNIYXJwb29uTW9kZSA9IGlzSGFycG9vbk1vZGU7IC8vIERlZmF1bHQgdG8gZmFsc2UsIGNhbiBiZSBzZXQgZXh0ZXJuYWxseVxuICAgIH1cblxuICAgIGdldFN1Z2dlc3Rpb25zKHF1ZXJ5OiBzdHJpbmcpOiBNYXJrW10ge1xuICAgICAgICAvLyBObyBzZWFyY2ggaW5wdXQsIGFsd2F5cyBzaG93IGFsbCBtYXJrc1xuICAgICAgICByZXR1cm4gZ2V0U29ydGVkQW5kRmlsdGVyZWRNYXJrcyh0aGlzLnBsdWdpbi5tYXJrcywgdGhpcy5pc0hhcnBvb25Nb2RlLCB0aGlzLnBsdWdpbi5zZXR0aW5ncyk7XG4gICAgfVxuXG4gICAgcmVuZGVyU3VnZ2VzdGlvbihtYXJrOiBNYXJrLCBlbDogSFRNTEVsZW1lbnQpIHtcbiAgICAgICAgZWwuY3JlYXRlRWwoJ3NwYW4nLCB7IHRleHQ6IG1hcmsuc3ltYm9sLCBjbHM6IG1vZGFsTWFya1N5bWJvbENsYXNzIH0pO1xuICAgICAgICBlbC5jcmVhdGVFbCgnc3BhbicsIHsgdGV4dDogbWFyay5maWxlUGF0aCwgY2xzOiBtb2RhbE1hcmtGaWxlcGF0aENsYXNzIH0pO1xuICAgICAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jIChldnQpID0+IHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMub25DaG9vc2VTdWdnZXN0aW9uKG1hcmssIGV2dCk7XG4gICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIE92ZXJyaWRlIHRvIGhpZGUgdGhlIGlucHV0IGJveFxuICAgIG9uT3BlbigpIHtcbiAgICAgICAgc3VwZXIub25PcGVuKCk7XG4gICAgICAgIGlmICh0aGlzLmlucHV0RWwpIHtcbiAgICAgICAgICAgIHRoaXMuaW5wdXRFbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubW9kYWxFbC5hZGRDbGFzcygnbWFya3MtbW9kYWwnKTtcblxuICAgICAgICBjb25zdCBtb2RhbEtleWJpbmRzID0gcHJlcGFyZUtleWJpbmRzKFBsYXRmb3JtLmlzTWFjT1MsIHRoaXMucGx1Z2luLnNldHRpbmdzKTtcblxuICAgICAgICAvLyBQcm9tcHQgaW5zdHJ1Y3Rpb25zIHBhbmVsXG4gICAgICAgIGNvbnN0IG1vZGFsSW5zdHJ1Y3Rpb25zID0gdGhpcy5wcmVwYXJlTW9kYWxJbnN0cnVjdGlvbkVsZW1lbnQobW9kYWxLZXliaW5kcyk7XG5cbiAgICAgICAgLy8gSW5zZXJ0IGluc3RydWN0aW9ucyBwYW5lbCBhdCB0aGUgYm90dG9tIG9mIHRoZSBtb2RhbFxuICAgICAgICB0aGlzLm1vZGFsRWwuYXBwZW5kQ2hpbGQobW9kYWxJbnN0cnVjdGlvbnMpO1xuXG4gICAgICAgIHRoaXMuX2tleUhhbmRsZXIgPSB0aGlzLmdldE1vZGFsS2V5SGFuZGxlcihtb2RhbEtleWJpbmRzKTtcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLl9rZXlIYW5kbGVyLCB0cnVlKTtcbiAgICB9XG5cbiAgICBvbkNsb3NlKCkge1xuICAgICAgICAvLyBSZW1vdmUgaW5zdHJ1Y3Rpb25zIHBhbmVsIGlmIHByZXNlbnRcbiAgICAgICAgY29uc3QgaW5zdHJ1Y3Rpb25zID0gdGhpcy5tb2RhbEVsLnF1ZXJ5U2VsZWN0b3IoXCIuXCIgKyBtb2RhbEluc3RydWN0aW9uRWxDbGFzcyk7XG4gICAgICAgIGlmIChpbnN0cnVjdGlvbnMpIGluc3RydWN0aW9ucy5yZW1vdmUoKTtcblxuICAgICAgICBpZiAodGhpcy5fa2V5SGFuZGxlcikge1xuICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLl9rZXlIYW5kbGVyLCB0cnVlKTtcbiAgICAgICAgICAgIHRoaXMuX2tleUhhbmRsZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgICAgc3VwZXIub25DbG9zZSgpO1xuICAgIH1cblxuICAgIHByaXZhdGUgcHJlcGFyZU1vZGFsSW5zdHJ1Y3Rpb25FbGVtZW50KGtleWJpbmRzOiBNb2RhbEtleWJpbmRzKSB7XG4gICAgICAgIGNvbnN0IGluc3RydWN0aW9ucyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBpbnN0cnVjdGlvbnMuYWRkQ2xhc3MobW9kYWxJbnN0cnVjdGlvbkVsQ2xhc3MpO1xuICAgICAgICAvLyBIZWxwZXIgdG8gZm9ybWF0IGtleWJpbmRzIGZvciBkaXNwbGF5XG4gICAgICAgIGNvbnN0IGZvcm1hdEtleXMgPSAoa2V5czogc3RyaW5nW10pID0+IGtleXMubWFwKFxuICAgICAgICAgICAgayA9PiBgPGtiZD4ke2sucmVwbGFjZSgnY21kJywgJ1x1MjMxOCcpLnJlcGxhY2UoJ2N0cmwnLCAnQ3RybCcpLnJlcGxhY2UoJ2FsdCcsICdBbHQnKS5yZXBsYWNlKCdzaGlmdCcsICdTaGlmdCcpfTwva2JkPmBcbiAgICAgICAgKS5qb2luKCcvJyk7XG5cbiAgICAgICAgaW5zdHJ1Y3Rpb25zLmlubmVySFRNTCA9IGBcbiAgICAgICAgICAgIDxzcGFuPiR7Zm9ybWF0S2V5cyhrZXliaW5kcy51cCl9IDogVXA8L3NwYW4+XG4gICAgICAgICAgICA8c3Bhbj4ke2Zvcm1hdEtleXMoa2V5YmluZHMuZG93bil9IDogRG93bjwvc3Bhbj5cbiAgICAgICAgICAgIDxzcGFuPiR7Zm9ybWF0S2V5cyhrZXliaW5kcy5kZWxldGUpfSA6IERlbGV0ZTwvc3Bhbj5cbiAgICAgICAgICAgIDxzcGFuPjxrYmQ+U3ltYm9sPC9rYmQ+IDogSnVtcC9TZXQvRGVsZXRlPC9zcGFuPlxuICAgICAgICAgICAgPHNwYW4+JHtmb3JtYXRLZXlzKGtleWJpbmRzLnNlbGVjdCl9IDogQ29uZmlybTwvc3Bhbj5cbiAgICAgICAgICAgIDxzcGFuPjxrYmQ+RXNjPC9rYmQ+IDogQ2xvc2U8L3NwYW4+XG5cbiAgICAgICAgYDtcbiAgICAgICAgcmV0dXJuIGluc3RydWN0aW9ucztcbiAgICB9XG5cbiAgICBnZXRNb2RhbEtleUhhbmRsZXIoa2V5YmluZHM6IE1vZGFsS2V5YmluZHMpIHtcbiAgICAgICAgcmV0dXJuIGFzeW5jIChldnQ6IEtleWJvYXJkRXZlbnQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGF2YWlsYWJsZVJlZ2lzdGVycyA9IG5ldyBTZXQoKCF0aGlzLmlzSGFycG9vbk1vZGUgPyB0aGlzLnBsdWdpbi5zZXR0aW5ncy5yZWdpc3Rlckxpc3QgOiB0aGlzLnBsdWdpbi5zZXR0aW5ncy5oYXJwb29uUmVnaXN0ZXJMaXN0KS5zcGxpdCgnJykpO1xuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgY29uc3QgY2hvb3NlciA9IHRoaXMuY2hvb3NlcjtcbiAgICAgICAgICAgIGlmIChrZXliaW5kcy51cC5zb21lKGtiID0+IG1hdGNoS2V5YmluZChldnQsIGtiKSkpIHtcbiAgICAgICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLm1vdmVTZWxlY3Rpb24oLTEpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChrZXliaW5kcy5kb3duLnNvbWUoa2IgPT4gbWF0Y2hLZXliaW5kKGV2dCwga2IpKSkge1xuICAgICAgICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIHRoaXMubW92ZVNlbGVjdGlvbigxKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoa2V5YmluZHMuZGVsZXRlLnNvbWUoa2IgPT4gbWF0Y2hLZXliaW5kKGV2dCwga2IpKSkge1xuICAgICAgICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIC8vIERlbGV0ZSB0aGUgY3VycmVudGx5IHNlbGVjdGVkIG1hcmtcbiAgICAgICAgICAgICAgICBjb25zdCBwcmV2SWR4ID0gY2hvb3Nlci5zZWxlY3RlZEl0ZW07XG4gICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWQ6IE1hcmsgPSBjaG9vc2VyLnZhbHVlc1twcmV2SWR4XTtcbiAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5kZWxldGVNYXJrKHNlbGVjdGVkKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gUmVmcmVzaCB0aGUgbW9kYWwgbGlzdFxuICAgICAgICAgICAgICAgICAgICBjaG9vc2VyLnZhbHVlcyA9IGdldFNvcnRlZEFuZEZpbHRlcmVkTWFya3ModGhpcy5wbHVnaW4ubWFya3MsIHRoaXMuaXNIYXJwb29uTW9kZSwgdGhpcy5wbHVnaW4uc2V0dGluZ3MpO1xuICAgICAgICAgICAgICAgICAgICBjaG9vc2VyLnNldFN1Z2dlc3Rpb25zKGNob29zZXIudmFsdWVzKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gUHJlc2VydmUgc2VsZWN0aW9uIGluZGV4XG4gICAgICAgICAgICAgICAgICAgIGxldCBuZXdJZHggPSBwcmV2SWR4O1xuICAgICAgICAgICAgICAgICAgICBpZiAobmV3SWR4ID49IGNob29zZXIudmFsdWVzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV3SWR4ID0gY2hvb3Nlci52YWx1ZXMubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjaG9vc2VyLnNldFNlbGVjdGVkSXRlbShNYXRoLm1heCgwLCBuZXdJZHgpLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmIChrZXliaW5kcy5zZWxlY3Quc29tZShrYiA9PiBtYXRjaEtleWJpbmQoZXZ0LCBrYikpKSB7XG4gICAgICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgLy8gRGVsZXRlIHRoZSBjdXJyZW50bHkgc2VsZWN0ZWQgbWFya1xuICAgICAgICAgICAgICAgIGNvbnN0IGluZCA9IGNob29zZXIuc2VsZWN0ZWRJdGVtO1xuICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkOiBNYXJrID0gY2hvb3Nlci52YWx1ZXNbaW5kXTtcbiAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkNob29zZVN1Z2dlc3Rpb24oc2VsZWN0ZWQsIGV2dCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGF2YWlsYWJsZVJlZ2lzdGVycy5oYXMoZXZ0LmtleSkpIHtcbiAgICAgICAgICAgICAgICBsZXQgbWFyayA9IGdldE1hcmtCeVN5bWJvbCh0aGlzLnBsdWdpbi5tYXJrcywgZXZ0LmtleSk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubW9kZSA9PT0gJ3NldCcpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1hcmsgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGEgbmV3IG1hcmsgZm9yIHRoaXMga2V5IHN5bWJvbFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZmlsZSA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVGaWxlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWZpbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgTm90aWNlKCdObyBhY3RpdmUgZmlsZSB0byBtYXJrLicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIG1hcmsgPSB7IHN5bWJvbDogZXZ0LmtleSwgZmlsZVBhdGg6IGZpbGUucGF0aCB9O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLm9uQ2hvb3NlU3VnZ2VzdGlvbihtYXJrLCBldnQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLm1vZGUgPT09ICdnb3RvJyAmJiBtYXJrKSB7XG4gICAgICAgICAgICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLm9uQ2hvb3NlU3VnZ2VzdGlvbihtYXJrLCBldnQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMubW9kZSA9PT0gJ2RlbGV0ZScgJiYgbWFyaykge1xuICAgICAgICAgICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5vbkNob29zZVN1Z2dlc3Rpb24obWFyaywgZXZ0KTtcbiAgICAgICAgICAgICAgICAgICAgLy8gUmVmcmVzaCB0aGUgbW9kYWwgbGlzdFxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cblxuICAgIGFzeW5jIG9uQ2hvb3NlU3VnZ2VzdGlvbihtYXJrOiBNYXJrLCBldnQ6IE1vdXNlRXZlbnQgfCBLZXlib2FyZEV2ZW50KSB7XG4gICAgICAgIGlmICh0aGlzLm1vZGUgPT09ICdzZXQnKSB7XG4gICAgICAgICAgICB0aGlzLnNldE5ld09yT3ZlcndyaXRlTWFyayhtYXJrKTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLm1vZGUgPT09ICdnb3RvJykge1xuICAgICAgICAgICAgdGhpcy5nb1RvTWFyayhtYXJrKTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLm1vZGUgPT09ICdkZWxldGUnKSB7XG4gICAgICAgICAgICB0aGlzLmRlbGV0ZU1hcmsobWFyayk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBtb3ZlU2VsZWN0aW9uKGRlbHRhOiBudW1iZXIpIHtcbiAgICAgICAgLy8gTW92ZSB0aGUgc2VsZWN0aW9uIHVwIG9yIGRvd24gYnkgZGVsdGFcbiAgICAgICAgLy8gdGhpcy5jaG9vc2VyIGlzIFN1Z2dlc3RNb2RhbCdzIGludGVybmFsIGNob29zZXJcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICBjb25zdCBjaG9vc2VyID0gdGhpcy5jaG9vc2VyO1xuICAgICAgICBpZiAoIWNob29zZXIpIHJldHVybjtcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICBsZXQgaWR4ID0gY2hvb3Nlci5zZWxlY3RlZEl0ZW07XG4gICAgICAgIGlmICh0eXBlb2YgaWR4ICE9PSAnbnVtYmVyJykgaWR4ID0gMDtcbiAgICAgICAgY29uc3QgbWF4ID0gY2hvb3Nlci52YWx1ZXMubGVuZ3RoO1xuICAgICAgICBsZXQgbmV4dCA9IGlkeCArIGRlbHRhO1xuICAgICAgICBpZiAobmV4dCA8IDApIG5leHQgPSBtYXggLSAxO1xuICAgICAgICBpZiAobmV4dCA+PSBtYXgpIG5leHQgPSAwO1xuICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgIGNob29zZXIuc2V0U2VsZWN0ZWRJdGVtKG5leHQsIDAgYXMgS2V5Ym9hcmRFdmVudCk7XG4gICAgfVxuXG4gICAgYXN5bmMgc2V0TmV3T3JPdmVyd3JpdGVNYXJrKG1hcms6IE1hcmspIHtcbiAgICAgICAgY29uc3QgZmlsZSA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVGaWxlKCk7XG4gICAgICAgIGlmICghZmlsZSkge1xuICAgICAgICAgICAgbmV3IE5vdGljZSgnTm8gYWN0aXZlIGZpbGUgdG8gbWFyay4nKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBtYXJrcyA9IHNldE5ld09yT3ZlcndyaXRlTWFyayh0aGlzLnBsdWdpbi5tYXJrcywgbWFyaywgZmlsZS5wYXRoKTtcbiAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZU1hcmtzKG1hcmtzKTtcbiAgICAgICAgbmV3IE5vdGljZShgU2V0IG1hcmsgJyR7bWFyay5zeW1ib2x9JyB0byAke2ZpbGUubmFtZX1gKTtcbiAgICB9XG5cbiAgICBnb1RvTWFyayhtYXJrOiBNYXJrKSB7XG4gICAgICAgIGNvbnN0IHN1Y2Nlc3MgPSBuYXZpZ2F0ZVRvT3BlbkZpbGVCeVBhdGgobWFyay5maWxlUGF0aCwgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZXhwZXJpbWVudGFsR290bywgdGhpcy5hcHApO1xuICAgICAgICAvLyBJZiBmaWxlIG5vdCBvcGVuLCB0aGVuIG9wZW4gaXQgaW4gdGhlIHByZWZlcnJlZCB0YWJcbiAgICAgICAgaWYgKCFzdWNjZXNzKSB7XG4gICAgICAgICAgICBvcGVuTmV3RmlsZUJ5UGF0aChtYXJrLmZpbGVQYXRoLCB0aGlzLnBsdWdpbi5zZXR0aW5ncy5vcGVuTWFya0luTmV3VGFiLCB0aGlzLmFwcCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIGRlbGV0ZU1hcmsobWFyazogTWFyaykge1xuICAgICAgICBjb25zdCBjTWFyayA9IHsgLi4ubWFyayB9O1xuICAgICAgICBjb25zdCBmaWx0ZXJlZE1hcmtzID0gdGhpcy5wbHVnaW4ubWFya3MuZmlsdGVyKG0gPT4gbS5zeW1ib2wgIT09IGNNYXJrLnN5bWJvbCk7XG4gICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVNYXJrcyhmaWx0ZXJlZE1hcmtzKTtcblxuICAgICAgICBpZiAodGhpcy5wbHVnaW4uc2V0dGluZ3MuaGFycG9vblJlZ2lzdGVyR2FwUmVtb3ZhbCkge1xuICAgICAgICAgICAgdGhpcy5yZW1vdmVHYXBzRm9ySGFycG9vbk1hcmtzKCk7XG4gICAgICAgIH1cblxuICAgICAgICBuZXcgTm90aWNlKGBEZWxldGVkIG1hcmsgJyR7Y01hcmsuc3ltYm9sfSdgKTtcbiAgICB9O1xuXG4gICAgYWRkRmlsZVRvSGFycG9vbigpIHtcbiAgICAgICAgLy8gQWRkIHRoZSBzZWxlY3RlZCBtYXJrIHRvIHRoZSBIYXJwb29uIGxpc3RcbiAgICAgICAgY29uc3QgaGFycG9vblJlZ2lzdGVycyA9IHRoaXMucGx1Z2luLnNldHRpbmdzLmhhcnBvb25SZWdpc3Rlckxpc3Quc3BsaXQoJycpO1xuICAgICAgICBjb25zdCByZWcgPSBmaW5kRmlyc3RVbnVzZWRSZWdpc3Rlcih0aGlzLnBsdWdpbi5tYXJrcywgaGFycG9vblJlZ2lzdGVycyk7XG5cbiAgICAgICAgaWYgKCFyZWcpIHtcbiAgICAgICAgICAgIC8vIElmIGFsbCByZWdpc3RlcnMgYXJlIHVzZWQsIHNob3cgYSBub3RpY2VcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoJ0hhcnBvb24gcmVnaXN0ZXJzIGFyZSBmdWxsLCBjYW5ub3QgYWRkIG1vcmUgbWFya3MuJyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnNldE5ld09yT3ZlcndyaXRlTWFyayh7IHN5bWJvbDogcmVnLCBmaWxlUGF0aDogdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZUZpbGUoKT8ucGF0aCB8fCAnJyB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIHJlbW92ZUdhcHNGb3JIYXJwb29uTWFya3MoKSB7XG4gICAgICAgIGNvbnN0IGhhcnBvb25SZWdpc3RlcnMgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5oYXJwb29uUmVnaXN0ZXJMaXN0LnNwbGl0KCcnKTtcbiAgICAgICAgY29uc3QgbWFya3MgPSByZW1vdmVHYXBzRm9ySGFycG9vbk1hcmtzKHRoaXMucGx1Z2luLm1hcmtzLCBoYXJwb29uUmVnaXN0ZXJzKTtcbiAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZU1hcmtzKG1hcmtzKTtcbiAgICB9XG5cbn0iLCAiaW1wb3J0IHsgTW9kYWxLZXliaW5kcyB9IGZyb20gXCIuLi90eXBlc1wiO1xyXG5cclxuZXhwb3J0IGNvbnN0IG1vZGFsRGVmYXVsdEtleWJpbmRzOiBNb2RhbEtleWJpbmRzID0ge1xyXG4gICAgdXA6IFsnY3RybCtrJywgJ2N0cmwrcCddIGFzIHN0cmluZ1tdLFxyXG4gICAgZG93bjogWydjdHJsK2onLCAnY3RybCtuJ10gYXMgc3RyaW5nW10sXHJcbiAgICBkZWxldGU6IFsnY3RybCtkJ10gYXMgc3RyaW5nW10sXHJcbiAgICBzZWxlY3Q6IFsnRW50ZXInXSBhcyBzdHJpbmdbXVxyXG59XHJcblxyXG5leHBvcnQgY29uc3QgbW9kYWxEZWZhdWx0S2V5YmluZHNNYWM6IE1vZGFsS2V5YmluZHMgPSB7XHJcbiAgICB1cDogWydjbWQraycsICdjbWQrcCddIGFzIHN0cmluZ1tdLFxyXG4gICAgZG93bjogWydjbWQraicsICdjbWQrbiddIGFzIHN0cmluZ1tdLFxyXG4gICAgZGVsZXRlOiBbJ2NtZCtkJ10gYXMgc3RyaW5nW10sXHJcbiAgICBzZWxlY3Q6IFsnRW50ZXInXSBhcyBzdHJpbmdbXVxyXG59XHJcblxyXG5leHBvcnQgY29uc3QgbW9kYWxQbGFjZWhvbGRlck1lc3NhZ2VzID0ge1xyXG4gICAgc2V0OiAnU2VsZWN0IGEgbWFyayB0byBzZXQnLFxyXG4gICAgZ290bzogJ1NlbGVjdCBhIG1hcmsgdG8gZ28gdG8nLFxyXG4gICAgZGVsZXRlOiAnU2VsZWN0IGEgbWFyayB0byBkZWxldGUnLFxyXG59O1xyXG5cclxuZXhwb3J0IHR5cGUgTW9kZSA9ICdzZXQnIHwgJ2dvdG8nIHwgJ2RlbGV0ZSc7XHJcblxyXG5leHBvcnQgY29uc3QgZGVmYXVsdFNldHRpbmdzID0ge1xyXG4gICAgaGlkZU1hcmtMaXN0RHVyaW5nSW5wdXQ6IGZhbHNlLFxyXG4gICAgbW9kYWxMaXN0VXA6ICcnLFxyXG4gICAgbW9kYWxMaXN0RG93bjogJycsXHJcbiAgICBtb2RhbExpc3RTZWxlY3Q6ICcnLFxyXG4gICAgbW9kYWxMaXN0RGVsZXRlOiAnJyxcclxuICAgIG9wZW5NYXJrSW5OZXdUYWI6IGZhbHNlLCAvLyBJZiB0cnVlLCBvcGVuIG1hcmsgaW4gbmV3IHRhYiwgZWxzZSBpbiBjdXJyZW50IHRhYlxyXG4gICAgcmVnaXN0ZXJMaXN0OiAnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXonLFxyXG4gICAgcmVnaXN0ZXJTb3J0QnlMaXN0OiB0cnVlLFxyXG4gICAgaGFycG9vblJlZ2lzdGVyTGlzdDogJ3F3ZXInLFxyXG4gICAgaGFycG9vblJlZ2lzdGVyU29ydEJ5TGlzdDogdHJ1ZSxcclxuICAgIGhhcnBvb25SZWdpc3RlckdhcFJlbW92YWw6IHRydWUsXHJcbiAgICBleHBlcmltZW50YWxHb3RvOiBmYWxzZSxcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBtb2RhbEluc3RydWN0aW9uRWxDbGFzcyA9ICdtb2RhbC1pbnN0cnVjdGlvbi1lbCc7XHJcbmV4cG9ydCBjb25zdCBtb2RhbE1hcmtTeW1ib2xDbGFzcyA9ICdtYXJrLXN5bWJvbCc7XHJcbmV4cG9ydCBjb25zdCBtb2RhbE1hcmtGaWxlcGF0aENsYXNzID0gJ21hcmstZmlsZS1wYXRoJztcclxuXHJcbmV4cG9ydCBjb25zdCBKU09Oc2NoZW1hVmVyc2lvbiA9IDE7IiwgImltcG9ydCB7IFNldHRpbmdzIH0gZnJvbSAnLi4vdHlwZXMvaW5kZXgnO1xyXG5pbXBvcnQgeyBNYXJrIH0gZnJvbSAnLi4vdHlwZXMvaW5kZXgnO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGZpbmRGaXJzdFVudXNlZFJlZ2lzdGVyKG1hcmtzOiBNYXJrW10sIHJlZ2lzdGVyczogc3RyaW5nW10pOiBzdHJpbmcgfCBudWxsIHtcclxuICAgIGZvciAoY29uc3QgcmVnIG9mIHJlZ2lzdGVycykge1xyXG4gICAgICAgIC8vIGlmIHJlZ2lzdGVyIG5vdCB1c2VkIGFscmVhZHksIHRoZW4gdXNlIGl0XHJcbiAgICAgICAgLy8gY29uc29sZS5sb2coJ0NoZWNraW5nIHJlZ2lzdGVyOicsIHJlZyk7XHJcbiAgICAgICAgaWYgKCEobWFya3MubWFwKG0gPT4gbS5zeW1ib2wpLmluY2x1ZGVzKHJlZykpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZWc7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIG51bGw7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRNYXJrQnlTeW1ib2wobWFya3M6IE1hcmtbXSwgc3ltYm9sOiBzdHJpbmcpOiBNYXJrIHwgdW5kZWZpbmVkIHtcclxuICAgIHJldHVybiBtYXJrcy5maW5kKG0gPT4gbS5zeW1ib2wgPT09IHN5bWJvbCk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBzb3J0TWFya3NBbHBoYWJldGljYWxseShtYXJrczogTWFya1tdKSB7XHJcbiAgICBtYXJrcy5zb3J0KChhLCBiKSA9PiBhLnN5bWJvbC5sb2NhbGVDb21wYXJlKGIuc3ltYm9sKSlcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldFNvcnRlZEFuZEZpbHRlcmVkTWFya3MobWFya3M6IE1hcmtbXSwgaXNIYXJwb29uTW9kZTogYm9vbGVhbiwgc2V0dGluZ3M6IFNldHRpbmdzKTogTWFya1tdIHtcclxuICAgIGNvbnN0IGF2YWlsYWJsZVJlZ2lzdGVycyA9IG5ldyBTZXQoKCFpc0hhcnBvb25Nb2RlID8gc2V0dGluZ3MucmVnaXN0ZXJMaXN0IDogc2V0dGluZ3MuaGFycG9vblJlZ2lzdGVyTGlzdCkuc3BsaXQoJycpKTtcclxuICAgIGNvbnN0IGZpbHRlcmVkTWFya3M6IE1hcmtbXSA9IG1hcmtzLmZpbHRlcihlbCA9PiBhdmFpbGFibGVSZWdpc3RlcnMuaGFzKGVsLnN5bWJvbCkpO1xyXG4gICAgaWYgKCFpc0hhcnBvb25Nb2RlICYmIHNldHRpbmdzLnJlZ2lzdGVyU29ydEJ5TGlzdCkge1xyXG4gICAgICAgIC8vIFNvcnQgbWFya3MgYnkgdGhlIG9yZGVyIG9mIHRoZSBrZXkgc3ltYm9scyBpbiB0aGUgcmVnaXN0ZXIgbGlzdFxyXG4gICAgICAgIGNvbnN0IHJlZ2lzdGVyTGlzdCA9IHNldHRpbmdzLnJlZ2lzdGVyTGlzdDtcclxuICAgICAgICBzb3J0TWFya3NCeVNldHRpbmdzUmVnaXN0ZXJPcmRlcihmaWx0ZXJlZE1hcmtzLCByZWdpc3Rlckxpc3QpO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoaXNIYXJwb29uTW9kZSAmJiBzZXR0aW5ncy5oYXJwb29uUmVnaXN0ZXJTb3J0QnlMaXN0KSB7XHJcbiAgICAgICAgLy8gU29ydCBtYXJrcyBieSB0aGUgb3JkZXIgb2YgdGhlIGtleSBzeW1ib2xzIGluIHRoZSBoYXJwb29uIHJlZ2lzdGVyIGxpc3RcclxuICAgICAgICBjb25zdCByZWdpc3Rlckxpc3QgPSBzZXR0aW5ncy5oYXJwb29uUmVnaXN0ZXJMaXN0O1xyXG4gICAgICAgIHNvcnRNYXJrc0J5U2V0dGluZ3NSZWdpc3Rlck9yZGVyKGZpbHRlcmVkTWFya3MsIHJlZ2lzdGVyTGlzdCk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICBzb3J0TWFya3NBbHBoYWJldGljYWxseShmaWx0ZXJlZE1hcmtzKTtcclxuICAgIH1cclxuICAgIHJldHVybiBmaWx0ZXJlZE1hcmtzO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc29ydE1hcmtzQnlTZXR0aW5nc1JlZ2lzdGVyT3JkZXIobWFya3M6IE1hcmtbXSwgcmVnaXN0ZXJzOiBzdHJpbmcgfCBzdHJpbmdbXSkge1xyXG4gICAgY29uc3QgcmVnaXN0ZXJPcmRlciA9IG5ldyBNYXAoWy4uLnJlZ2lzdGVyc10ubWFwKChzeW1ib2wsIGluZGV4KSA9PiBbc3ltYm9sLCBpbmRleF0pKTtcclxuICAgIG1hcmtzLnNvcnQoKGEsIGIpID0+IChyZWdpc3Rlck9yZGVyLmdldChhLnN5bWJvbCkgPz8gSW5maW5pdHkpIC0gKHJlZ2lzdGVyT3JkZXIuZ2V0KGIuc3ltYm9sKSA/PyBJbmZpbml0eSkpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcmVtb3ZlR2Fwc0ZvckhhcnBvb25NYXJrcyhtYXJrc1RvQ29weTogTWFya1tdLCBoYXJwb29uUmVnaXN0ZXJzOiBzdHJpbmdbXSk6IE1hcmtbXSB7XHJcbiAgICBsZXQgbWFya3MgPSBbLi4ubWFya3NUb0NvcHldO1xyXG5cclxuICAgIGxldCBsZWZ0Q3VyID0gMDtcclxuICAgIGxldCByaWdodEN1ciA9IDA7XHJcblxyXG4gICAgd2hpbGUgKHJpZ2h0Q3VyIDwgaGFycG9vblJlZ2lzdGVycy5sZW5ndGgpIHtcclxuICAgICAgICBjb25zdCBtYXJrRWwgPSBtYXJrcy5maW5kKGVsID0+IGVsLnN5bWJvbCA9PT0gaGFycG9vblJlZ2lzdGVyc1tyaWdodEN1cl0pO1xyXG5cclxuICAgICAgICBpZiAobWFya0VsICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgY29uc3Qgc3ltYm9sVG9TZXRUbyA9IGhhcnBvb25SZWdpc3RlcnNbbGVmdEN1cl07XHJcbiAgICAgICAgICAgIGxldCBmaWx0ZXJlZE1hcmtzID0gbWFya3MuZmlsdGVyKGVsID0+IGVsLnN5bWJvbCAhPT0gaGFycG9vblJlZ2lzdGVyc1tsZWZ0Q3VyXSk7XHJcbiAgICAgICAgICAgIGZpbHRlcmVkTWFya3MucHVzaCh7IHN5bWJvbDogc3ltYm9sVG9TZXRUbywgZmlsZVBhdGg6IG1hcmtFbC5maWxlUGF0aCB9KVxyXG4gICAgICAgICAgICBtYXJrcyA9IGZpbHRlcmVkTWFya3M7XHJcbiAgICAgICAgICAgIGxlZnRDdXIgKz0gMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmlnaHRDdXIgKz0gMTtcclxuICAgIH1cclxuXHJcbiAgICB3aGlsZSAobGVmdEN1ciA8IGhhcnBvb25SZWdpc3RlcnMubGVuZ3RoKSB7XHJcbiAgICAgICAgbWFya3MgPSBtYXJrcy5maWx0ZXIoZWwgPT4gZWwuc3ltYm9sICE9PSBoYXJwb29uUmVnaXN0ZXJzW2xlZnRDdXJdKTtcclxuICAgICAgICBsZWZ0Q3VyICs9IDE7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG1hcmtzO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc2V0TmV3T3JPdmVyd3JpdGVNYXJrKG1hcmtzOiBNYXJrW10sIHNldE1hcmsgOiBNYXJrLCBmaWxlUGF0aCA6IHN0cmluZykgOiBNYXJrW117XHJcbiAgICBjb25zdCBvdXRNYXJrcyA9IG1hcmtzLmZpbHRlcigobSkgPT4gbS5zeW1ib2wgIT09IHNldE1hcmsuc3ltYm9sKTtcclxuICAgIG91dE1hcmtzLnB1c2goeyBzeW1ib2w6IHNldE1hcmsuc3ltYm9sLCBmaWxlUGF0aDogZmlsZVBhdGggfSk7XHJcbiAgICByZXR1cm4gb3V0TWFya3M7XHJcbn0iLCAiaW1wb3J0IHsgbW9kYWxEZWZhdWx0S2V5YmluZHMsIG1vZGFsRGVmYXVsdEtleWJpbmRzTWFjIH0gZnJvbSBcIi4vZGVmYXVsdFZhbHVlc1wiO1xyXG5pbXBvcnQgeyBNb2RhbEtleWJpbmRzIH0gZnJvbSBcIi4uL3R5cGVzXCI7XHJcbmltcG9ydCB7IFNldHRpbmdzIH0gZnJvbSBcIi4uL3R5cGVzXCI7XHJcblxyXG4vLyBVdGlsaXR5IHRvIHByZXBhcmUga2V5YmluZHMgb2JqZWN0XHJcbmV4cG9ydCBmdW5jdGlvbiBwcmVwYXJlS2V5YmluZHMoaXNNYWNPUzogYm9vbGVhbiwgc2V0dGluZ3M6IFNldHRpbmdzKSB7XHJcbiAgICBsZXQga2V5YmluZHM6IE1vZGFsS2V5YmluZHMgPSAoIWlzTWFjT1MpID8geyAuLi5tb2RhbERlZmF1bHRLZXliaW5kcyB9IDogeyAuLi5tb2RhbERlZmF1bHRLZXliaW5kc01hYyB9O1xyXG5cclxuICAgIGlmIChzZXR0aW5ncy5tYXJrTGlzdFVwKSB7XHJcbiAgICAgICAga2V5YmluZHMudXAgPSBbc2V0dGluZ3MubWFya0xpc3RVcF07XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHNldHRpbmdzLm1hcmtMaXN0RG93bikge1xyXG4gICAgICAgIGtleWJpbmRzLmRvd24gPSBbc2V0dGluZ3MubWFya0xpc3REb3duXTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoc2V0dGluZ3MubWFya0xpc3REZWxldGUpIHtcclxuICAgICAgICBrZXliaW5kcy5kZWxldGUgPSBbc2V0dGluZ3MubWFya0xpc3REZWxldGVdO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChzZXR0aW5ncy5tYXJrTGlzdFNlbGVjdCl7XHJcbiAgICAgICAga2V5YmluZHMuc2VsZWN0ID0gW3NldHRpbmdzLm1hcmtMaXN0U2VsZWN0XTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ga2V5YmluZHM7XHJcbn1cclxuXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gbWF0Y2hLZXliaW5kKGV2dDogS2V5Ym9hcmRFdmVudCwga2V5YmluZDogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICAvLyBQYXJzZSBrZXliaW5kIHN0cmluZyBsaWtlICdjdHJsK3NoaWZ0K3AnLCAnY21kK24nLCBldGMuXHJcbiAgICBjb25zdCBwYXJ0cyA9IGtleWJpbmQuc3BsaXQoJysnKS5tYXAocCA9PiBwLnRyaW0oKSk7XHJcbiAgICBsZXQgcmVxdWlyZWQgPSB7IGN0cmw6IGZhbHNlLCBzaGlmdDogZmFsc2UsIGFsdDogZmFsc2UsIG1ldGE6IGZhbHNlLCBrZXk6ICcnIH07XHJcbiAgICBmb3IgKGNvbnN0IHBhcnQgb2YgcGFydHMpIHtcclxuICAgICAgICBpZiAocGFydCA9PT0gJ2N0cmwnKSByZXF1aXJlZC5jdHJsID0gdHJ1ZTtcclxuICAgICAgICBlbHNlIGlmIChwYXJ0ID09PSAnc2hpZnQnKSByZXF1aXJlZC5zaGlmdCA9IHRydWU7XHJcbiAgICAgICAgZWxzZSBpZiAocGFydCA9PT0gJ2FsdCcpIHJlcXVpcmVkLmFsdCA9IHRydWU7XHJcbiAgICAgICAgZWxzZSBpZiAocGFydCA9PT0gJ21ldGEnIHx8IHBhcnQgPT09ICdjbWQnIHx8IHBhcnQgPT09ICd3aW4nKSByZXF1aXJlZC5tZXRhID0gdHJ1ZTtcclxuICAgICAgICBlbHNlIHJlcXVpcmVkLmtleSA9IHBhcnQ7XHJcbiAgICB9XHJcbiAgICAvLyBDaGVjayBtb2RpZmllcnNcclxuICAgIGlmIChldnQuY3RybEtleSAhPT0gcmVxdWlyZWQuY3RybCkgcmV0dXJuIGZhbHNlO1xyXG4gICAgaWYgKGV2dC5zaGlmdEtleSAhPT0gcmVxdWlyZWQuc2hpZnQpIHJldHVybiBmYWxzZTtcclxuICAgIGlmIChldnQuYWx0S2V5ICE9PSByZXF1aXJlZC5hbHQpIHJldHVybiBmYWxzZTtcclxuICAgIGlmIChldnQubWV0YUtleSAhPT0gcmVxdWlyZWQubWV0YSkgcmV0dXJuIGZhbHNlO1xyXG4gICAgLy8gQ2hlY2sga2V5IChjYXNlLWluc2Vuc2l0aXZlKVxyXG4gICAgcmV0dXJuIGV2dC5rZXkgPT09IHJlcXVpcmVkLmtleTtcclxufSIsICJpbXBvcnQgeyBBcHAsIE1hcmtkb3duVmlldywgTm90aWNlLCBURmlsZSB9IGZyb20gXCJvYnNpZGlhblwiO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIG9wZW5OZXdGaWxlKGZpbGVQYXRoOiBzdHJpbmcsIG9wZW5GaWxlSW5OZXdUYWI6IGJvb2xlYW4sIGFwcDogQXBwKSB7XHJcbiAgICBjb25zdCBmaWxlID0gYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChmaWxlUGF0aCk7XHJcbiAgICBpZiAoZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XHJcbiAgICAgICAgaWYgKG9wZW5GaWxlSW5OZXdUYWIpIHtcclxuICAgICAgICAgICAgYXBwLndvcmtzcGFjZS5nZXRMZWFmKCd0YWInKS5vcGVuRmlsZShmaWxlKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBhcHAud29ya3NwYWNlLmdldExlYWYoKS5vcGVuRmlsZShmaWxlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICBuZXcgTm90aWNlKGBGaWxlIG5vdCBmb3VuZCBmb3IgcGF0aCAke2ZpbGVQYXRofS4gVGhlIGZpbGUgbWF5IGhhdmUgYmVlbiBkZWxldGVkLCBtb3ZlZCBvciByZW5hbWVkLmApO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0QWxsT3BlbmVkRmlsZXNFeHBlcmltZW50YWwoYXBwOiBBcHApOiBhbnkge1xyXG4gICAgLy8gQ2hlY2sgaWYgdGhlIGZpbGUgaXMgYWxyZWFkeSBvcGVuIGluIGEgbGVhZiwgd29ua3kgYnV0IGZpbmRzIGFsbFxyXG4gICAgLy8gVE9ETzogSSBjb3VsZCBtYWtlIGEgZnVuY3Rpb24gdGhhdCBkb2VzIHRoaXMsIGJ1dCBvbmx5IGZvciBzcGVjaWZpZWQgcGFuZSBpZiB0aGVyZSBpcyBhIG5lZWQgZm9yIG9wdGltaXphdGlvbi5cclxuICAgIC8vIGVnLjogdXNpbmcgYXBwLndvcmtzcGFjZS5nZXRMZWFmKCkucGFyZW50LmNoaWxkcmVuIHdpbGwgZ2V0IGFsbCB0aGUgdGFicyBpbiB0aGUgY3VycmVudCBwYW5lXHJcbiAgICAvLyB4RFxyXG4gICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgbGV0IHRhYkdyb3VwcyA9IGFwcC53b3Jrc3BhY2UuZ2V0TGF5b3V0KCkubWFpbj8uY2hpbGRyZW47XHJcbiAgICBsZXQgb3V0ID0gW107XHJcbiAgICBmb3IgKGNvbnN0IGVsIG9mIHRhYkdyb3Vwcyl7XHJcbiAgICAgICAgb3V0LnB1c2goLi4uZWwuY2hpbGRyZW4pXHJcbiAgICB9XHJcbiAgICByZXR1cm4gb3V0O1xyXG5cclxuICAgIC8vIGNvbnN0IGFwcCA9IHRoaXMuYXBwO1xyXG4gICAgLy8gY29uc3QgZmlsZXMgPSBuZXcgU2V0PFRGaWxlPigpO1xyXG4gICAgLy8gY29uc3QgbGF5b3V0ID0gYXBwLndvcmtzcGFjZS5nZXRMYXlvdXQoKTtcclxuXHJcbiAgICAvLyBmdW5jdGlvbiBjb2xsZWN0RmlsZXMobm9kZTogYW55KSB7XHJcbiAgICAvLyAgICAgaWYgKCFub2RlKSByZXR1cm47XHJcbiAgICAvLyAgICAgaWYgKG5vZGUudHlwZSA9PT0gJ2xlYWYnICYmIG5vZGUuc3RhdGU/LmZpbGUpIHtcclxuICAgIC8vICAgICAgICAgY29uc3QgZmlsZSA9IGFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgobm9kZS5zdGF0ZS5maWxlKTtcclxuICAgIC8vICAgICAgICAgaWYgKGZpbGUgaW5zdGFuY2VvZiBURmlsZSkgZmlsZXMuYWRkKGZpbGUpO1xyXG4gICAgLy8gICAgIH1cclxuICAgIC8vICAgICBpZiAobm9kZS5jaGlsZHJlbiAmJiBBcnJheS5pc0FycmF5KG5vZGUuY2hpbGRyZW4pKSB7XHJcbiAgICAvLyAgICAgICAgIGZvciAoY29uc3QgY2hpbGQgb2Ygbm9kZS5jaGlsZHJlbikgY29sbGVjdEZpbGVzKGNoaWxkKTtcclxuICAgIC8vICAgICB9XHJcbiAgICAvLyB9XHJcblxyXG4gICAgLy8gLy8gVHJhdmVyc2UgYWxsIHBvc3NpYmxlIHJvb3RzXHJcbiAgICAvLyBmb3IgKGNvbnN0IGtleSBvZiBbJ21haW4nLCAnbGVmdCcsICdyaWdodCcsICdjZW50ZXInLCAncG9wb3V0J10pIHtcclxuICAgIC8vICAgICBpZiAobGF5b3V0W2tleV0pIGNvbGxlY3RGaWxlcyhsYXlvdXRba2V5XSk7XHJcbiAgICAvLyB9XHJcblxyXG4gICAgLy8gcmV0dXJuIEFycmF5LmZyb20oZmlsZXMpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gbmF2aWdhdGVUb09wZW5GaWxlQnlQYXRoKGZpbGVQYXRoOiBzdHJpbmcsIGV4cGVyaW1lbnRhbEdvdG86IGJvb2xlYW4sIGFwcDogQXBwKTogYm9vbGVhbiB7XHJcbiAgICBpZiAoZXhwZXJpbWVudGFsR290bykge1xyXG4gICAgICAgIGNvbnN0IG9wZW5lZEZpbGVzID0gZ2V0QWxsT3BlbmVkRmlsZXNFeHBlcmltZW50YWwoYXBwKVxyXG4gICAgICAgIGZvciAoY29uc3Qgb3BlbmVkRmlsZSBvZiBvcGVuZWRGaWxlcykge1xyXG4gICAgICAgICAgICBpZiAob3BlbmVkRmlsZS50eXBlID09ICdsZWFmJyAmJiBvcGVuZWRGaWxlLnN0YXRlLnN0YXRlLmZpbGUgPT09IGZpbGVQYXRoKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgZmlsZSBpcyBhbHJlYWR5IG9wZW4sIHN3aXRjaCB0byBpdFxyXG4gICAgICAgICAgICAgICAgY29uc3QgbGVhZiA9IGFwcC53b3Jrc3BhY2UuZ2V0TGVhZkJ5SWQob3BlbmVkRmlsZS5pZCk7XHJcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnRm91bmQgbGVhZiBmb3IgZmlsZTonLCBvcGVuZWRGaWxlLnN0YXRlLnN0YXRlLmZpbGUsIG9wZW5lZEZpbGUuaWQsIGxlYWYpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGxlYWYgJiYgbGVhZi5wYXJlbnQgPT09IGFwcC53b3Jrc3BhY2UuZ2V0TGVhZigpLnBhcmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGFwcC53b3Jrc3BhY2Uuc2V0QWN0aXZlTGVhZihsZWFmLCB7IGZvY3VzOiB0cnVlIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGZpbGUgaXMgYWxyZWFkeSBvcGVuIGluIGEgbGVhZiwgbWlzc2VzIGFscmVhZHkgb3BlbmVkIGZpbGVzIHRoYXQgd2VyZSBvcGVuZWQgaW4gcHJldmlvdXMgb2JzaWRpYW4gc2Vzc2lvbnNcclxuICAgICAgICBjb25zdCBsZWF2ZXMgPSBhcHAud29ya3NwYWNlLmdldExlYXZlc09mVHlwZSgnbWFya2Rvd24nKTtcclxuICAgICAgICBmb3IgKGNvbnN0IGxlYWYgb2YgbGVhdmVzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHZpZXcgPSBsZWFmLnZpZXc7XHJcbiAgICAgICAgICAgIGlmICh2aWV3IGluc3RhbmNlb2YgTWFya2Rvd25WaWV3ICYmIHZpZXcuZmlsZSAmJiB2aWV3LmZpbGUucGF0aCA9PT0gZmlsZVBhdGggJiYgbGVhZi5wYXJlbnQgPT09IGFwcC53b3Jrc3BhY2UuZ2V0TGVhZigpLnBhcmVudCkge1xyXG4gICAgICAgICAgICAgICAgYXBwLndvcmtzcGFjZS5zZXRBY3RpdmVMZWFmKGxlYWYsIHsgZm9jdXM6IHRydWUgfSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBmYWxzZTtcclxufSIsICJpbXBvcnQgVmltTWFya3NJbXBsIGZyb20gJy4vbWFpbic7XHJcbmltcG9ydCB7IE1hcmtMaXN0TW9kYWwgfSBmcm9tICcuL3VpL01hcmtMaXN0TW9kYWwnO1xyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNldEdsb2JhbE1hcmsocGx1Z2luOiBWaW1NYXJrc0ltcGwpIHtcclxuICAgIG5ldyBNYXJrTGlzdE1vZGFsKHBsdWdpbi5hcHAsIHBsdWdpbiwgJ3NldCcpLm9wZW4oKTtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdvVG9HbG9iYWxNYXJrKHBsdWdpbjogVmltTWFya3NJbXBsKSB7XHJcbiAgICBuZXcgTWFya0xpc3RNb2RhbChwbHVnaW4uYXBwLCBwbHVnaW4sICdnb3RvJykub3BlbigpO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZGVsZXRlR2xvYmFsTWFyayhwbHVnaW46IFZpbU1hcmtzSW1wbCkge1xyXG4gICAgbmV3IE1hcmtMaXN0TW9kYWwocGx1Z2luLmFwcCwgcGx1Z2luLCAnZGVsZXRlJykub3BlbigpO1xyXG59XHJcblxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGFkZEZpbGVUb0hhcnBvb24ocGx1Z2luOiBWaW1NYXJrc0ltcGwpIHtcclxuICAgIG5ldyBNYXJrTGlzdE1vZGFsKHBsdWdpbi5hcHAsIHBsdWdpbiwgJ2dvdG8nKS5hZGRGaWxlVG9IYXJwb29uKCk7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnb1RvSGFycG9vbk1hcmsocGx1Z2luOiBWaW1NYXJrc0ltcGwpIHtcclxuICAgIG5ldyBNYXJrTGlzdE1vZGFsKHBsdWdpbi5hcHAsIHBsdWdpbiwgJ2dvdG8nLCB0cnVlKS5vcGVuKCk7XHJcbn0iLCAiaW1wb3J0IHsgQXBwLCBQbHVnaW5TZXR0aW5nVGFiLCBTZXR0aW5nIH0gZnJvbSAnb2JzaWRpYW4nO1xuaW1wb3J0IFZpbU1hcmtzSW1wbCBmcm9tICcuLi9tYWluJztcbmltcG9ydCB7IFNldHRpbmdzIH0gZnJvbSAnLi4vdHlwZXMvaW5kZXgnO1xuaW1wb3J0IHsgZGVmYXVsdFNldHRpbmdzIH0gZnJvbSAnLi4vdXRpbHMvZGVmYXVsdFZhbHVlcyc7XG5cbmV4cG9ydCBjbGFzcyBTZXR0aW5nc1RhYiBleHRlbmRzIFBsdWdpblNldHRpbmdUYWIge1xuICAgIHBsdWdpbjogVmltTWFya3NJbXBsO1xuXG4gICAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogVmltTWFya3NJbXBsKSB7XG4gICAgICAgIHN1cGVyKGFwcCwgcGx1Z2luKTtcbiAgICAgICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgfVxuXG4gICAgZGlzcGxheSgpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgeyBjb250YWluZXJFbCB9ID0gdGhpcztcbiAgICAgICAgY29udGFpbmVyRWwuZW1wdHkoKTtcbiAgICAgICAgY29uc3QgZHMgPSBkZWZhdWx0U2V0dGluZ3M7XG5cbiAgICAgICAgY29udGFpbmVyRWwuY3JlYXRlRWwoJ2g0JywgeyB0ZXh0OiAnR2VuZXJhbCcgfSk7XG4gICAgICAgIHRoaXMuY3JlYXRlUmVnaXN0ZXJMaXN0U2V0dGluZyhjb250YWluZXJFbCwgXCJSZWdpc3RlciBsaXN0XCIsIGRzLnJlZ2lzdGVyTGlzdCwgJ0tleSBzeW1ib2xzIHRvIGJlIHVzZWQgYXMgcmVnaXN0ZXJzLiBPbmx5IGluY2x1ZGUgc3ltYm9scyB0aGF0IHlvdSBjYW4gaW5wdXQgd2l0aCBhIHNpbmdsZSBrZXlzdHJva2UuJywgJ3JlZ2lzdGVyTGlzdCcpXG4gICAgICAgICAgICAuYWRkRXh0cmFCdXR0b24oKGJ0bikgPT4ge1xuICAgICAgICAgICAgICAgIGJ0blxuICAgICAgICAgICAgICAgICAgICAuc2V0SWNvbigncmVmcmVzaC1jY3cnKVxuICAgICAgICAgICAgICAgICAgICAuc2V0VG9vbHRpcCgnUmVzZXQgdG8gZGVmYXVsdCByZWdpc3RlciBsaXN0JylcbiAgICAgICAgICAgICAgICAgICAgLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MucmVnaXN0ZXJMaXN0ID0gZHMucmVnaXN0ZXJMaXN0O1xuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc3BsYXkoKTsgLy8gUmVmcmVzaCB0aGUgc2V0dGluZ3MgdGFiIHRvIHNob3cgdGhlIHVwZGF0ZWQgdmFsdWVcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSlcblxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgICAgICAgIC5zZXROYW1lKCdTb3J0IGFsbCBtYXJrcyBieSByZWdpc3RlciBsaXN0JylcbiAgICAgICAgICAgIC5zZXREZXNjKCdTb3J0IG1hcmtzIGJ5IHRoZSBvcmRlciBvZiB0aGUga2V5IHN5bWJvbHMgaW4gdGhlIHJlZ2lzdGVyIGxpc3QuIElmIGRpc2FibGVkLCBtYXJrcyB3aWxsIGJlIHNvcnRlZCBhbHBoYWJldGljYWxseSBhY2NvcmRpbmcgdG8gdGhlIGN1cnJlbnQgbG9jYWxlLicpXG4gICAgICAgICAgICAuYWRkVG9nZ2xlKHRvZ2dsZSA9PiB0b2dnbGVcbiAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MucmVnaXN0ZXJTb3J0QnlMaXN0ID8/IGRzLnJlZ2lzdGVyU29ydEJ5TGlzdClcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnJlZ2lzdGVyU29ydEJ5TGlzdCA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAvLyBUT0RPOiBpbXBsZW1lbnQgdGhpcyBmZWF0dXJlXG4gICAgICAgIC8vIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAvLyAgICAgLnNldE5hbWUoJ0hpZGUgbWFyayBsaXN0JylcbiAgICAgICAgLy8gICAgIC5zZXREZXNjKCdIaWRlIHRoZSBnbG9iYWwgbWFyayBsaXN0IGZvciBib3RoIGNvbW1hbmRzIChmb3IgZmFzdCBpbnB1dCwgbm8gZmxpY2tlcikuJylcbiAgICAgICAgLy8gICAgIC5hZGRUb2dnbGUodG9nZ2xlID0+IHRvZ2dsZVxuICAgICAgICAvLyAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5oaWRlTWFya0xpc3REdXJpbmdJbnB1dCA/PyBkcy5oaWRlTWFya0xpc3REdXJpbmdJbnB1dClcbiAgICAgICAgLy8gICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgIC8vICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmhpZGVNYXJrTGlzdER1cmluZ0lucHV0ID0gdmFsdWU7XG4gICAgICAgIC8vICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAvLyAgICAgICAgIH0pKTtcblxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgICAgICAgIC5zZXROYW1lKCdPcGVuIG1hcmsgaW4gbmV3IHRhYicpXG4gICAgICAgICAgICAuc2V0RGVzYygnT3BlbiBhIGZpbGUgaW4gdGhlIG5ldyB0YWIgd2hlbiB1c2luZyBcImdvIHRvXCIgY29tbWFuZC4gSWYgZGlzYWJsZWQsIGl0IHdpbGwgb3BlbiB0aGUgZmlsZSBpbiB0aGUgY3VycmVudCB0YWIuJylcbiAgICAgICAgICAgIC5hZGRUb2dnbGUodG9nZ2xlID0+IHRvZ2dsZVxuICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5vcGVuTWFya0luTmV3VGFiID8/IGRzLm9wZW5NYXJrSW5OZXdUYWIpXG4gICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5vcGVuTWFya0luTmV3VGFiID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoJ05vIGR1cGxpY2F0aW9uIG9mIG9wZW5lZCBmaWxlcyB3aGVuIHVzaW5nIGdvdG8gKGV4cGVyaW1lbnRhbCknKVxuICAgICAgICAgICAgLnNldERlc2MoJ1ByZXZlbnRzIGR1cGxpY2F0ZSB0YWJzIHdoZW4gc3dpdGNoaW5nIHRvIGFscmVhZHkgb3BlbmVkIGZpbGVzIHVzaW5nIHRoZSBtYXJrIGxpc3QgYWZ0ZXIgcmVzdGFydGluZyBPYnNpZGlhbi4gKEV4cGVyaW1lbnRhbDogbWF5IG5vdCB3b3JrIGluIGZ1dHVyZSBPYnNpZGlhbiB2ZXJzaW9ucy4pJylcbiAgICAgICAgICAgIC5hZGRUb2dnbGUodG9nZ2xlID0+IHRvZ2dsZVxuICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5leHBlcmltZW50YWxHb3RvID8/IGRzLmV4cGVyaW1lbnRhbEdvdG8pXG4gICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5leHBlcmltZW50YWxHb3RvID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuXG4gICAgICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKCdoNCcsIHsgdGV4dDogJ0hhcnBvb24gcmVnaXN0ZXJzJyB9KTtcbiAgICAgICAgdGhpcy5jcmVhdGVSZWdpc3Rlckxpc3RTZXR0aW5nKGNvbnRhaW5lckVsLCBcIkhhcnBvb24gcmVnaXN0ZXIgbGlzdFwiLCBkcy5oYXJwb29uUmVnaXN0ZXJMaXN0LCAnS2V5IHN5bWJvbHMgdG8gYmUgdXNlZCBhcyBIYXJwb29uIHJlZ2lzdGVycy4gT25seSBpbmNsdWRlIHN5bWJvbHMgdGhhdCB5b3UgY2FuIGlucHV0IHdpdGggYSBzaW5nbGUga2V5c3Ryb2tlLicsICdoYXJwb29uUmVnaXN0ZXJMaXN0JylcbiAgICAgICAgICAgIC5hZGRFeHRyYUJ1dHRvbigoYnRuKSA9PiB7XG4gICAgICAgICAgICAgICAgYnRuXG4gICAgICAgICAgICAgICAgICAgIC5zZXRJY29uKCdyZWZyZXNoLWNjdycpXG4gICAgICAgICAgICAgICAgICAgIC5zZXRUb29sdGlwKCdSZXNldCB0byBkZWZhdWx0IEhhcnBvb24gcmVnaXN0ZXIgbGlzdCcpXG4gICAgICAgICAgICAgICAgICAgIC5vbkNsaWNrKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmhhcnBvb25SZWdpc3Rlckxpc3QgPSBkcy5oYXJwb29uUmVnaXN0ZXJMaXN0O1xuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc3BsYXkoKTsgLy8gUmVmcmVzaCB0aGUgc2V0dGluZ3MgdGFiIHRvIHNob3cgdGhlIHVwZGF0ZWQgdmFsdWVcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSlcblxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgICAgICAgIC5zZXROYW1lKCdTb3J0IEhhcnBvb24gbWFya3MgYnkgSGFycG9vbiByZWdpc3RlciBsaXN0JylcbiAgICAgICAgICAgIC5zZXREZXNjKCdTb3J0IEhhcnBvb24gbWFya3MgYnkgdGhlIG9yZGVyIG9mIHRoZSBrZXkgc3ltYm9scyBpbiB0aGUgSGFycG9vbiByZWdpc3RlciBsaXN0LiBJZiBkaXNhYmxlZCwgbWFya3Mgd2lsbCBiZSBzb3J0ZWQgYWxwaGFiZXRpY2FsbHkgYWNjb3JkaW5nIHRvIHRoZSBjdXJyZW50IGxvY2FsZS4nKVxuICAgICAgICAgICAgLmFkZFRvZ2dsZSh0b2dnbGUgPT4gdG9nZ2xlXG4gICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmhhcnBvb25SZWdpc3RlclNvcnRCeUxpc3QgPz8gZHMuaGFycG9vblJlZ2lzdGVyU29ydEJ5TGlzdClcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmhhcnBvb25SZWdpc3RlclNvcnRCeUxpc3QgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAgICAgICAuc2V0TmFtZSgnUmVtb3ZlIGdhcHMgaW5iZXR3ZWVuIEhhcnBvb24gbWFya3MnKVxuICAgICAgICAgICAgLnNldERlc2MoJ0hhcnBvb24gbWFya3Mgd2lsbCBiZSBzaGlmdGVkIHRvIHRoZSBsZWZ0IGZvciBldmVyeSBnYXAgKHJlZ2lzdGVyIHdpdGggbm8gbWFyaykgYmFzZWQgb24gdGhlIG9yZGVyIG9mIHRoZSBIYXJwb29uIHJlZ2lzdGVyIGxpc3QuJylcbiAgICAgICAgICAgIC5hZGRUb2dnbGUodG9nZ2xlID0+IHRvZ2dsZVxuICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5oYXJwb29uUmVnaXN0ZXJHYXBSZW1vdmFsID8/IGRzLmhhcnBvb25SZWdpc3RlckdhcFJlbW92YWwpXG4gICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5oYXJwb29uUmVnaXN0ZXJHYXBSZW1vdmFsID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuXG5cbiAgICAgICAgLy8gQWRkIGtleWJvYXJkIHNob3J0Y3V0IHNldHRpbmdzXG4gICAgICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKCdoNCcsIHsgdGV4dDogJ0xpc3QgbmF2aWdhdGlvbiBzaG9ydGN1dHMnIH0pO1xuICAgICAgICB0aGlzLmNyZWF0ZVNob3J0Y3V0U2V0dGluZyhjb250YWluZXJFbCwgJ1VwJywgZHMubW9kYWxMaXN0VXAsICdTaG9ydGN1dCBmb3IgbW92aW5nIHVwIGluIHRoZSBsaXN0JywgJ21hcmtMaXN0VXAnKTtcbiAgICAgICAgdGhpcy5jcmVhdGVTaG9ydGN1dFNldHRpbmcoY29udGFpbmVyRWwsICdEb3duJywgZHMubW9kYWxMaXN0RG93biwgJ1Nob3J0Y3V0IGZvciBtb3ZpbmcgZG93biBpbiB0aGUgbGlzdCcsICdtYXJrTGlzdERvd24nKTtcbiAgICAgICAgdGhpcy5jcmVhdGVTaG9ydGN1dFNldHRpbmcoY29udGFpbmVyRWwsICdTZWxlY3QnLCBkcy5tb2RhbExpc3RTZWxlY3QsICdTaG9ydGN1dCBmb3Igc2VsZWN0aW5nIGEgbWFyaycsICdtYXJrTGlzdFNlbGVjdCcpO1xuICAgICAgICB0aGlzLmNyZWF0ZVNob3J0Y3V0U2V0dGluZyhjb250YWluZXJFbCwgJ0RlbGV0ZScsIGRzLm1vZGFsTGlzdERlbGV0ZSwgJ1Nob3J0Y3V0IGZvciBkZWxldGluZyBhIG1hcmsnLCAnbWFya0xpc3REZWxldGUnKTtcblxuXG4gICAgfVxuXG4gICAgLy8gdXNlIG9ubHkgZm9yIHN0cmluZyB2YWx1ZXMgZnJvbSBTZXR0aW5ncyB0eXBlXG4gICAgY3JlYXRlU2hvcnRjdXRTZXR0aW5nKGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudCwgbmFtZTogc3RyaW5nLCBkZWZhdWx0VmFsdWU6IHN0cmluZywgZGVzYzogc3RyaW5nLCBrZXk6IGtleW9mIFNldHRpbmdzKSB7XG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUobmFtZSlcbiAgICAgICAgICAgIC5zZXREZXNjKGRlc2MpXG4gICAgICAgICAgICAuYWRkVGV4dCh0ZXh0ID0+IHRleHRcbiAgICAgICAgICAgICAgICAuc2V0VmFsdWUoU3RyaW5nKHRoaXMucGx1Z2luLnNldHRpbmdzW2tleV0gPz8gZGVmYXVsdFZhbHVlKSlcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICh0aGlzLnBsdWdpbi5zZXR0aW5ncyBhcyBhbnkpW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgIH1cblxuICAgIGNyZWF0ZVJlZ2lzdGVyTGlzdFNldHRpbmcoY29udGFpbmVyRWw6IEhUTUxFbGVtZW50LCBuYW1lOiBzdHJpbmcsIGRlZmF1bHRWYWx1ZTogc3RyaW5nLCBkZXNjOiBzdHJpbmcsIGtleToga2V5b2YgU2V0dGluZ3MpOiBTZXR0aW5nIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUobmFtZSlcbiAgICAgICAgICAgIC5zZXREZXNjKGRlc2MpXG4gICAgICAgICAgICAuYWRkVGV4dCh0ZXh0ID0+IHRleHRcbiAgICAgICAgICAgICAgICAuc2V0VmFsdWUoU3RyaW5nKHRoaXMucGx1Z2luLnNldHRpbmdzW2tleV0gPz8gZGVmYXVsdFZhbHVlKSlcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICh0aGlzLnBsdWdpbi5zZXR0aW5ncyBhcyBhbnkpW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgIH1cbn0iLCAiaW1wb3J0IFZpbU1hcmtzSW1wbCBmcm9tICcuLi9tYWluJztcclxuaW1wb3J0IHsgU2V0dGluZ3MsIE1hcmsgfSBmcm9tICcuLi90eXBlcy9pbmRleCc7XHJcbmltcG9ydCB7IGRlZmF1bHRTZXR0aW5ncywgSlNPTnNjaGVtYVZlcnNpb24gYXMgbGF0ZXN0SlNPTlNjaGVtYVZlcnNpb24gfSBmcm9tICcuL2RlZmF1bHRWYWx1ZXMnO1xyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxvYWRTZXR0aW5ncyhwbHVnaW46IFZpbU1hcmtzSW1wbCk6IFByb21pc2U8U2V0dGluZ3M+IHtcclxuICAgIHJldHVybiAoYXdhaXQgcGx1Z2luLmxvYWREYXRhKCkpPy5zZXR0aW5ncyB8fCBkZWZhdWx0U2V0dGluZ3M7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzYXZlU2V0dGluZ3MocGx1Z2luOiBWaW1NYXJrc0ltcGwsIHNldHRpbmdzOiBTZXR0aW5ncykge1xyXG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHBsdWdpbi5sb2FkRGF0YSgpIHx8IHt9O1xyXG4gICAgZGF0YS5zZXR0aW5ncyA9IHNldHRpbmdzO1xyXG4gICAgYXdhaXQgcGx1Z2luLnNhdmVEYXRhKGRhdGEpO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbG9hZE1hcmtzKHBsdWdpbjogVmltTWFya3NJbXBsKTogUHJvbWlzZTxNYXJrW10+IHtcclxuICAgIHJldHVybiAoYXdhaXQgcGx1Z2luLmxvYWREYXRhKCkpPy5tYXJrcyB8fCBbXTtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNhdmVNYXJrcyhwbHVnaW46IFZpbU1hcmtzSW1wbCwgbWFya3M6IE1hcmtbXSkge1xyXG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHBsdWdpbi5sb2FkRGF0YSgpIHx8IHt9O1xyXG4gICAgZGF0YS5tYXJrcyA9IG1hcmtzO1xyXG4gICAgYXdhaXQgcGx1Z2luLnNhdmVEYXRhKGRhdGEpO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gSlNPTnNjaGVtYUNoZWNrKHBsdWdpbjogVmltTWFya3NJbXBsKSB7XHJcbiAgICBjb25zdCBkYXRhID0gYXdhaXQgcGx1Z2luLmxvYWREYXRhKCkgfHwge3NjaGVtYVZlcnNpb246IGxhdGVzdEpTT05TY2hlbWFWZXJzaW9ufTtcclxuXHJcbiAgICBpZiAoZGF0YS5zY2hlbWFWZXJzaW9uICYmIGRhdGEuc2NoZW1hVmVyc2lvbiA9PT0gbGF0ZXN0SlNPTlNjaGVtYVZlcnNpb24pe1xyXG4gICAgICAgIHJldHVyblxyXG4gICAgfVxyXG5cclxuICAgIGNvbnNvbGUubG9nKFwidGV0aGVyLW1hcmtzOiBUaGUgZGF0YSBsb2FkZWQgaXMgbm90IGluIGNvcnJlY3QgZm9ybWF0LiBUaGUgcGx1Z2luIG1heSBub3Qgd29yayBjb3JyZWN0bHkuIFRoaXMgd2lsbCB1c3VhbGx5IGhhcHBlbiBhZnRlciBwbHVnaW4gdXBkYXRlIHRoYXQgY2hhbmdlcyBKU09OIHNjaGVtYS4gXCIpO1xyXG4gICAgLy8gVE9ETzogbWFrZSBhdXRvbWF0aWMgY29udmVyc2lvbnMgaGVyZSBpZiBuZWNlc3NhcnkgaW4gdGhlIGZ1dHVyZS4gQmUgc3VyZSB0byBzYXZlIHRoZSBsZWdhY3kgcHJlIGNvbnZlcnNpb24gZGF0YSBhcyBiYWNrdXAgaW4gdGhlIFwibGVnYWN5U2NoZW1hRGF0YVwiIGZpZWxkLiBcclxufSJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsSUFBQUEsbUJBQXVCOzs7QUNB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QUFnQixRQUFzQjtBQUN4RCxRQUFNLE9BQU8sTUFBTSxPQUFPLFNBQVMsS0FBSyxFQUFDLGVBQWUsa0JBQXVCO0FBRS9FLE1BQUksS0FBSyxpQkFBaUIsS0FBSyxrQkFBa0IsbUJBQXdCO0FBQ3JFO0FBQUEsRUFDSjtBQUVBLFVBQVEsSUFBSSxvS0FBb0s7QUFFcEw7OztBUjNCQSxJQUFxQixlQUFyQixjQUEwQyx3QkFBTztBQUFBLEVBQWpEO0FBQUE7QUFFSSxpQkFBZ0IsQ0FBQztBQUFBO0FBQUEsRUFFakIsTUFBTSxTQUFTO0FBQ1gsVUFBTSxnQkFBZ0IsSUFBSTtBQUUxQixTQUFLLFdBQVcsTUFBTSxhQUFhLElBQUk7QUFDdkMsU0FBSyxRQUFRLE1BQU0sVUFBVSxJQUFJO0FBRWpDLFNBQUssV0FBVztBQUFBLE1BQ1osSUFBSTtBQUFBLE1BQ0osTUFBTTtBQUFBLE1BQ04sVUFBVSxNQUFNLGNBQWMsSUFBSTtBQUFBLElBQ3RDLENBQUM7QUFFRCxTQUFLLFdBQVc7QUFBQSxNQUNaLElBQUk7QUFBQSxNQUNKLE1BQU07QUFBQSxNQUNOLFVBQVUsTUFBTSxlQUFlLElBQUk7QUFBQSxJQUN2QyxDQUFDO0FBRUQsU0FBSyxXQUFXO0FBQUEsTUFDWixJQUFJO0FBQUEsTUFDSixNQUFNO0FBQUEsTUFDTixVQUFVLE1BQU0saUJBQWlCLElBQUk7QUFBQSxJQUN6QyxDQUFDO0FBRUQsU0FBSyxXQUFXO0FBQUEsTUFDWixJQUFJO0FBQUEsTUFDSixNQUFNO0FBQUEsTUFDTixVQUFVLE1BQU0saUJBQWlCLElBQUk7QUFBQSxJQUN6QyxDQUFDO0FBRUQsU0FBSyxXQUFXO0FBQUEsTUFDWixJQUFJO0FBQUEsTUFDSixNQUFNO0FBQUEsTUFDTixVQUFVLE1BQU0sZ0JBQWdCLElBQUk7QUFBQSxJQUN4QyxDQUFDO0FBRUQsU0FBSyxjQUFjLElBQUksWUFBWSxLQUFLLEtBQUssSUFBSSxDQUFDO0FBRWxELFlBQVEsSUFBSSxzQkFBc0I7QUFBQSxFQUN0QztBQUFBLEVBRUEsTUFBTSxlQUFlO0FBQ2pCLFVBQU0sYUFBYSxNQUFNLEtBQUssUUFBUTtBQUFBLEVBQzFDO0FBQUEsRUFFQSxNQUFNLFVBQVUsT0FBZTtBQUMzQixTQUFLLFFBQVE7QUFDYixVQUFNLFVBQVUsTUFBTSxLQUFLO0FBQUEsRUFDL0I7QUFBQSxFQUVBLFdBQVc7QUFFUCxZQUFRLElBQUksd0JBQXdCO0FBQUEsRUFDeEM7QUFDSjsiLAogICJuYW1lcyI6IFsiaW1wb3J0X29ic2lkaWFuIiwgImltcG9ydF9vYnNpZGlhbiIsICJpbXBvcnRfb2JzaWRpYW4iXQp9Cg==
